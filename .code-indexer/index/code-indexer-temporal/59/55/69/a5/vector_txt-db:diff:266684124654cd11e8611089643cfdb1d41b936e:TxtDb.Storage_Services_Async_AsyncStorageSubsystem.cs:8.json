{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs:8",
  "vector": [
    0.031276226,
    -0.016023021,
    0.016460106,
    0.040232498,
    -0.004979579,
    0.002569039,
    -0.015262849,
    -0.010811599,
    0.052241191,
    0.006607718,
    0.020566324,
    0.000956695,
    0.07893905,
    -0.008923964,
    -0.066884324,
    -0.058652706,
    0.033334035,
    0.018996472,
    -0.028615313,
    0.045781471,
    -0.023636213,
    -0.043590896,
    -0.066735141,
    0.040361244,
    -0.066804521,
    0.001437612,
    0.024901126,
    0.039757289,
    -0.01110451,
    0.045369405,
    -0.009374707,
    -0.060345121,
    0.011933917,
    0.048211716,
    0.031600595,
    0.004416428,
    -0.039720811,
    -0.015832411,
    -0.013688209,
    0.027877521,
    0.029438211,
    -0.026751786,
    0.028494626,
    -0.004936645,
    -0.002321863,
    -0.037241295,
    0.000331432,
    0.010360382,
    -0.00502711,
    0.01855763,
    -0.007432452,
    0.002521442,
    -0.028091498,
    0.061589967,
    0.0096767,
    -0.047790173,
    0.065535121,
    0.029927859,
    -0.03977441,
    0.047904279,
    -0.013860843,
    -0.005864434,
    -0.021498295,
    0.021865632,
    -0.011895319,
    -0.053749654,
    -0.066626273,
    0.071884148,
    0.04060398,
    -0.062616788,
    0.019852694,
    0.029428259,
    0.003029416,
    0.049614489,
    0.021164281,
    0.033957377,
    0.041915145,
    0.018613016,
    0.049228713,
    0.003405765,
    -0.072151698,
    -0.080856659,
    0.014375729,
    -0.02915268,
    0.035046197,
    -0.027382616,
    0.02233918,
    -0.047039099,
    0.00362302,
    -0.015104558,
    -0.019080698,
    0.048370998,
    0.040254693,
    0.020483671,
    0.001327974,
    0.056871086,
    0.022714145,
    -0.008536647,
    0.056451593,
    -0.012856507,
    0.011027589,
    0.01234722,
    -0.040868074,
    0.060588274,
    -0.071548328,
    -0.013607559,
    0.001911046,
    -0.02888065,
    -0.021409901,
    0.022186255,
    0.04334636,
    0.010537748,
    0.023788294,
    0.000884432,
    0.017003125,
    0.003461817,
    -0.000446285,
    -0.026676891,
    0.026992755,
    0.056933366,
    -0.027908262,
    0.021260649,
    -0.074362941,
    0.051008604,
    -0.028845781,
    0.049080152,
    0.021325078,
    0.043116886,
    0.019929381,
    -0.055373099,
    0.012358209,
    -0.049851682,
    -0.008381232,
    0.009220493,
    -0.01033256,
    0.030117013,
    0.00258327,
    0.039212234,
    -0.001968775,
    -0.047074221,
    0.03795889,
    -0.00693445,
    -0.011004973,
    0.018351054,
    -0.020593058,
    0.015939239,
    0.021026354,
    -0.005450622,
    0.021617955,
    -0.083199583,
    -0.006072524,
    0.0575913,
    -0.049524453,
    0.007927059,
    0.00564859,
    0.022832572,
    -0.018709028,
    -0.012814526,
    0.011364068,
    -0.031781685,
    -0.045280933,
    0.018778576,
    0.011042193,
    0.021308159,
    -0.025667008,
    0.034705415,
    0.027442554,
    -0.001709561,
    0.026667826,
    -0.016813328,
    -0.070742637,
    0.028007239,
    -0.054405637,
    -0.001670609,
    -0.0332417,
    0.016818613,
    0.027419822,
    0.006571524,
    -0.070796967,
    -0.035634458,
    0.007058011,
    -0.000536958,
    -0.000684745,
    -0.00539762,
    -0.009328025,
    -0.000612087,
    0.054086674,
    0.0434236,
    0.008706604,
    0.025647009,
    -0.040435087,
    -0.006301908,
    -0.023239819,
    -0.006208627,
    0.009877698,
    -0.032401934,
    -0.038286183,
    -0.000926878,
    0.018856578,
    0.034503385,
    -0.050621372,
    0.044153161,
    -0.077488013,
    -0.009841078,
    0.041065574,
    -0.002141678,
    -0.030865515,
    -0.027370697,
    -0.002113915,
    0.025330951,
    -0.011200806,
    -0.012266489,
    -0.000971997,
    -0.016738283,
    0.007117864,
    0.00788506,
    -0.043692268,
    0.005786746,
    0.053131346,
    0.015456205,
    0.023964796,
    -0.010487305,
    0.053732086,
    0.022474028,
    -0.034927011,
    -0.023607748,
    -0.051621791,
    -0.056549218,
    -0.019588027,
    -0.016406011,
    0.008162159,
    -0.049548637,
    0.029961515,
    -0.05044711,
    -0.060728703,
    0.033429462,
    -0.020955892,
    -0.025957858,
    0.010282123,
    -0.025578838,
    -0.031337198,
    0.053185232,
    -0.006771373,
    -0.015408501,
    -0.01434376,
    0.017604012,
    0.048275255,
    0.022092093,
    0.003151595,
    0.020196283,
    -0.032134593,
    0.065638989,
    -0.018409871,
    0.10878244,
    0.046321269,
    -0.005482025,
    -0.01886555,
    0.001736767,
    -0.00276903,
    -0.017232789,
    0.003732722,
    0.008771425,
    -0.032865133,
    0.041551158,
    -0.005737269,
    0.02911051,
    -0.025515581,
    -0.03523352,
    -0.020078333,
    0.042829152,
    0.011287292,
    0.030974651,
    0.058031388,
    0.037541319,
    -0.000582191,
    -0.031576343,
    0.036811661,
    0.04724827,
    0.014183936,
    0.006347818,
    -0.044751316,
    0.004701372,
    0.019578373,
    -0.018706197,
    -0.00625511,
    -0.053890817,
    0.024961976,
    -0.028477704,
    0.037127346,
    0.036079016,
    0.032575812,
    -0.008009974,
    -0.004737806,
    -0.024926562,
    0.044197354,
    0.025053099,
    0.030128613,
    -0.00525209,
    0.003816103,
    -0.040507104,
    -0.01153804,
    -0.017046411,
    0.065775625,
    0.026606694,
    -0.004955893,
    0.018927511,
    0.037985753,
    -0.027600426,
    0.001457031,
    -0.020850949,
    -0.039996833,
    -0.005347884,
    0.017215444,
    0.007145821,
    0.023556918,
    -0.058288526,
    -0.031280555,
    0.001450857,
    -0.015501976,
    -0.011260467,
    0.007388224,
    -0.029538481,
    0.029203508,
    -0.083354786,
    0.020955168,
    -0.010169885,
    -0.047216039,
    -0.033930562,
    0.051343955,
    -0.025763692,
    -0.002813711,
    0.038884331,
    0.007509351,
    0.061174214,
    -0.006314605,
    0.025826707,
    -0.019709941,
    -0.000785182,
    -0.047562797,
    0.015858013,
    0.013696915,
    -0.040724885,
    0.020617412,
    -0.048590641,
    0.045306168,
    -0.008392771,
    0.003708487,
    0.004701124,
    -0.023094976,
    0.060928743,
    0.0074284,
    -0.061080564,
    -0.024882402,
    -0.003642594,
    -0.059063457,
    0.041719321,
    0.003028081,
    0.023459399,
    -0.008476996,
    0.016682908,
    0.032184321,
    0.02305517,
    -0.051540293,
    -0.024697343,
    -0.028411029,
    -0.001174284,
    -0.041097511,
    0.072126836,
    -0.008219545,
    0.020056034,
    -0.072578646,
    -0.063577339,
    -0.045420829,
    0.013285118,
    -0.018046435,
    0.036964994,
    0.024602652,
    -0.007231729,
    -0.046290398,
    -0.022740599,
    0.022982895,
    0.018510353,
    0.023643818,
    0.000362642,
    -0.01907461,
    -0.036382198,
    0.015880486,
    0.021747999,
    0.005667892,
    0.049144547,
    -0.005498287,
    0.022382328,
    0.013321887,
    0.002380648,
    -0.001918755,
    -0.024679141,
    -0.000714379,
    0.045402143,
    0.006734702,
    -0.055772621,
    0.01267661,
    -0.014786158,
    0.036300696,
    -0.06696447,
    0.031325269,
    0.021567525,
    0.027472606,
    0.03901305,
    0.001308415,
    0.044269696,
    -0.016626609,
    0.037054464,
    -0.033348251,
    0.020681195,
    -0.052753914,
    0.029407291,
    -0.007016673,
    -0.018436512,
    0.007530219,
    0.005000053,
    0.001407554,
    -0.004158826,
    -0.007593703,
    0.00099684,
    -0.036585841,
    0.01345492,
    0.006006435,
    -0.085972205,
    -0.040230155,
    -0.01105632,
    -0.016817536,
    -0.017468138,
    -0.059117861,
    0.004296298,
    0.054686174,
    -0.066325314,
    0.010832255,
    0.008515521,
    -0.031296026,
    -0.040549461,
    0.018069122,
    -0.031974185,
    0.023513462,
    -0.037502136,
    0.004427628,
    -0.019596091,
    0.039135978,
    0.04525831,
    -0.017573114,
    -0.03059037,
    -0.05879131,
    -0.018025747,
    -0.039284531,
    0.001859595,
    0.068797961,
    -0.024559567,
    0.001897121,
    0.030518217,
    0.011312809,
    -0.021257132,
    -0.034575943,
    -0.014426277,
    -0.007099674,
    0.015926259,
    -0.018122783,
    0.006962573,
    0.027568843,
    -0.037226379,
    -0.012276886,
    0.000913809,
    0.043466799,
    -0.02368628,
    -0.015100524,
    0.013983698,
    0.025547344,
    0.012295946,
    0.006429761,
    0.04725017,
    -0.027090371,
    -0.038054455,
    -0.016629951,
    -0.05405115,
    -0.022183703,
    -0.038806207,
    -0.012766673,
    0.01307828,
    -0.020535525,
    0.025188306,
    0.011917916,
    -0.022446284,
    -0.022247367,
    -0.005212249,
    -0.022612799,
    -0.004534698,
    0.000417325,
    -0.012290196,
    -0.011493738,
    -0.03090764,
    -0.034990016,
    0.055632722,
    0.036816366,
    -0.089891031,
    0.022936212,
    -0.015891865,
    -0.02108684,
    0.00842754,
    0.019130545,
    -0.029262692,
    -0.089369066,
    0.035529748,
    -0.01188967,
    -0.015969614,
    0.000990339,
    0.014257981,
    0.029779673,
    -0.041256566,
    -0.038672611,
    0.0293594,
    0.008348448,
    -0.007290615,
    0.001458613,
    0.008564367,
    -0.022879593,
    -0.045776047,
    -0.01986168,
    0.021064285,
    0.02815263,
    0.013400366,
    -0.00241477,
    -0.031326715,
    0.001064835,
    0.001192048,
    -0.014606269,
    -0.061080851,
    0.021611359,
    -0.010904762,
    0.013888153,
    0.015894331,
    0.000372222,
    -0.020174274,
    -0.0399777,
    0.015004154,
    -0.011263369,
    -0.037777074,
    0.025436446,
    0.013847239,
    -0.006001934,
    0.023678966,
    0.008064708,
    0.001384708,
    -0.00665054,
    0.040289328,
    0.028007416,
    0.049741954,
    -0.045779143,
    0.05205461,
    0.027970286,
    0.005754108,
    0.032945354,
    -0.029841926,
    0.042804621,
    0.024999242,
    0.015780391,
    0.006814532,
    -0.02768149,
    0.016655561,
    0.032675426,
    0.016304806,
    -0.030601613,
    -0.004812916,
    0.003121935,
    -0.024382133,
    0.023351232,
    0.006997538,
    -0.022523778,
    0.045859806,
    0.04445355,
    -0.056350071,
    -0.004118258,
    -0.009860641,
    0.004512934,
    -0.001196516,
    0.011811483,
    0.034095883,
    -0.002564067,
    -0.065987378,
    0.033192672,
    -0.018286152,
    -0.043861847,
    -0.026639394,
    0.037851896,
    -0.021161597,
    0.018813759,
    -0.032818209,
    0.064497828,
    0.007315144,
    -0.024245933,
    -0.034076583,
    -0.003584768,
    -0.045721784,
    0.008889046,
    0.01920242,
    0.044709139,
    0.016889293,
    -0.002106304,
    -0.042412043,
    0.024694499,
    -0.024150593,
    0.042971049,
    0.039954375,
    0.016917588,
    0.017573338,
    0.081820481,
    -0.021582508,
    0.027443914,
    0.034634765,
    0.013235649,
    -0.084894374,
    0.030697789,
    0.00211596,
    0.00533688,
    -0.051317807,
    -0.033580627,
    -0.00083119,
    -0.008994361,
    -0.004028478,
    0.021517359,
    0.016802814,
    -0.000849465,
    0.01706069,
    -0.016184093,
    0.03332058,
    -0.043249514,
    0.018390778,
    0.002826415,
    0.012612351,
    0.008928396,
    0.015620926,
    0.001218414,
    -0.001676209,
    -0.006358588,
    -0.010187483,
    -0.001177679,
    0.027325913,
    0.049936447,
    0.031074524,
    0.039951332,
    -0.040609248,
    -0.016639821,
    0.023993127,
    0.011334369,
    0.013120614,
    0.086948432,
    0.043849681,
    0.042762347,
    0.023613686,
    0.022459501,
    -0.022470666,
    -0.012224676,
    0.010128898,
    -0.017466923,
    -0.051982708,
    -0.02340645,
    0.011524142,
    0.036773253,
    -0.039278448,
    -0.002315457,
    0.03754482,
    -0.024698686,
    -0.022775361,
    -0.030571034,
    0.020668488,
    -0.031943653,
    -0.036976289,
    -0.007194494,
    0.008155994,
    -0.007951784,
    0.004823039,
    -0.014981629,
    -0.013315422,
    0.041225407,
    0.08427006,
    -0.011691649,
    0.003865647,
    -0.064665861,
    -0.008427854,
    -0.019760162,
    0.010307662,
    -0.010241152,
    0.00977418,
    -0.010095172,
    -0.034950215,
    0.083172403,
    -0.007471114,
    -0.009789475,
    -0.0155814,
    0.02392962,
    -0.011259136,
    -0.040487282,
    -0.036733609,
    -0.020564873,
    0.061103318,
    -0.00785369,
    0.005785293,
    0.012777144,
    -0.016952818,
    -0.011725984,
    -0.021065028,
    0.069283053,
    -0.002652203,
    -0.014758178,
    -0.010421576,
    -0.00257675,
    0.021541078,
    0.017097047,
    -0.002811749,
    -0.043973539,
    -0.032890644,
    -0.024919108,
    0.041341141,
    0.044207379,
    -0.036889989,
    -0.037903849,
    0.004568536,
    -0.005506169,
    0.01624158,
    -0.007877484,
    0.017313456,
    0.071898542,
    -1.3321e-05,
    -0.019565802,
    0.000902028,
    0.01579985,
    0.045520432,
    -0.055050649,
    0.010313687,
    -0.053941272,
    0.01486451,
    -0.037193622,
    0.012771496,
    0.006943599,
    0.020990044,
    -0.020597123,
    -0.012346866,
    -0.019418776,
    0.011507096,
    -0.016120918,
    0.022303876,
    -0.005742674,
    -0.044979386,
    -0.011206646,
    0.000972295,
    0.012492136,
    -0.008612595,
    0.022739477,
    -0.01492414,
    -0.035709586,
    0.0362029,
    0.001203473,
    0.047069672,
    -0.023335684,
    0.0011335,
    -0.009107263,
    -0.03308377,
    -0.015355037,
    -0.030731697,
    0.002212551,
    0.016572457,
    -0.064021349,
    0.002288233,
    -0.035115991,
    0.001170561,
    -0.016118715,
    0.025574051,
    -0.040740319,
    -0.049659438,
    0.022863254,
    -0.005066339,
    -0.055705927,
    0.004669056,
    0.011890979,
    0.005989417,
    0.007902881,
    -0.010780581,
    -0.001005911,
    -0.021355433,
    0.023968572,
    0.040497899,
    -0.025945291,
    -0.064177677,
    0.039926011,
    -0.00721123,
    -0.03547015,
    0.014748333,
    0.02363071,
    -0.004853569,
    -0.060728975,
    -0.026061146,
    0.028984832,
    0.002277673,
    -0.032256097,
    0.04542784,
    0.009043583,
    0.049111232,
    -0.008259437,
    -0.017153021,
    0.065941393,
    -0.000209035,
    0.030248323,
    0.008835671,
    0.016676662,
    -0.008897062,
    -0.046709824,
    -0.009854348,
    0.018467955,
    -0.013117575,
    -0.081013568,
    0.015605863,
    0.00843596,
    0.008019676,
    0.015970701,
    0.033519059,
    0.023361146,
    0.026652282,
    -0.027367048,
    0.016290853,
    -0.008259367,
    0.010276155,
    -0.007716581,
    0.009280894,
    -0.061093446,
    0.031498302,
    -0.001680685,
    -0.04221246,
    0.016404215,
    0.008342926,
    -0.024641944,
    0.050189551,
    -0.000177368,
    -0.026720667,
    -0.008466944,
    0.008207076,
    0.020358559,
    -0.004727993,
    -0.018595194,
    -0.075223282,
    -0.006187943,
    0.031044098,
    -0.022709379,
    0.01010855,
    0.00708423,
    -0.024317391,
    -0.016625475,
    -0.004325034,
    -0.002537032,
    0.052181177,
    0.014397273,
    0.028478382,
    -0.051529422,
    -0.019787403,
    0.050512735,
    0.016259251,
    -0.021172678,
    -0.024217237,
    -0.044552941,
    -0.033344567,
    -0.010996298,
    0.011502626,
    -0.038808268,
    -0.007927089,
    0.004872084,
    0.028508427,
    -0.041558933,
    0.00208976,
    0.02714113,
    0.019698951,
    0.032185417,
    0.001959754,
    -0.045655996,
    0.002255433,
    -0.008591109,
    0.01525885,
    0.017793458,
    0.032388113,
    0.002852442,
    -0.01343885,
    -0.008702253,
    -0.006569259,
    -0.016779352,
    0.035957675,
    -0.033734977,
    -0.021260858,
    -0.001127171,
    0.052943006,
    0.021615352,
    0.040775348,
    -0.005785901,
    -0.036652975,
    -0.001545794,
    0.016241968,
    0.000368707,
    0.042114805,
    -0.052445374,
    0.035674207,
    0.034060229,
    0.00882453,
    -0.014098778,
    0.001047556,
    -0.007957392,
    0.053625654,
    0.010805431,
    -0.038423531,
    -0.031140547,
    -0.020176187,
    -0.003749141,
    0.00041794,
    0.038651004,
    0.035129067,
    0.021984234,
    -0.027211111,
    0.005382731,
    -0.035150174,
    -0.014601557,
    0.022538126,
    0.013450831,
    0.006147282,
    -0.096835338,
    0.007594314,
    -0.051339068,
    0.03126448,
    -0.028231157,
    -0.001492237,
    -0.009391299,
    0.038280521,
    0.006940877,
    -0.026141228,
    -0.021057501,
    0.044507891,
    0.051204592,
    -0.049920134,
    0.008549877,
    -0.039903507,
    -0.045039002,
    -0.02857112,
    -0.046142992,
    0.004301848,
    0.006534734,
    0.05395763,
    -0.004865101,
    -0.0251815,
    -0.007660883,
    -0.013977933,
    0.01955976,
    0.061946344,
    0.039777815,
    0.003565746,
    -0.040588021,
    -0.00780277,
    -0.034364656,
    -0.022576271,
    0.00089852,
    -0.028187998,
    0.027938677,
    0.019309653,
    0.034086503,
    0.018445386,
    0.040856741,
    0.057856459,
    0.027250206,
    0.046467148,
    0.010493375,
    -0.016387323,
    -0.041658316,
    0.003059482,
    -0.026982661,
    -0.011274778,
    0.033638574,
    0.001249086,
    -0.043493524,
    0.016897829,
    0.047184028,
    0.000495568,
    0.053453755,
    -0.020232072,
    -0.004425035,
    -0.038427904,
    -0.045746073,
    0.039877497,
    -0.046646785,
    -0.026936844,
    0.000696863,
    0.000979972,
    0.010191723,
    0.001994398,
    -0.002609542,
    -0.010384497,
    -0.03411508,
    -0.023827752,
    0.020041224,
    -0.024909908,
    0.024992181,
    -0.016460694,
    0.030178389,
    2.8906e-05,
    0.021102091,
    -0.03059837,
    0.019138057,
    0.015872052,
    0.033952076,
    0.045593407,
    0.036329839,
    0.027808771,
    0.015651394,
    0.009115102,
    -0.010605193,
    0.034748208,
    0.039262455,
    0.000550054,
    0.018496873,
    0.008239061,
    0.013577346,
    -0.031681478,
    0.006055916,
    -0.033849381
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs",
    "chunk_index": 8,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "eleted to prevent future operations\n+                // After rename, the old namespace should be considered deleted\n+                _metadata.DeletedNamespaces[oldName] = DateTime.UtcNow;\n             }\n         }, cancellationToken).ConfigureAwait(false);\n         \n         await PersistMetadataAsync(cancellationToken).ConfigureAwait(false);\n     }\n@@ -629,91 +815,168 @@ public class AsyncStorageSubsystem : StorageSubsystem, IAsyncStorageSubsystem\n \n     // Private async helper methods\n     \n     private async Task<object[]> ReadPageInternalAsync(long transactionId, string namespaceName, string pageId, CancellationToken cancellationToken)\n     {\n-        return await Task.Run(() =>\n+        try\n         {\n-            cancellationToken.ThrowIfCancellationRequested();\n-            \n-            var transaction = _activeTransactions[transactionId];\n-            var fullPageId = $\"{namespaceName}:{pageId}\";\n-            var namespacePath = GetNamespacePath(namespaceName);\n-            \n-            if (_metadata.PageVersions.TryGetValue(fullPageId, out var pageInfo))\n+            return await Task.Run(() =>\n             {\n-                var allVersions = pageInfo.GetVersionsCopy()\n-                    .Where(v => v <= transaction.SnapshotTSN)\n-                    .OrderByDescending(v => v)\n-                    .ToList();\n+                cancellationToken.ThrowIfCancellationRequested();\n                 \n-                foreach (var version in allVersions)\n+                var transaction = _activeTransactions[transactionId];\n+                var fullPageId = $\"{namespaceName}:{pageId}\";\n+                var namespacePath = GetNamespacePath(namespaceName);\n+                \n+                if (_metadata.PageVersions.TryGetValue(fullPageId, out var pageInfo))\n                 {\n-                    if (_metadata.ActiveTransactions.Contains(version))\n-                        continue;\n+                    var allVersionsBeforeFilter = pageInfo.GetVersionsCopy().ToList();\n+                    \n+                    // CRITICAL FIX: Include own writes regardless of snapshot TSN\n+                    // The transaction must be able to read its own uncommitted writes (read-your-own-writes consistency)\n+                    var allVersions = pageInfo.GetVersionsCopy()\n+                        .Where(v => v == transactionId || v <= transaction.SnapshotTSN)  // Own writes OR within snapshot\n+                        .OrderByDescending(v => v)\n+                        .ToList();\n+                    \n+                    // CONCURRENCY CONTROL: Filter versions based on transaction isolation rules\n+                    \n+                    foreach (var version in allVersions)\n+                    {\n+                        // Check cancellation during each version check for early cancellation\n+                        cancellationToken.ThrowIfCancellationRequested();\n                         \n-                    if (IsVersionRolledBack(version))\n-                        continue;\n+                        // CRITICAL CONCURRENCY FIX: Improved visibility rules for concurrent transactions\n+                        // A transaction can see:\n+                        // 1. Its own writes (version == transactionId)\n+                        // 2. Committed versions within its snapshot TSN (version <= snapshotTSN && not active)\n+                        // 3. Must exclude other concurrent active transactions to maintain isolation\n                         \n-                    var versionFile = Path.Combine(namespacePath, $\"{pageId}{_formatAdapter.FileExtension}.v{version}\");\n-                    if (File.Exists(versionFile))\n-                    {\n-                        var content = File.ReadAllText(versionFile);\n-                        return _formatAdapter.DeserializeArray(content, typeof(object));\n+                        bool isOwnWrite = (version == transactionId);\n+                        bool isFromOtherActiveTransaction = _metadata.ContainsActiveTransaction(version) && version != transactionId;\n+                        bool isRoll"
}