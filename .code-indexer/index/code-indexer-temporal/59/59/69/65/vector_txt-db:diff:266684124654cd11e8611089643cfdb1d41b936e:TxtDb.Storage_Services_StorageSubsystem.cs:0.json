{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/StorageSubsystem.cs:0",
  "vector": [
    -0.000257104,
    0.015584507,
    0.026806412,
    0.017477792,
    0.013640256,
    -0.009278277,
    -0.005232012,
    -0.029646046,
    0.030387294,
    0.004012168,
    0.046126295,
    0.039460402,
    0.068872161,
    -0.00064671,
    -0.075133659,
    -0.04805094,
    0.003408475,
    0.008437599,
    -0.011835509,
    0.029144149,
    -0.059314933,
    -0.049932819,
    -0.040455431,
    0.045517959,
    -0.082159348,
    0.001077874,
    0.020237736,
    0.046936136,
    -0.012905017,
    0.037905093,
    -0.011050413,
    -0.050834477,
    0.011500183,
    0.018718252,
    0.015284029,
    -0.01710777,
    -0.043502461,
    0.005156145,
    -0.018092534,
    0.012685585,
    0.05098512,
    -0.022757923,
    0.04987105,
    0.000122069,
    0.016280524,
    -0.065941356,
    0.036970962,
    0.019723563,
    -0.009359122,
    0.006868183,
    -0.02769495,
    0.010982295,
    -0.015168738,
    0.042905241,
    0.027655695,
    -0.026099186,
    0.069371529,
    0.024934385,
    -0.023273461,
    0.049503587,
    -0.036126696,
    0.024879901,
    0.00484246,
    0.032899518,
    -0.013738744,
    -0.036465537,
    -0.070531152,
    0.059597079,
    0.046263732,
    -0.066188894,
    -3.7904e-05,
    0.015831687,
    0.013774817,
    0.020153312,
    -0.004543567,
    0.026051391,
    0.017571324,
    -0.009047538,
    0.040610965,
    -0.010405178,
    -0.053360809,
    -0.085217588,
    -0.01970179,
    -0.039575886,
    0.016609497,
    -0.029320633,
    0.029732345,
    -0.049580887,
    -0.006116734,
    0.009128159,
    -0.003881006,
    0.067344978,
    0.024950279,
    0.031984217,
    0.033884879,
    0.028243834,
    0.026282471,
    -0.018779403,
    0.04232147,
    -0.009073318,
    0.006048145,
    0.01675207,
    -0.006363439,
    0.053216901,
    -0.031005198,
    -0.012091306,
    0.012488775,
    0.006017323,
    0.012505319,
    0.019285647,
    0.049723607,
    -0.002872617,
    0.017110141,
    -0.011361397,
    0.023323996,
    0.005525317,
    -0.020352514,
    -0.01758201,
    0.031005569,
    0.027532468,
    -0.049871057,
    0.035897553,
    -0.052122597,
    0.067460015,
    -0.023055369,
    0.013279748,
    0.016004557,
    0.019618535,
    0.001978297,
    -0.036867533,
    -0.021058742,
    -0.014029945,
    0.005911333,
    -0.00305613,
    -0.00629872,
    0.019602742,
    0.030095361,
    0.028721936,
    -0.01115145,
    -0.044616863,
    0.040639602,
    -0.008462793,
    0.003549071,
    0.004296229,
    -0.025194915,
    -0.004374051,
    0.042837299,
    -0.000712192,
    0.02169434,
    -0.063845851,
    0.025525397,
    0.052219957,
    -0.020539625,
    0.023678524,
    -0.012188345,
    0.032376185,
    -0.010820663,
    -0.023089288,
    0.012711936,
    -0.018687459,
    -0.050588738,
    0.041473296,
    0.044611085,
    0.018980656,
    -0.03967024,
    0.038475025,
    -0.026142372,
    0.009318748,
    0.004921515,
    -0.016169205,
    -0.061181329,
    0.004088442,
    -0.041587755,
    -0.029637478,
    -0.044525117,
    -0.00343323,
    0.014826737,
    0.003368996,
    -0.074425779,
    -0.066120096,
    0.00870173,
    0.000529874,
    -0.006953607,
    -0.004179377,
    0.004819082,
    -0.034202281,
    0.051333606,
    0.019515146,
    0.027735928,
    -0.004096146,
    -0.016274614,
    -0.001992849,
    -0.018853845,
    -0.024502069,
    0.00493347,
    -0.021030694,
    -0.01497827,
    0.021257773,
    0.040603746,
    0.030978881,
    -0.051773462,
    0.019557808,
    -0.0833266,
    -0.000110048,
    -0.004574721,
    0.014952942,
    -0.003930227,
    -0.029714197,
    -0.004196225,
    0.050545935,
    -0.002405707,
    -0.022216059,
    0.025103377,
    -0.010395597,
    0.001064553,
    -3.2749e-05,
    -0.05384909,
    0.015912173,
    0.06749694,
    0.011066254,
    0.014632188,
    -0.008090651,
    0.059474543,
    0.020031568,
    -0.028678905,
    -0.009743934,
    -0.035987739,
    -0.050467744,
    -0.034499977,
    -0.030043447,
    -0.006554712,
    -0.053985946,
    0.024673225,
    -0.051967148,
    -0.04726889,
    0.048062254,
    -0.003288882,
    -0.024632845,
    -0.007619034,
    0.002033959,
    -0.031635541,
    0.03442008,
    -0.019476756,
    0.011985864,
    -0.02804791,
    0.02735829,
    0.068628237,
    0.022502514,
    0.017752223,
    0.021092532,
    -0.021011256,
    0.052427616,
    -0.011308886,
    0.108766966,
    0.038114224,
    0.005825161,
    0.003083293,
    0.008709177,
    0.029035646,
    0.023446772,
    0.007756351,
    -0.007315456,
    -0.028234325,
    0.038585596,
    -0.002392246,
    0.017790413,
    -0.013683221,
    -0.035913169,
    -0.003678205,
    0.054971743,
    0.025215283,
    -0.004303923,
    0.064499781,
    0.050623182,
    0.011990493,
    -0.016736649,
    0.007659068,
    0.022165557,
    0.009882489,
    0.031908069,
    -0.036152806,
    -0.02439172,
    0.013886103,
    -0.031486765,
    -0.019935066,
    -0.066131182,
    0.016306968,
    -0.037425812,
    0.050424766,
    0.024817478,
    0.02673577,
    -0.012348389,
    -0.005219269,
    -0.061956916,
    0.031660184,
    0.032810114,
    0.01922108,
    -0.022892233,
    0.022863656,
    -0.0149508,
    0.005927172,
    -0.018103728,
    0.067563802,
    0.014240657,
    0.021148048,
    0.0099522,
    0.02402957,
    -0.018618269,
    0.003378976,
    0.005342837,
    -0.051703498,
    -0.001449029,
    0.018299963,
    0.001882338,
    0.049541175,
    -0.056246866,
    -0.001385315,
    -0.015027832,
    -0.021534281,
    0.003277885,
    0.012467413,
    -0.012578662,
    0.019270053,
    -0.048212215,
    0.025680166,
    0.016519234,
    -0.064455219,
    -0.020544162,
    0.057435572,
    -0.021962389,
    -0.023699962,
    -0.002483282,
    -0.005585505,
    0.064783171,
    -0.027019359,
    0.028408237,
    -0.028796844,
    0.019563554,
    -0.048155073,
    0.003850169,
    -0.000964933,
    -0.028960813,
    0.039096765,
    -0.046102867,
    0.046702549,
    -0.027337493,
    -0.008834717,
    -0.012680168,
    -0.011859738,
    0.024850244,
    -0.000627497,
    -0.071597055,
    -0.013159504,
    -0.016252721,
    -0.040561613,
    0.042835318,
    -0.001883382,
    0.009306752,
    0.008111123,
    0.051302258,
    0.052034628,
    0.020998903,
    -0.082005069,
    -0.019899845,
    -0.025460325,
    -0.001116038,
    -0.055020805,
    0.076298922,
    -0.013874468,
    0.027252309,
    -0.068375334,
    -0.040633745,
    -0.061276596,
    -0.005608123,
    -0.005553257,
    0.034679025,
    0.026802216,
    -0.008017504,
    -0.037550543,
    -0.015467759,
    0.014280977,
    0.003057602,
    0.014479859,
    -0.020916834,
    -0.017142437,
    -0.008988163,
    -0.014469957,
    0.016177254,
    -0.003305692,
    0.046330165,
    -0.010596311,
    0.029378941,
    0.011729639,
    0.016493293,
    -0.026372045,
    -0.035787474,
    -0.003565343,
    0.039933328,
    0.017523794,
    -0.044995908,
    0.000506701,
    0.001790421,
    0.044000112,
    -0.055133022,
    0.040780742,
    0.024554532,
    0.027310912,
    0.022987008,
    -0.040082391,
    0.03517136,
    -0.023768242,
    0.021836959,
    -0.001846148,
    0.002172895,
    -0.059058949,
    0.020599851,
    -0.011924985,
    -0.000737491,
    0.025109483,
    0.013058688,
    0.002658586,
    -0.00536446,
    -0.000197357,
    -0.009486664,
    -0.019307671,
    0.024206771,
    0.016745005,
    -0.05055131,
    -0.03941486,
    0.008954069,
    -0.000949566,
    0.014171478,
    -0.063040994,
    0.003996572,
    0.046449479,
    -0.051752679,
    0.039027166,
    -0.011548367,
    -0.041998956,
    -0.008295913,
    -0.013197443,
    -0.029529396,
    0.016942142,
    -0.055805307,
    -0.009928194,
    -0.020351166,
    0.042229358,
    0.032446831,
    -0.044906903,
    -0.070391148,
    -0.032291181,
    -0.013989052,
    -0.026564049,
    -0.000241838,
    0.064250268,
    -0.025900664,
    -0.008219696,
    0.016754853,
    0.016617982,
    -0.01502954,
    -0.036255218,
    -0.046366919,
    -0.000882961,
    0.013119755,
    -0.010843394,
    0.017713951,
    0.017405419,
    -0.052448895,
    -0.023052102,
    -0.005713217,
    0.065538071,
    -0.036124151,
    -0.007148528,
    0.000124523,
    0.04096197,
    0.031374872,
    0.0151217,
    0.041398507,
    -0.035458587,
    -0.022068132,
    -0.001436493,
    -0.051937774,
    -0.029010093,
    -0.050827906,
    -0.00855294,
    0.00931915,
    -0.045094222,
    0.031295709,
    0.015603083,
    -0.028965041,
    -0.018598447,
    -0.025589988,
    -0.004114167,
    -0.015813539,
    0.029949022,
    0.015123497,
    -0.002358812,
    -0.024274137,
    -0.029393474,
    0.03273847,
    0.061850227,
    -0.074732468,
    0.009248614,
    -0.038102008,
    -0.000320775,
    0.038949206,
    0.02751225,
    -0.022529859,
    -0.094010122,
    0.050848905,
    -0.019786431,
    -0.017906964,
    -0.011922862,
    0.038648698,
    0.029087964,
    -0.061062738,
    -0.017783318,
    0.021047331,
    -0.017393149,
    -0.00539112,
    -0.006654667,
    0.005725821,
    -0.023931727,
    -0.046192754,
    0.014438158,
    0.040189046,
    0.009688946,
    0.023228429,
    0.004953656,
    -0.027868453,
    0.004581375,
    0.013173268,
    -0.033570699,
    -0.034670502,
    0.039253797,
    -0.035179917,
    0.028088003,
    0.007503496,
    0.000703055,
    -0.009463095,
    -0.036654778,
    0.007307623,
    0.015007708,
    -0.05718188,
    0.047345817,
    0.008406144,
    -0.000298477,
    -0.008438262,
    0.005116866,
    0.000494064,
    -0.003683321,
    0.060950916,
    0.040575501,
    0.053527772,
    -0.038245928,
    0.053861864,
    0.046001207,
    -0.037259027,
    0.032624628,
    -0.024055842,
    0.035409681,
    0.008745885,
    0.042760946,
    0.03285436,
    0.009066802,
    0.020670224,
    0.046269178,
    0.012272279,
    -0.019604353,
    -0.005641498,
    -0.002979293,
    -0.027777724,
    0.015108919,
    0.014943941,
    -0.021926995,
    0.03938986,
    0.036816847,
    -0.028084081,
    -0.006680646,
    -0.002560354,
    -0.000254733,
    -0.009832095,
    0.013959978,
    -0.008124933,
    -0.003657849,
    -0.046940338,
    0.015311562,
    -0.018875023,
    -0.044350851,
    -0.026184665,
    0.022791842,
    -0.004843363,
    -0.000296261,
    -0.034916043,
    0.038709391,
    0.00168011,
    -0.005345389,
    -0.01908211,
    -0.018218435,
    -0.030016836,
    0.005423934,
    0.030552629,
    0.01107339,
    0.002355597,
    -0.003954271,
    -0.022064552,
    0.034040287,
    -0.037180457,
    0.05117799,
    0.036725555,
    -0.003001225,
    0.01739425,
    0.08682251,
    -0.015490532,
    0.014650463,
    0.030239947,
    -0.007835983,
    -0.067603208,
    -0.008414852,
    0.030225858,
    0.017225601,
    -0.046784565,
    -0.024026373,
    0.016182993,
    -0.007821759,
    -0.015723627,
    0.02547423,
    -0.018197436,
    0.013687371,
    0.003510342,
    -0.027243031,
    0.024790311,
    -0.040226683,
    0.019229677,
    0.004351363,
    0.007649117,
    0.020397266,
    0.003386936,
    0.019058943,
    0.013952013,
    0.042755958,
    -0.031695433,
    -0.009895322,
    0.031687874,
    0.034749717,
    0.015034985,
    0.032066815,
    -0.064443104,
    -0.020722052,
    0.017511999,
    -0.01098822,
    0.00962365,
    0.083655596,
    0.063660502,
    0.052929729,
    0.0270002,
    0.028673951,
    -0.014531841,
    0.000737653,
    -0.001891716,
    -0.008851393,
    -0.047824282,
    -0.052689414,
    0.010766826,
    0.040339977,
    -0.034407504,
    -0.01198811,
    0.047688678,
    -0.020030528,
    -0.043756377,
    -0.016004348,
    0.004654256,
    -0.037780784,
    -0.025108512,
    -0.001550015,
    0.002215608,
    0.00457343,
    0.010211229,
    -0.031733409,
    -0.009484543,
    0.054071832,
    0.085207708,
    -0.016520962,
    -0.0077174,
    -0.059226975,
    0.003681136,
    -0.01462921,
    0.002526847,
    -0.022229949,
    0.026593652,
    0.009563133,
    -0.023561023,
    0.071659863,
    -0.018654794,
    0.001572738,
    0.002784128,
    0.016448058,
    -0.008271893,
    -0.048782043,
    -0.039428554,
    -0.01433252,
    0.055622447,
    -0.01312065,
    0.022450067,
    -0.000343086,
    -0.01495102,
    0.020125287,
    -0.031102901,
    0.038004998,
    0.013030912,
    -0.014128231,
    0.000379736,
    0.013925337,
    0.005658873,
    -0.002338253,
    0.000150716,
    -0.039707359,
    -0.043904241,
    -0.011676644,
    0.012304248,
    0.025792658,
    -0.027142834,
    -0.038123,
    -0.009076307,
    0.009443533,
    0.019372581,
    0.011977092,
    0.014999771,
    0.046080031,
    -0.017802536,
    -0.022150224,
    0.013649047,
    0.00670055,
    0.047540184,
    -0.065394484,
    -0.004019853,
    -0.031468913,
    0.001003333,
    -0.035388499,
    0.00808441,
    -0.001037217,
    0.020543249,
    -0.037867997,
    -0.003815176,
    0.013541758,
    -0.014059564,
    -0.024687998,
    0.017440006,
    -0.003433072,
    -0.072031736,
    -0.016692499,
    0.012898304,
    -0.020716878,
    -0.001396896,
    0.000546047,
    -0.009982649,
    -0.047114909,
    0.010136683,
    0.000951844,
    0.028844414,
    -0.026414553,
    0.010550288,
    -0.005366969,
    -0.050245937,
    -0.029701054,
    -0.037655074,
    0.009771848,
    -0.004758157,
    -0.083308421,
    -0.004731052,
    -0.035505522,
    -0.01244661,
    -0.013031076,
    0.046835072,
    -0.051712319,
    -0.039446775,
    0.061874293,
    0.006224149,
    -0.040328547,
    -0.003730114,
    -0.026980398,
    -0.012257473,
    0.02596637,
    -0.011182936,
    -0.04331613,
    0.001585806,
    0.023696342,
    0.05151676,
    -0.016762914,
    -0.058680315,
    0.035918966,
    -0.00661997,
    -0.037888519,
    0.015948597,
    0.034598287,
    -0.013160041,
    -0.020187922,
    -0.016029434,
    0.009839114,
    -0.009500811,
    -0.055840194,
    0.051369544,
    0.023667295,
    0.036731128,
    -0.020072969,
    -0.007539564,
    0.031133883,
    0.012043188,
    0.02595745,
    0.048382785,
    0.017715463,
    -0.001901953,
    -0.040880658,
    -0.044817287,
    0.047196884,
    -0.010666313,
    -0.082936205,
    0.011472852,
    -0.004627061,
    -0.009876548,
    0.010594588,
    0.016408253,
    -0.007130824,
    0.028754609,
    -0.016962346,
    -0.001824901,
    -0.022875333,
    0.017454838,
    -0.023146767,
    0.003326075,
    -0.043986756,
    0.025311112,
    -0.001151483,
    -0.009082619,
    0.017611714,
    0.009638941,
    -0.037744872,
    0.066281058,
    0.004930864,
    -0.004109846,
    -0.003450421,
    -0.020171672,
    0.020347642,
    0.007583383,
    -0.038190991,
    -0.081767969,
    -0.020584172,
    0.013425373,
    -0.018232217,
    0.039203413,
    -0.011457306,
    -0.028185062,
    -0.016868779,
    0.00354988,
    -0.012374693,
    0.062378056,
    0.012828415,
    0.04201261,
    -0.054196335,
    -0.044838745,
    0.079979368,
    0.013169027,
    -0.007933959,
    -0.003833521,
    -0.045391887,
    -0.054936536,
    -0.021247929,
    0.01156961,
    -0.036100477,
    0.009973656,
    -0.00707668,
    0.003195876,
    -0.057832733,
    -0.019711979,
    0.022227956,
    0.026499698,
    0.028410235,
    -0.020803707,
    -0.070933148,
    0.005866213,
    -0.018911749,
    0.003607858,
    0.03134517,
    0.022870379,
    0.017752793,
    -0.025512725,
    -0.012848982,
    -0.012840194,
    -0.02088959,
    0.018578613,
    -0.025072001,
    0.005934232,
    5.1979e-05,
    0.063086033,
    0.040843181,
    0.039858934,
    0.016184559,
    -0.019708712,
    -0.021410855,
    0.001645133,
    0.000203906,
    0.063996062,
    -0.063792571,
    0.0455723,
    0.037217684,
    0.006435617,
    -0.006548143,
    0.019922715,
    0.016011411,
    0.049082275,
    0.006142086,
    -0.030793553,
    0.00558871,
    -0.016190587,
    0.010152722,
    0.00895191,
    0.054799933,
    0.029031575,
    0.021392714,
    -0.021568311,
    0.004989976,
    -0.027554279,
    -0.015853344,
    0.005742903,
    0.045682371,
    0.017451864,
    -0.062920861,
    -0.010569715,
    -0.042710062,
    0.015725939,
    -0.03301964,
    -0.014241949,
    -0.019763689,
    0.023674009,
    0.030972263,
    -0.007180676,
    -0.009419534,
    0.04299463,
    0.016836779,
    -0.024447158,
    0.003124778,
    -0.038618494,
    -0.064785101,
    -0.003539293,
    -0.049750555,
    0.002011358,
    0.006424284,
    0.044219475,
    0.002027326,
    -0.059058793,
    -0.002566045,
    -0.017277412,
    0.018967502,
    0.006708398,
    0.013470874,
    -0.011893111,
    -0.04775269,
    -0.026742036,
    -0.053412057,
    -0.016976198,
    -0.02173168,
    -0.008647786,
    0.050788939,
    0.007344759,
    0.017833963,
    0.002945748,
    0.052234497,
    0.043091699,
    0.001471657,
    0.052164033,
    0.031924982,
    -0.038651418,
    -0.066066049,
    -0.022644931,
    -0.005346159,
    -0.033063762,
    0.055083748,
    0.013907525,
    -0.048940059,
    0.001402245,
    0.038781147,
    0.006615667,
    0.021184262,
    -0.017442215,
    0.007125904,
    -0.045372523,
    -0.029830825,
    0.009730147,
    -0.004143057,
    -0.005079402,
    0.00288527,
    0.022728607,
    0.038160775,
    0.018061079,
    -0.035171259,
    -0.00199464,
    -0.014730313,
    -0.034768682,
    0.018291008,
    -0.030046433,
    0.019906715,
    -0.018674193,
    0.020294817,
    -0.010428073,
    0.01033397,
    -0.016206197,
    0.00394941,
    0.004637693,
    0.025920745,
    0.032369614,
    0.036744654,
    0.025456009,
    0.011583453,
    0.032098077,
    -0.032562003,
    0.031349029,
    0.052076779,
    -0.001606724,
    0.013723269,
    -0.003045267,
    0.017780589,
    -0.028622577,
    0.003662458,
    -0.017224817
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/StorageSubsystem.cs",
    "chunk_index": 0,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "@@ -57,23 +57,26 @@ public class StorageSubsystem : IStorageSubsystem, IDisposable\n     public long BeginTransaction()\n     {\n         lock (_metadataLock)\n         {\n             var transactionId = _nextTransactionId++;\n+            // CRITICAL FIX: Update CurrentTSN first, then use it as snapshot TSN\n+            // This allows the transaction to see its own writes (version = transactionId)\n+            _metadata.CurrentTSN = Math.Max(_metadata.CurrentTSN, transactionId);\n+            \n             var transaction = new MVCCTransaction\n             {\n                 TransactionId = transactionId,\n                 // CRITICAL FIX: For proper MVCC, snapshot TSN should be set to the highest\n                 // committed transaction at the time this transaction begins\n                 // This allows read-committed isolation level\n-                SnapshotTSN = _metadata.CurrentTSN,\n+                SnapshotTSN = _metadata.CurrentTSN, // Now includes current transaction\n                 StartTime = DateTime.UtcNow\n             };\n \n             _activeTransactions.TryAdd(transactionId, transaction);\n-            _metadata.ActiveTransactions.Add(transactionId);\n-            _metadata.CurrentTSN = Math.Max(_metadata.CurrentTSN, transactionId);\n+            _metadata.AddActiveTransaction(transactionId);\n             \n             PersistMetadata();\n             return transactionId;\n         }\n     }\n@@ -115,11 +118,11 @@ public class StorageSubsystem : IStorageSubsystem, IDisposable\n                 }\n             }\n \n             // Mark transaction as committed\n             transaction.IsCommitted = true;\n-            _metadata.ActiveTransactions.Remove(transactionId);\n+            _metadata.RemoveActiveTransaction(transactionId);\n             _activeTransactions.TryRemove(transactionId, out _);\n             \n             PersistMetadata();\n         }\n     }\n@@ -148,11 +151,11 @@ public class StorageSubsystem : IStorageSubsystem, IDisposable\n                     File.Delete(versionFile);\n                 }\n             }\n \n             transaction.IsRolledBack = true;\n-            _metadata.ActiveTransactions.Remove(transactionId);\n+            _metadata.RemoveActiveTransaction(transactionId);\n             _activeTransactions.TryRemove(transactionId, out _);\n             \n             PersistMetadata();\n         }\n     }\n@@ -220,16 +223,27 @@ public class StorageSubsystem : IStorageSubsystem, IDisposable\n         ValidateNamespace(@namespace);\n         \n         var transaction = _activeTransactions[transactionId];\n         var fullPageId = $\"{@namespace}:{pageId}\";\n         \n-        // CRITICAL: Enforce read-before-write rule for ACID isolation\n+        // CRITICAL MVCC FIX: Enforce read-before-write for ACID isolation compliance\n+        // This is a fundamental MVCC requirement to prevent lost updates and ensure proper transaction isolation.\n+        // The test MVCCIsolationTests.UpdatePage_WithoutPriorRead_ShouldThrowReadBeforeWriteViolation expects this.\n+        // \n+        // However, we need to allow legitimate cases where a page was read in the same transaction.\n+        // If the transaction has already recorded reading this page, allow the update.\n+        // This supports both:\n+        // 1. MVCC isolation requirements (direct UpdatePage calls must have prior reads)  \n+        // 2. Table layer operations (which read pages internally before updates)\n+        \n         if (!transaction.ReadVersions.ContainsKey(fullPageId))\n         {\n             throw new InvalidOperationException(\n-                $\"Cannot update page '{pageId}' in namespace '{@namespace}' without reading it first \" +\n-                $\"in transaction {transactionId}. ACID isolation requires read-before-write for updates.\");\n+                $\"MVCC ACID isolation violation: Cannot update page '{pageId}' in namespace '{@namespace}' \" +\n+                $\"without a prior read-before-write in the same transaction. \" +\n+                $\"This violates ACID isolation guarantees and could lead to lost updates. \" +\n+                $\"Read the pa"
}