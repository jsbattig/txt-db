{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/BatchFlushCoordinator.cs:0",
  "vector": [
    -0.008013585,
    -0.001250661,
    0.00159674,
    0.064891748,
    -0.059014279,
    -0.017876932,
    -0.027523885,
    -0.008229027,
    0.062863238,
    -0.01188754,
    0.035432547,
    0.019007463,
    0.042652272,
    -0.049800429,
    -0.060620528,
    -0.022664927,
    0.034636006,
    -0.032294974,
    -0.034270812,
    -0.012715279,
    -0.03668309,
    -0.053759191,
    -0.090698831,
    0.036314171,
    -0.04287615,
    -0.014296989,
    0.021624301,
    0.049749017,
    -0.005547755,
    0.04718978,
    -0.043245673,
    -0.044386897,
    -0.008473236,
    0.03267546,
    0.005777042,
    -0.00424408,
    -0.047337871,
    0.006389334,
    0.009806321,
    0.022288399,
    0.030764438,
    0.006175749,
    0.020645175,
    -0.055790134,
    0.011380062,
    -0.056221377,
    0.050099056,
    0.003061824,
    0.023535915,
    -0.011813222,
    -0.020799944,
    0.014395217,
    -0.01644823,
    0.006803788,
    -0.009217815,
    -0.038928043,
    0.074033841,
    0.012680521,
    -0.038480856,
    0.030692099,
    0.002804123,
    -0.007703362,
    -0.019926431,
    0.077751167,
    -0.037620347,
    -0.01024999,
    -0.050706413,
    0.027290406,
    -0.003132903,
    -0.093144134,
    0.013907571,
    0.046067551,
    -0.031749625,
    -0.01462785,
    0.020252496,
    0.030866129,
    0.013750679,
    0.013325636,
    0.008950382,
    0.003458645,
    -0.019971685,
    -0.040413711,
    0.002775786,
    -0.00994149,
    0.059146263,
    -0.024680685,
    0.016347017,
    -0.082530394,
    -0.004061508,
    0.043948825,
    -0.026355959,
    0.007635405,
    0.02483033,
    0.011064081,
    0.030957522,
    -0.011017657,
    0.031779576,
    -0.000383011,
    -0.00154478,
    -0.016885901,
    0.019195622,
    0.02909361,
    -0.024980456,
    0.031344291,
    -0.052604567,
    0.006065379,
    -0.015842397,
    -0.047820456,
    0.01223837,
    0.018090665,
    0.021586055,
    0.022757376,
    -0.026501924,
    0.008673783,
    0.012326489,
    -0.005987342,
    -0.017058002,
    -0.017600834,
    0.009056509,
    0.053375974,
    -0.030106453,
    0.035993468,
    -0.04457809,
    0.048651364,
    -0.024169078,
    0.041407701,
    0.027163427,
    0.035094772,
    0.036355354,
    -0.033637702,
    0.012780487,
    -0.00837901,
    -0.024467481,
    0.013766292,
    -0.018502871,
    0.038468406,
    0.045961551,
    0.012791955,
    0.004113921,
    -0.030163452,
    0.017012833,
    0.000594973,
    -0.029294142,
    0.023628147,
    0.011083513,
    0.06625697,
    0.037720073,
    -0.005253891,
    -0.006513343,
    -0.057638377,
    0.004186441,
    0.049994715,
    -0.015381165,
    0.008625023,
    0.021606807,
    0.040142871,
    -0.036573067,
    -0.035519738,
    -0.00925893,
    0.02487096,
    -0.060283434,
    0.024851121,
    -0.011932714,
    0.00708113,
    -0.040988427,
    0.047456101,
    -0.003426687,
    -0.001825127,
    0.051138423,
    -0.053279653,
    -0.043564286,
    0.062649615,
    -0.081083514,
    -0.023411147,
    0.008022339,
    0.031535387,
    -0.00936808,
    0.022489803,
    -0.070621356,
    -0.014405382,
    0.035713013,
    -0.011930732,
    -0.01383547,
    -0.003639804,
    0.021796048,
    -0.027868815,
    0.023826551,
    0.011258658,
    -0.013526584,
    -0.035691801,
    -0.005734548,
    0.013288263,
    -0.016571909,
    -0.029064314,
    -0.017867243,
    -0.021795247,
    0.001883654,
    0.011809045,
    0.013722463,
    0.035590447,
    -0.054320347,
    0.018160904,
    -0.080598094,
    -0.033107545,
    -0.000395343,
    0.010326285,
    -0.034492414,
    -0.02337892,
    0.006135674,
    -0.009137116,
    -0.004693415,
    0.017616795,
    -0.000912428,
    -0.007222751,
    0.006188938,
    -0.022626506,
    -0.036049753,
    -0.025793241,
    0.016278425,
    -0.027136197,
    -0.030585,
    0.00581983,
    0.074145675,
    0.060754672,
    -0.017145483,
    -0.049510267,
    -0.046949342,
    -0.049015168,
    -0.007648554,
    -0.019435162,
    0.013194697,
    -0.051926147,
    0.014612794,
    -0.008393548,
    -0.035114832,
    0.067696527,
    -0.026686873,
    -0.047116783,
    -0.010501546,
    -0.012454859,
    0.006914008,
    0.048773978,
    0.020641677,
    0.012299329,
    -0.050134268,
    -0.007193515,
    0.083415069,
    -0.037058908,
    0.021385182,
    0.023907844,
    -0.012867013,
    0.032316025,
    -0.028296318,
    0.085652158,
    0.057312325,
    0.012030557,
    -0.006347308,
    0.015518486,
    0.03202875,
    0.020015944,
    -0.003648147,
    0.012373068,
    -0.012183782,
    -0.005806653,
    0.006519474,
    0.031100782,
    -0.038860071,
    -0.018420324,
    0.005251619,
    0.036818642,
    0.019427476,
    -0.010408131,
    0.030637497,
    0.01329473,
    0.009643685,
    -0.023972625,
    0.01958105,
    0.019046146,
    0.01299689,
    0.028135015,
    -0.031717416,
    -0.000348747,
    2.2908e-05,
    -0.037067678,
    -0.031662017,
    -0.016803747,
    -0.004034145,
    -0.003633256,
    0.016861791,
    0.00520997,
    0.01603399,
    0.021202276,
    -0.033037946,
    -0.005995688,
    0.049844597,
    0.040482216,
    0.015240727,
    -0.029816559,
    0.027320884,
    0.001089535,
    -0.006588758,
    -0.003633275,
    0.07951881,
    0.038569693,
    0.002515522,
    -0.0210276,
    0.02132044,
    -0.040856909,
    0.026009601,
    -0.003973571,
    -0.050526168,
    -0.010563534,
    0.005526129,
    0.014370132,
    0.040898476,
    -0.058076285,
    -0.029758113,
    -0.017312773,
    -0.004294386,
    -0.002658637,
    -0.00040828,
    -0.019495972,
    0.021117803,
    -0.020467237,
    0.008223195,
    0.011096966,
    -0.077550612,
    -0.039957874,
    0.039484445,
    -0.043024067,
    -0.009859413,
    0.00503099,
    -0.032728624,
    0.063185006,
    -0.009155294,
    0.001793037,
    -0.013603829,
    0.002652198,
    -0.0296674,
    0.027643995,
    -0.016001139,
    -0.009308103,
    0.002663977,
    -0.031900119,
    0.058017217,
    -0.001927798,
    -0.015580691,
    -0.02689494,
    -0.012092249,
    0.033102345,
    -0.005309652,
    -0.063864909,
    -0.007174661,
    0.025203848,
    -0.028345617,
    0.040728081,
    -0.04873243,
    0.010767994,
    0.010337458,
    0.024351798,
    0.032599732,
    0.011881339,
    -0.06726025,
    -0.002362924,
    0.003811206,
    -0.014302493,
    -0.014060888,
    0.049048662,
    -0.061926879,
    0.02911072,
    -0.025554823,
    -0.086534001,
    -0.039810717,
    0.052293967,
    -0.00757212,
    0.010094878,
    0.047514923,
    -0.022008782,
    0.003081207,
    -0.044400387,
    -0.028500408,
    -0.006488152,
    0.008123802,
    -0.006897481,
    -0.015841143,
    -0.011079126,
    0.032584731,
    0.013609165,
    -0.021071734,
    0.0454298,
    -0.014560514,
    0.025539258,
    0.024274856,
    -0.003984002,
    0.001292011,
    -0.020820824,
    0.010073387,
    0.020387663,
    0.020554844,
    0.004399863,
    0.018028772,
    -0.018939715,
    0.067475066,
    -0.046228878,
    0.017329348,
    -0.001831626,
    0.01150958,
    0.00801399,
    -0.008006155,
    0.023801843,
    -0.007135639,
    0.028757799,
    0.00889428,
    0.024188595,
    0.003018642,
    0.03664932,
    -0.010136921,
    0.022084385,
    -0.005406097,
    -0.027177149,
    -0.019102693,
    -0.020660797,
    0.022955623,
    -0.034963772,
    -0.016703365,
    -0.010119432,
    0.01783666,
    -0.07869719,
    -0.00993808,
    -0.005231169,
    -0.00416998,
    -0.015140013,
    -0.026566375,
    0.011622609,
    0.048114546,
    -0.022049876,
    0.024739109,
    -0.048807055,
    -0.028865175,
    -0.038786039,
    -0.015913695,
    -0.033191022,
    0.057553776,
    -0.021454953,
    0.016892146,
    -0.034579527,
    -0.003056714,
    0.074725203,
    -0.037936807,
    -0.041793238,
    -0.03994501,
    0.019131249,
    -0.030239809,
    -0.003129191,
    0.024047986,
    -0.025643494,
    -0.034975097,
    0.054352362,
    0.007576979,
    -0.004893559,
    -0.018018279,
    0.001244632,
    -0.005463701,
    0.002154934,
    -0.017909085,
    0.025373567,
    0.01676677,
    -0.027727066,
    -0.011473121,
    -0.013356084,
    0.068264894,
    -0.012703337,
    -0.016930232,
    -0.0043369,
    0.041790266,
    0.033280555,
    -0.00772291,
    0.093931928,
    -0.00943495,
    -0.012947019,
    -0.03752299,
    -0.02736645,
    -0.031668775,
    -0.015720626,
    -0.023294194,
    0.02496477,
    -0.028951021,
    0.058235526,
    0.062969401,
    -0.006274492,
    0.000434014,
    -0.032053892,
    0.014054819,
    -0.021575218,
    0.036543056,
    0.001400099,
    0.002850303,
    -0.002169697,
    -0.038464587,
    0.039256807,
    0.049197584,
    -0.077422589,
    0.028009329,
    0.00097304,
    -0.039598007,
    0.06185643,
    0.007308918,
    2.7331e-05,
    -0.097231008,
    0.024594979,
    -0.045918744,
    -0.006343703,
    -0.02681971,
    0.02917791,
    0.006215881,
    -0.014867006,
    -0.046835456,
    0.0184951,
    0.011772532,
    -0.03604047,
    0.007351127,
    0.041524366,
    -0.006950221,
    -0.113734834,
    0.016564561,
    -0.022738369,
    0.030995375,
    0.001059157,
    0.007220976,
    -0.009211619,
    -0.003343405,
    0.036355838,
    -0.037294071,
    -0.039482012,
    0.011284755,
    -0.007385567,
    0.03836406,
    -0.017737238,
    0.013541006,
    -0.012884264,
    -0.018182494,
    -0.020214584,
    -0.030276228,
    -0.055983342,
    0.008076209,
    0.008945487,
    0.030503344,
    0.034021396,
    0.003290938,
    5.5e-06,
    0.003777485,
    0.025198542,
    0.049604256,
    0.043478027,
    0.001173821,
    0.066005491,
    0.015918463,
    -0.001257022,
    0.077148825,
    -0.037122831,
    0.029026512,
    0.024223313,
    0.007129256,
    0.017861441,
    -0.027030356,
    0.016754258,
    0.006590658,
    -0.000816317,
    0.002215714,
    -0.021156002,
    0.00393731,
    -0.033712067,
    -0.023619661,
    0.00954688,
    0.031037949,
    0.021948414,
    0.044951007,
    -0.030130951,
    -0.031885389,
    -0.039271403,
    -0.0015779,
    0.001250388,
    -0.004959263,
    0.011089343,
    -0.044008579,
    -0.039335582,
    0.015455052,
    -0.005121212,
    -0.038167488,
    0.004874228,
    0.01277123,
    -0.010373002,
    0.011228642,
    -0.045950811,
    0.067947499,
    0.008457375,
    -0.012871043,
    -0.00618011,
    -0.032025777,
    -0.016417213,
    0.013111743,
    0.010373895,
    0.057466805,
    0.020632967,
    -0.011524498,
    -0.016310766,
    0.038508065,
    0.009020869,
    0.054276716,
    0.017717419,
    0.009838265,
    0.024977826,
    0.038883422,
    -0.004730443,
    0.03147791,
    0.031344675,
    0.029176705,
    -0.056228396,
    0.012630598,
    0.05894658,
    -0.004201228,
    -0.040139683,
    0.000132865,
    -0.001221326,
    -0.006307677,
    0.001519763,
    0.032482266,
    -0.031730868,
    -0.003746861,
    -0.000305845,
    0.005662724,
    0.004556613,
    -0.067950979,
    0.027183702,
    0.032606237,
    -0.000126917,
    0.023748226,
    -0.004439505,
    0.016831148,
    -0.00503495,
    -0.017043378,
    -0.018415747,
    0.024457084,
    0.055344496,
    0.016840711,
    0.021635678,
    0.033925582,
    -0.043671638,
    -0.029688979,
    0.045282818,
    0.042257156,
    0.019604361,
    0.098205097,
    0.035715874,
    0.048809331,
    0.016213113,
    0.010754501,
    -0.029365376,
    -0.010374882,
    -0.017286401,
    0.012199628,
    -0.00352672,
    -0.026467122,
    0.049629394,
    0.033086073,
    -0.015162671,
    -0.029605744,
    0.019186167,
    -0.034266096,
    -0.020423479,
    -0.03735286,
    0.032901026,
    -0.025951346,
    -0.036723778,
    -0.02123124,
    0.004468485,
    -0.006313386,
    0.023705631,
    0.011074024,
    -0.009899084,
    0.024419753,
    0.066292778,
    -0.000572239,
    0.011210861,
    -0.034782603,
    -0.013491256,
    -0.050686911,
    0.018915411,
    0.000712475,
    -0.018710215,
    0.014945456,
    -0.002693621,
    0.075807989,
    -0.027305862,
    0.015681924,
    -0.002993358,
    -0.017951947,
    -0.015399875,
    -0.032558776,
    -0.06761653,
    0.004518179,
    0.060612928,
    -0.017863842,
    0.01364217,
    0.020251982,
    -0.015339782,
    -0.006352251,
    0.012922907,
    0.041860148,
    0.028026575,
    -0.014909192,
    -0.05156187,
    0.019936059,
    0.018114451,
    0.028530296,
    -0.004026326,
    -0.022450145,
    -0.016799333,
    0.00062321,
    -0.007049373,
    -0.017187158,
    0.003945703,
    -0.035422951,
    -0.01086997,
    0.007321933,
    -0.001547217,
    -0.008124369,
    -0.004468874,
    0.066033691,
    -0.029897891,
    -0.048883922,
    -0.012065831,
    0.02379578,
    0.005313704,
    -0.06251467,
    0.025843021,
    -0.055605013,
    -0.000813734,
    -0.047269423,
    0.007666816,
    0.019562311,
    0.040374421,
    -0.02546737,
    0.011992568,
    0.02164091,
    0.007182525,
    -0.002799861,
    0.056439642,
    0.005920897,
    -0.07692194,
    -0.030589238,
    -0.011028647,
    -0.001925371,
    -0.014082263,
    0.060470436,
    -0.026386414,
    -0.024504663,
    0.071306042,
    -0.007669792,
    0.020783847,
    -0.02975107,
    0.012461152,
    0.002236884,
    -0.037003219,
    -0.047739357,
    -0.035105493,
    0.011533147,
    0.004777857,
    -0.06702555,
    -0.013212691,
    -0.028699461,
    -0.004038328,
    -0.014391915,
    -0.002391293,
    -0.015374171,
    -0.026030848,
    0.033756047,
    0.023665609,
    -0.002321727,
    -0.023791794,
    -0.008512892,
    0.001574386,
    0.018972659,
    -0.009748471,
    -0.04576702,
    0.037913162,
    -0.000130015,
    0.035437804,
    -0.01920783,
    -0.063237019,
    0.055768933,
    -0.002763183,
    -0.016400667,
    0.028762005,
    -0.015139915,
    0.000903583,
    -0.030164842,
    -0.012925796,
    0.007770413,
    -0.016502613,
    -0.051998969,
    0.067439534,
    0.031666324,
    0.034112759,
    -0.034285743,
    -0.027199667,
    0.031415075,
    -0.038714841,
    0.012771336,
    0.029890981,
    0.019226557,
    0.004271774,
    -0.009650527,
    -0.010768861,
    0.046018008,
    -0.034771737,
    -0.057704128,
    0.038339451,
    0.026010517,
    -0.008723791,
    -0.007102801,
    -0.028122285,
    0.005744948,
    0.03122092,
    -0.029135123,
    0.006635863,
    0.008850948,
    -0.004699235,
    0.001478086,
    -0.028465513,
    -0.027427871,
    0.038855519,
    -0.010721561,
    -0.025353987,
    0.04125214,
    0.005893598,
    0.029823288,
    0.034706235,
    0.01413085,
    -0.03615386,
    0.017453298,
    0.012709117,
    0.048026461,
    0.042136781,
    -0.040712271,
    -0.064582221,
    -0.005895175,
    0.013579105,
    0.012539006,
    0.043192998,
    0.022284152,
    -0.002467657,
    -0.001048128,
    -0.008426347,
    -0.027251365,
    0.096027814,
    -0.032799825,
    0.016888577,
    -0.066062734,
    -0.005455463,
    0.063119344,
    0.013077974,
    -0.01358138,
    0.017693523,
    -0.011097265,
    -0.03747201,
    -0.015982939,
    -0.008800299,
    -0.061861482,
    -0.037497513,
    -0.011779099,
    -0.017945504,
    -0.044969,
    -0.02212731,
    0.031559024,
    -0.004903777,
    -0.000742947,
    -0.010296699,
    -0.009123261,
    0.004925625,
    0.003949216,
    0.018959085,
    0.015285711,
    0.014421812,
    0.020954473,
    0.003206245,
    -0.053187069,
    -0.052632611,
    -0.010093641,
    0.041864466,
    -0.05835082,
    -5.1666e-05,
    -0.022724712,
    0.002223519,
    0.003650272,
    0.025734523,
    0.032938831,
    -0.008189074,
    -0.002804134,
    0.024221817,
    -0.012383407,
    0.002775074,
    -0.035408195,
    0.034735307,
    0.046680138,
    0.018122856,
    0.033565063,
    0.000769073,
    0.026337553,
    0.030899966,
    0.019328207,
    -0.049122639,
    0.017616054,
    -0.046893205,
    -0.008536341,
    0.00974313,
    0.010310891,
    0.033088077,
    -0.015344206,
    -0.060158603,
    -0.010482559,
    -0.024589738,
    0.011528561,
    0.032859966,
    0.00670948,
    -0.03817771,
    -0.049864888,
    -0.039650708,
    0.001121975,
    0.040893655,
    -0.028545478,
    -0.013238073,
    -0.044310395,
    -0.018980123,
    0.006718698,
    -0.019708162,
    0.022206141,
    0.026734062,
    0.032985132,
    -0.040790223,
    0.022377456,
    -0.054656412,
    -0.035569742,
    -0.049361892,
    -0.066492669,
    0.022329526,
    0.004066781,
    -0.005406705,
    -0.020920286,
    0.011705182,
    0.008885324,
    -0.018173413,
    0.027357638,
    0.021951536,
    0.018913254,
    0.02408706,
    -0.043563388,
    -0.027810158,
    -0.051678088,
    0.00979759,
    -0.000937626,
    -0.00783594,
    0.049366407,
    0.022461277,
    -0.004378458,
    -0.043346941,
    0.049674898,
    0.020412164,
    0.022898529,
    0.036126129,
    0.015097693,
    -0.018127646,
    -0.018921476,
    -0.023575904,
    -0.048780233,
    0.001830838,
    0.01585521,
    -0.017129852,
    -0.063397728,
    -0.001392668,
    0.016167492,
    0.014449806,
    0.041442957,
    -0.03953496,
    0.000492729,
    -0.053495001,
    -0.036165856,
    0.032801174,
    -0.058988411,
    -0.021820849,
    -0.044163577,
    0.035870217,
    -0.003582486,
    0.021586217,
    -0.008405535,
    0.003782441,
    -0.027794836,
    0.00424243,
    -0.003230384,
    0.004802826,
    0.025749441,
    0.004586764,
    0.006806348,
    0.003540686,
    -0.004434175,
    -0.036764305,
    0.016969811,
    -0.015995437,
    0.03814926,
    0.012781825,
    -0.017460166,
    0.007186964,
    0.005933951,
    0.016380321,
    -0.00265974,
    -0.002684982,
    0.056464028,
    -0.035026863,
    0.022506518,
    -0.034613557,
    0.010443041,
    -0.049927756,
    0.022073431,
    -0.064492762
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/BatchFlushCoordinator.cs",
    "chunk_index": 0,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "@@ -29,10 +29,20 @@ public class BatchFlushCoordinator : IDisposable\n     \n     // Performance tracking\n     private long _batchCount;\n     private long _actualFlushCount;\n     private readonly object _statsLock = new object();\n+    \n+    // Circuit breaker for continuous failures\n+    private int _consecutiveFailures;\n+    private DateTime _lastFailureTime;\n+    private bool _circuitBreakerOpen;\n+    private readonly object _circuitBreakerLock = new object();\n+    \n+    // Circuit breaker configuration\n+    private const int MaxConsecutiveFailures = 5;\n+    private static readonly TimeSpan CircuitBreakerTimeout = TimeSpan.FromSeconds(30);\n \n     /// <summary>\n     /// Maximum number of requests to batch together\n     /// </summary>\n     public int MaxBatchSize => _config.MaxBatchSize;\n@@ -117,17 +127,145 @@ public class BatchFlushCoordinator : IDisposable\n         if (!_isRunning)\n             return;\n \n         _isRunning = false;\n         \n-        // Signal completion and wait for background processor to finish\n-        _writer.Complete();\n+        // CRITICAL FIX: Handle channel completion exceptions properly\n+        // The channel may already be completed or closed, which would throw ChannelClosedException\n+        try\n+        {\n+            _writer.Complete();\n+        }\n+        catch (InvalidOperationException)\n+        {\n+            // Channel is already completed - this is expected in some scenarios\n+        }\n         \n         if (_backgroundProcessor != null)\n         {\n-            _cancellationTokenSource.Cancel();\n-            await _backgroundProcessor.ConfigureAwait(false);\n+            try\n+            {\n+                _cancellationTokenSource.Cancel();\n+                await _backgroundProcessor.ConfigureAwait(false);\n+            }\n+            catch (TaskCanceledException)\n+            {\n+                // Expected when canceling background processor (TaskCanceledException is derived from OperationCanceledException)\n+            }\n+            catch (OperationCanceledException)\n+            {\n+                // Expected when canceling background processor\n+            }\n+        }\n+    }\n+\n+    /// <summary>\n+    /// Forces immediate flush of all pending batches and queued requests.\n+    /// Used for critical operations that require immediate durability guarantees.\n+    /// This bypasses batching delays and processes all pending requests immediately.\n+    /// </summary>\n+    /// <param name=\"cancellationToken\">Cancellation token</param>\n+    /// <returns>Task that completes when all pending flushes are complete</returns>\n+    public async Task ForceFlushAllPendingAsync(CancellationToken cancellationToken = default)\n+    {\n+        ThrowIfDisposed();\n+        \n+        if (!_isRunning)\n+            return; // Nothing to flush if not running\n+            \n+        // Send a high-priority signal to flush all pending requests immediately\n+        // by queuing a critical request that will trigger immediate batch processing\n+        var forceFlushRequest = new FlushRequest(\"__FORCE_FLUSH_ALL__\", FlushPriority.Critical);\n+        \n+        if (await _writer.WaitToWriteAsync(cancellationToken).ConfigureAwait(false))\n+        {\n+            await _writer.WriteAsync(forceFlushRequest, cancellationToken).ConfigureAwait(false);\n+            \n+            // Wait for the force flush to complete\n+            await forceFlushRequest.CompletionSource.Task.ConfigureAwait(false);\n+        }\n+    }\n+\n+    /// <summary>\n+    /// Forces immediate flush of a file, bypassing the batching queue entirely.\n+    /// Used for critical operations that require immediate durability guarantees.\n+    /// </summary>\n+    /// <param name=\"filePath\">Path to file to be flushed immediately</param>\n+    /// <param name=\"cancellationToken\">Cancellation token</param>\n+    /// <returns>Task that completes when the file has been flushed</returns>\n+    public async Task ForceImmediateFlushAsync(string filePath, CancellationToken cancellationToken = default)\n+    {\n+        ThrowIfDisposed();\n+        \n+        // Critical bypass: ski"
}