{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage.Tests/Async/AsyncLockManagerTests.cs:0",
  "vector": [
    0.015976645,
    0.022530967,
    -0.037971068,
    0.037478302,
    -0.015407397,
    -0.025867429,
    -0.030010212,
    -0.014147543,
    0.033306897,
    0.012228906,
    0.007851962,
    0.02056787,
    0.062163323,
    -0.017542779,
    -0.040383026,
    -0.052767366,
    0.069610029,
    0.026483422,
    -0.049677886,
    0.007701749,
    -0.050001658,
    -0.01127695,
    -0.047697771,
    0.04694685,
    -0.042307422,
    -0.008224785,
    0.022194451,
    0.046249297,
    -0.004777119,
    0.06848982,
    -0.009733066,
    -0.028590433,
    0.013039507,
    0.033254299,
    0.031358752,
    -0.00834559,
    -0.025207743,
    -0.001603277,
    0.001960535,
    0.006915058,
    0.056031302,
    -0.034682728,
    0.058484722,
    -0.046888318,
    0.033886094,
    -0.052589919,
    0.030676151,
    0.019053001,
    0.03624351,
    -2.0606e-05,
    -0.01525184,
    -0.008531295,
    -0.003923601,
    0.038055036,
    0.009355375,
    -0.022582812,
    0.063220523,
    0.039340854,
    -0.080751821,
    0.041807421,
    -0.006721363,
    0.003683692,
    0.039810039,
    0.008902519,
    -0.035046,
    -0.053262554,
    -0.027168406,
    0.05421228,
    -0.007358583,
    -0.066499829,
    0.021300394,
    0.025227666,
    0.00681337,
    0.045959517,
    0.007519344,
    0.048204292,
    0.048677847,
    0.012473877,
    0.020830171,
    -0.00301804,
    -0.021302888,
    -0.044104774,
    -0.013836771,
    0.003397053,
    0.052353568,
    -0.030490071,
    0.04348297,
    -0.034231022,
    0.012223343,
    0.016325047,
    -0.016822707,
    -0.006471328,
    0.023565756,
    0.039206069,
    -0.003508425,
    0.004426642,
    0.034466911,
    0.036262821,
    0.011126651,
    -0.052476052,
    0.001996154,
    0.004748948,
    -0.052794233,
    0.040577371,
    -0.07355056,
    0.027014524,
    -0.015443471,
    -0.033724062,
    0.00046774,
    0.008672496,
    0.010492054,
    0.03150152,
    0.004662495,
    0.030214014,
    0.048307635,
    0.000418161,
    -0.022059044,
    -0.010486089,
    0.022999933,
    0.049947266,
    0.000254786,
    0.02100246,
    -0.044907272,
    0.062838726,
    -0.029940588,
    0.051586043,
    0.003185515,
    0.018730484,
    0.003411891,
    -0.025113547,
    0.036538027,
    -0.009979575,
    0.002806067,
    -0.005068158,
    0.000348403,
    0.062303875,
    0.041097734,
    0.045870155,
    0.004336727,
    -0.027566625,
    0.038459782,
    -0.022629475,
    0.005722904,
    0.013540746,
    -0.013721604,
    -0.002484387,
    0.035621725,
    -0.003238921,
    0.030634711,
    -0.063639864,
    0.004492785,
    0.052929752,
    -0.030954136,
    0.012984117,
    0.024274966,
    0.044135686,
    -0.03776497,
    -0.055185158,
    -0.022506794,
    -0.012097043,
    -0.038391404,
    0.029217266,
    0.033339985,
    0.02034989,
    -0.029523499,
    0.070401922,
    -0.002030418,
    0.00598988,
    -0.003499657,
    -0.040298767,
    -0.033089221,
    0.024911841,
    -0.031716522,
    -0.02781518,
    0.005651899,
    0.039598446,
    -0.00106719,
    0.014245203,
    -0.065239675,
    0.01228195,
    0.008520341,
    -0.011756186,
    -0.013034236,
    -0.018558012,
    0.001808759,
    -0.010942946,
    0.030013135,
    0.019211866,
    -0.011920261,
    -0.011308092,
    -0.014309383,
    -0.02843632,
    -0.06922587,
    -0.025373014,
    0.002541709,
    -0.022123683,
    -0.021988034,
    -0.001610207,
    0.032057505,
    0.017622231,
    0.012106006,
    0.005582061,
    -0.048188448,
    -0.015165621,
    0.001398805,
    0.042619325,
    -0.066341475,
    -0.021977609,
    0.00938451,
    -0.022375898,
    -0.005815507,
    -0.01548312,
    0.007981624,
    -0.003466146,
    -0.012230283,
    0.032668758,
    -0.00793473,
    0.006991612,
    0.039617468,
    0.004159024,
    -0.006805739,
    -0.011061999,
    0.063435934,
    0.043112084,
    -0.02823142,
    -0.059038565,
    -0.056661364,
    -0.04593664,
    -0.00223606,
    -0.030456919,
    -0.025257099,
    -0.054791577,
    0.03186715,
    -0.046844538,
    -0.063078821,
    0.03332283,
    0.00854597,
    -0.018287836,
    0.016999053,
    -0.003554822,
    -0.038207829,
    0.020264886,
    0.023383636,
    -0.012411578,
    -0.047539368,
    -0.022806371,
    0.052593958,
    0.006869546,
    0.027166555,
    -0.007638162,
    -0.047351547,
    0.026416654,
    -0.02332974,
    0.046369657,
    0.031153953,
    0.009222174,
    0.003263858,
    -0.016965583,
    0.033408374,
    0.00688474,
    0.010994421,
    0.024232388,
    -0.032105554,
    -0.023429109,
    -0.02473248,
    0.047372084,
    -0.028304378,
    0.000639722,
    -0.023468718,
    0.075282082,
    0.030385533,
    0.004029673,
    0.030062599,
    -0.001143421,
    0.006211144,
    -0.047982302,
    0.017107621,
    0.015818331,
    0.014840378,
    0.007987869,
    -0.060013276,
    -0.019513967,
    0.00343204,
    -0.034418114,
    -0.062090725,
    -0.024230905,
    0.016525278,
    0.000447848,
    0.025677959,
    0.036924817,
    0.022912219,
    -0.019347269,
    -0.022276066,
    -0.011772819,
    0.041392773,
    0.020610202,
    0.026132377,
    -0.002351352,
    0.018096371,
    -0.038669314,
    -0.004299594,
    -0.003680065,
    0.048004702,
    0.037802685,
    0.006423707,
    -0.002910385,
    0.035826284,
    -0.03101363,
    0.022470845,
    -0.028217595,
    -0.066297688,
    0.025284862,
    -0.009373419,
    0.004759104,
    0.030728357,
    -0.080942929,
    -0.022179328,
    0.012399793,
    -0.037275717,
    0.028668277,
    0.020669974,
    -0.010173569,
    0.036230542,
    -0.038500715,
    0.002484214,
    -0.007253732,
    -0.035073504,
    -0.036830068,
    0.053729363,
    -0.051728919,
    -0.030598715,
    0.024455765,
    0.002647309,
    0.029989036,
    -0.016288733,
    -0.007649609,
    -0.010957183,
    0.007121744,
    -0.021564528,
    0.025049444,
    -0.002966236,
    -0.019851772,
    0.024867076,
    -0.019513607,
    0.059672464,
    -0.002120201,
    0.017677445,
    -0.008846839,
    -0.025440942,
    0.048720803,
    -0.009607485,
    -0.044639152,
    -0.019808317,
    -0.016771594,
    -0.049072027,
    0.045342702,
    -0.023310943,
    -0.03213945,
    0.00532537,
    0.068648197,
    0.011393984,
    0.010281649,
    -0.030985555,
    -0.029879654,
    -0.011380882,
    -0.002644305,
    -0.014555389,
    0.078159116,
    -0.026503878,
    -0.007992605,
    -0.038700033,
    -0.083058134,
    -0.050196305,
    0.033722047,
    -0.019589968,
    0.006751287,
    0.033828571,
    0.001157129,
    0.002050431,
    -0.012979801,
    -0.018492714,
    0.008670048,
    0.004432034,
    -0.006524193,
    0.009373561,
    0.015866397,
    0.002138678,
    5.3216e-05,
    -0.010645006,
    0.041585438,
    0.01819228,
    0.003048043,
    -0.031972002,
    0.00021999,
    -0.029301833,
    -0.02272835,
    0.024772091,
    0.011276175,
    0.02152287,
    -0.005722967,
    0.022848396,
    0.003687506,
    0.045366239,
    -0.056735013,
    0.045286477,
    0.015906496,
    -0.00067922,
    0.03863452,
    -0.014581244,
    -0.019752983,
    -0.031088587,
    0.080745585,
    0.005832361,
    0.015824391,
    -0.042089652,
    0.060257856,
    0.006524134,
    0.017633494,
    -0.010825999,
    -0.013116915,
    -0.003006159,
    -0.038155451,
    -0.00833263,
    -0.00979038,
    -0.019126929,
    0.002499366,
    0.017496571,
    -0.081842519,
    -0.012275709,
    -0.00213054,
    -0.017217023,
    -0.011653773,
    -0.065495998,
    0.017489852,
    0.035440788,
    -0.027702853,
    0.018221842,
    0.011116349,
    -0.027271183,
    -0.012568126,
    -0.034544289,
    -0.013826323,
    0.087152861,
    -0.04026337,
    -0.003598818,
    -0.032477383,
    0.032617602,
    0.027282536,
    -0.024238687,
    -0.021820167,
    -0.061200485,
    0.029477218,
    -0.051605873,
    -0.003406643,
    0.041868575,
    -0.004045973,
    -0.040225953,
    0.020823566,
    -0.018758196,
    -0.020428233,
    0.003029655,
    -0.02159721,
    0.029549545,
    0.019543149,
    -0.020133503,
    0.018539919,
    0.028062953,
    -0.042655759,
    -0.050867353,
    0.014033296,
    0.050796296,
    -0.012211383,
    -0.023267936,
    0.034742039,
    0.027069841,
    0.010936405,
    0.008556109,
    0.088296212,
    -0.011877395,
    -0.029918438,
    -0.054046784,
    -0.041915048,
    -0.018226758,
    -0.006739567,
    -0.026786588,
    0.038349468,
    0.002632888,
    0.010155504,
    0.064343803,
    -0.026326936,
    -0.035398558,
    -0.01041826,
    -0.024336055,
    -0.020903528,
    0.046644617,
    0.020159688,
    -0.001868075,
    -0.008039258,
    -0.004845137,
    0.028660011,
    0.032200634,
    -0.057640553,
    0.005356633,
    -0.003240512,
    -0.050325252,
    0.043015536,
    0.009409022,
    -0.042398442,
    -0.092842855,
    0.037271913,
    -0.042553365,
    -0.028585153,
    -0.005474556,
    0.025110945,
    0.012650182,
    -0.068915173,
    -0.058484923,
    0.028164083,
    -0.004356588,
    -0.012541492,
    0.016929729,
    0.012822715,
    -0.028531292,
    -0.05372728,
    0.03573915,
    0.013206627,
    0.023398912,
    0.0065576,
    -0.010683539,
    -0.045843225,
    -0.000332505,
    0.016693681,
    -0.027816612,
    -0.062962718,
    -0.007840972,
    -0.007513661,
    0.014173727,
    0.01308765,
    0.007653066,
    0.015819835,
    -0.011337956,
    0.01799453,
    -0.016780447,
    -0.058646351,
    0.048035476,
    0.028481783,
    0.030357247,
    0.023350125,
    -0.022049008,
    -0.018565642,
    -0.020036735,
    0.054354072,
    0.05863886,
    0.049764551,
    -0.011303436,
    0.037292533,
    0.045293327,
    -0.000613986,
    0.059694815,
    -0.009001552,
    0.003928873,
    0.023842335,
    0.006155022,
    0.004259149,
    -0.020346804,
    0.030442303,
    0.016729753,
    0.044622466,
    -0.04269506,
    -0.003965013,
    -0.002525891,
    -0.014022193,
    0.009545671,
    0.017775897,
    0.010225833,
    0.039773513,
    0.038394812,
    -0.046059359,
    -0.027385082,
    -0.034114361,
    0.012982917,
    -0.030011361,
    0.040698837,
    0.006729676,
    -0.03669579,
    -0.042663295,
    0.012102002,
    -0.011909575,
    -0.008275382,
    -0.025564289,
    0.041763932,
    3.679e-06,
    -0.001965265,
    -0.060795825,
    0.065918848,
    7.8966e-05,
    -0.001281757,
    -0.00378941,
    0.01293477,
    -0.022413075,
    -0.007136237,
    0.021391055,
    0.051590804,
    -0.004392094,
    0.018909199,
    -0.003989031,
    0.032380808,
    0.004933885,
    0.057359487,
    0.049985815,
    0.006366795,
    0.029940004,
    0.056027517,
    -0.024924438,
    -0.008137474,
    0.017582424,
    0.047043685,
    -0.063115388,
    -0.023500321,
    0.061238129,
    0.023693675,
    -0.040445331,
    -0.02012771,
    -0.018155145,
    0.011756186,
    -0.015354109,
    0.03333148,
    -0.035554953,
    0.019695994,
    0.018366316,
    -0.011884444,
    0.020383114,
    -0.083436958,
    0.001545658,
    0.008201892,
    0.008323494,
    0.027814265,
    -0.012352712,
    -0.001406233,
    0.012150412,
    -0.019170009,
    -0.026778502,
    -0.000393707,
    -0.006762038,
    0.043955673,
    0.018875783,
    0.051456816,
    -0.00695835,
    -0.007636241,
    0.03657252,
    0.038319893,
    0.029179428,
    0.088184647,
    0.025943397,
    0.066440076,
    0.018801851,
    0.015229888,
    0.003267626,
    -0.000852966,
    -0.013068875,
    -0.0002892,
    -0.042419184,
    -0.024788829,
    0.000330583,
    0.043935195,
    -0.007557803,
    -0.024998197,
    0.030890467,
    -0.012435472,
    -0.014695606,
    -0.016826374,
    0.008966065,
    -0.021025088,
    -0.016547536,
    -0.036696743,
    0.024378762,
    -0.002539714,
    0.014029932,
    -0.007108528,
    -0.022749837,
    -0.001621653,
    0.054130238,
    0.001900092,
    0.018496921,
    -0.049414821,
    -0.012882917,
    -0.032014288,
    0.020284617,
    -0.000712067,
    -0.000296447,
    0.00169641,
    -0.001383369,
    0.089626774,
    -0.061722033,
    -0.014543435,
    0.011310232,
    -0.003016169,
    0.004911743,
    -0.016052902,
    -0.046333525,
    0.020599062,
    0.015137359,
    0.00271342,
    0.020852163,
    0.026972428,
    -0.03799646,
    0.010450178,
    -0.04959527,
    0.056765977,
    0.023962054,
    -0.025213292,
    -0.033240464,
    0.009994056,
    0.017871313,
    -0.008257172,
    0.00863563,
    -0.057634246,
    -0.046034127,
    0.008324208,
    0.004414174,
    -0.024216168,
    0.001800413,
    -0.041276623,
    -0.015627727,
    0.010979931,
    -0.000103942,
    -0.016641643,
    -0.0004253,
    0.053201303,
    -0.018567624,
    -0.007620819,
    0.010404711,
    0.0405057,
    0.004628895,
    -0.023443891,
    0.014680441,
    -0.03160071,
    -0.00782506,
    -0.007224869,
    0.019507686,
    0.025072951,
    0.035224408,
    -0.017126555,
    0.012371871,
    -0.01181118,
    0.001900771,
    -0.015332374,
    0.008688724,
    -0.020950582,
    -0.046062153,
    -0.00582015,
    -0.029086728,
    -0.026323887,
    -0.069237515,
    0.04649929,
    -0.024277294,
    -0.056196202,
    0.043191474,
    0.036027394,
    0.051801879,
    -0.02852302,
    -0.003901518,
    0.003490777,
    -0.03953724,
    -0.026365822,
    -0.031723216,
    -0.023123203,
    -0.002496335,
    -0.058652267,
    0.033466358,
    0.000996709,
    -0.014724203,
    -0.019600136,
    0.029321212,
    -0.009446855,
    -0.006580905,
    0.043018311,
    0.015066833,
    -0.011078797,
    -0.001832059,
    -0.006281224,
    -0.006389535,
    0.020375362,
    -0.044865824,
    -0.051471673,
    0.014542368,
    -0.01843551,
    0.022236152,
    -0.003527429,
    -0.073705226,
    0.046074983,
    0.001973666,
    -0.036764491,
    0.011910453,
    0.004864956,
    0.035628121,
    -0.027176579,
    -0.065014586,
    0.00400634,
    0.005946313,
    -0.066096783,
    0.040700838,
    0.020274082,
    0.054256357,
    -0.014841002,
    0.004922321,
    0.074102148,
    -0.024887934,
    0.050059296,
    0.000286262,
    0.014491074,
    0.004293771,
    -0.057990622,
    -0.028640453,
    0.015228603,
    -0.039523147,
    -0.052838795,
    0.037702218,
    -0.013195841,
    0.019536098,
    0.021580061,
    0.0072995,
    0.036855083,
    0.03649538,
    -0.007893055,
    0.007087748,
    0.012546342,
    0.006228728,
    0.011516601,
    -0.015680308,
    -0.027521424,
    0.041753232,
    0.005710249,
    0.000683238,
    0.024596741,
    -0.007410196,
    -0.005974566,
    0.032137748,
    0.018675873,
    -0.032467753,
    0.011879412,
    0.034970481,
    0.010014411,
    -0.000551598,
    -0.033041488,
    -0.031940997,
    0.009744004,
    0.002348233,
    -0.039806303,
    0.067630723,
    -0.030333456,
    0.01128091,
    0.014842402,
    -0.006967427,
    -0.015723705,
    0.053083085,
    -0.014922713,
    0.044989821,
    -0.066961162,
    0.0019538,
    0.069051772,
    0.039110474,
    -0.007628927,
    -0.009773836,
    -0.015167507,
    -0.029658405,
    0.008430945,
    -0.029262872,
    -0.052423205,
    0.001345029,
    -0.03455884,
    0.026268305,
    -0.04067716,
    0.001588928,
    0.004393069,
    -0.003764862,
    0.049344998,
    -0.013437422,
    -0.02146028,
    0.010686781,
    -0.028191017,
    0.003014069,
    0.011334059,
    0.003130576,
    0.015466495,
    -0.005706146,
    -0.006864197,
    -0.051343665,
    -0.020700634,
    0.030545121,
    -0.071305297,
    -0.030908849,
    -0.016472897,
    0.034056421,
    0.017394347,
    0.009140099,
    -0.005820983,
    0.019935951,
    -0.018709339,
    0.013369612,
    -0.038220588,
    -0.003092467,
    -0.04333248,
    0.009336197,
    0.012305378,
    0.002393349,
    0.012398727,
    0.037500229,
    0.023197474,
    0.057969987,
    0.028186262,
    -0.001266813,
    -0.000839228,
    -0.065429516,
    -0.00504063,
    -0.003228122,
    0.034011774,
    0.02811889,
    0.014626184,
    -0.068077676,
    -0.04582686,
    -0.023580076,
    0.009627162,
    0.034867093,
    0.014784681,
    -0.002314413,
    -0.053323682,
    -0.005728113,
    -0.030316774,
    0.006788692,
    -0.007627975,
    0.007989465,
    -0.029643651,
    0.016056389,
    0.012696738,
    -0.012390286,
    -0.006144974,
    0.052830368,
    0.01928439,
    -0.037612751,
    0.038930539,
    -0.048372157,
    -0.03355692,
    -0.019573817,
    -0.037694324,
    0.023033801,
    -0.018187037,
    -0.01674863,
    -0.005944106,
    -0.027230797,
    0.005479894,
    -0.053600773,
    0.008069971,
    0.018141627,
    0.048863657,
    -0.022309011,
    -0.029178094,
    -0.04316742,
    -0.057926521,
    -0.008116792,
    0.042372342,
    -0.010140677,
    0.023930045,
    -0.000256506,
    0.022086455,
    0.009858535,
    0.054260734,
    0.022057271,
    0.008805374,
    0.044810735,
    -0.007837728,
    0.010366904,
    -0.045419794,
    0.046075843,
    -0.046047069,
    -0.017264506,
    0.008707071,
    0.001663274,
    -0.05996808,
    0.036762282,
    0.032021813,
    0.005099066,
    0.040258206,
    0.000988555,
    0.010601436,
    -0.065594323,
    -0.050719675,
    0.001465161,
    -0.041126478,
    -0.006084702,
    -0.027975071,
    0.052347224,
    0.048979949,
    0.010472602,
    -0.013642376,
    -0.003122611,
    -0.006215551,
    -0.00059033,
    0.012628054,
    -0.017187189,
    0.040833548,
    0.049038313,
    0.027861295,
    -0.02702504,
    -0.031655457,
    -0.032462876,
    0.023066238,
    -0.008010629,
    0.070787691,
    0.027346028,
    -0.002314817,
    0.032657433,
    0.015365838,
    0.025733961,
    0.016447922,
    -0.009719715,
    0.028236521,
    -0.046385672,
    0.001532836,
    0.030357327,
    0.007051031,
    -0.02247224,
    0.023001097,
    -0.035519592
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage.Tests/Async/AsyncLockManagerTests.cs",
    "chunk_index": 0,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "@@ -1,5 +1,6 @@\n+using System.Collections.Concurrent;\n using TxtDb.Storage.Services.Async;\n using Xunit;\n using Xunit.Abstractions;\n \n namespace TxtDb.Storage.Tests.Async;\n@@ -143,11 +144,11 @@ public class AsyncLockManagerTests : IDisposable\n         await Task.Delay(10); // Ensure task1 starts first\n \n         var task2 = Task.Run(async () =>\n         {\n             cancellationTokenSource.CancelAfter(50); // Cancel after 50ms\n-            await Assert.ThrowsAsync<OperationCanceledException>(\n+            await Assert.ThrowsAnyAsync<OperationCanceledException>(\n                 () => _lockManager.AcquireLockAsync(lockKey, Timeout.InfiniteTimeSpan, cancellationTokenSource.Token));\n         });\n \n         await Task.WhenAll(task1, task2);\n     }\n@@ -311,10 +312,251 @@ public class AsyncLockManagerTests : IDisposable\n \n         // Assert\n         Assert.False(lockHandle.IsLocked); // Lock should be released when manager is disposed\n     }\n \n+    /// <summary>\n+    /// FAILING TEST: Reproduces race condition in reference count management\n+    /// This test exposes the race condition where multiple threads can read the same reference count\n+    /// before any thread writes the decremented value back, causing reference counts to be incorrect\n+    /// </summary>\n+    [Fact]\n+    public async Task ReferenceCountRaceCondition_ConcurrentDecrements_ShouldMaintainCorrectCount()\n+    {\n+        // Arrange\n+        var lockKey = \"race_condition_test\";\n+        var concurrentOperations = 50;\n+        var exceptions = new ConcurrentBag<Exception>();\n+        var completedOperations = 0;\n+\n+        // Act - Create many concurrent lock acquisitions and releases\n+        var tasks = Enumerable.Range(0, concurrentOperations).Select(i =>\n+            Task.Run(async () =>\n+            {\n+                try\n+                {\n+                    using var lockHandle = await _lockManager.AcquireLockAsync(lockKey);\n+                    // Brief hold to ensure overlapping reference count operations\n+                    await Task.Delay(1);\n+                    Interlocked.Increment(ref completedOperations);\n+                }\n+                catch (Exception ex)\n+                {\n+                    exceptions.Add(ex);\n+                }\n+            })\n+        ).ToArray();\n+\n+        await Task.WhenAll(tasks);\n+\n+        // Assert - All operations should complete without exceptions\n+        // The race condition causes ObjectDisposedExceptions or incorrect reference counts\n+        Assert.Empty(exceptions.ToArray());\n+        Assert.Equal(concurrentOperations, completedOperations);\n+        \n+        // This test will fail due to race conditions in DecrementLockReference method\n+    }\n+\n+    /// <summary>\n+    /// FAILING TEST: Reproduces disposal timing race conditions\n+    /// This test exposes ObjectDisposedException when disposal occurs while threads are acquiring locks\n+    /// </summary>\n+    [Fact]\n+    public async Task DisposalRaceCondition_DisposeDuringLockAcquisition_ShouldHandleGracefully()\n+    {\n+        // Arrange\n+        var tempLockManager = new AsyncLockManager();\n+        var lockKey = \"disposal_race_test\";\n+        var concurrentOperations = 5; // Reduced for more manageable testing\n+        var exceptions = new ConcurrentBag<Exception>();\n+        var completedBeforeDisposal = 0;\n+\n+        // Act - Start lock acquisitions and dispose the manager while they're running\n+        var lockTasks = Enumerable.Range(0, concurrentOperations).Select(i =>\n+            Task.Run(async () =>\n+            {\n+                try\n+                {\n+                    // Add timeout to prevent indefinite blocking\n+                    using var lockHandle = await tempLockManager.AcquireLockAsync(lockKey, TimeSpan.FromMilliseconds(100));\n+                    Interlocked.Increment(ref completedBeforeDisposal);\n+                    await Task.Delay(5);\n+                }\n+                catch (ObjectDisposedException)\n+                {\n+                    // This is expected after disposal, but should be handled gracefully\n+       "
}