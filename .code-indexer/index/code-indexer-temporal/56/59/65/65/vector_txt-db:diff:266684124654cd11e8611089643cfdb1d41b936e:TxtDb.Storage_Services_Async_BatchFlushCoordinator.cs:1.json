{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/BatchFlushCoordinator.cs:1",
  "vector": [
    0.002402226,
    0.001887708,
    -0.006766923,
    0.058599781,
    -0.05424767,
    -0.025323328,
    -0.016742567,
    -0.022866597,
    0.054872237,
    -0.01423532,
    0.030712197,
    0.015267671,
    0.059088461,
    -0.031468712,
    -0.053247977,
    -0.007842659,
    0.003185475,
    -0.021437019,
    -0.047754213,
    -0.002326558,
    -0.049914386,
    -0.067363888,
    -0.059207894,
    0.03795696,
    -0.02289344,
    -0.011964702,
    0.005558138,
    0.044524368,
    -0.020604033,
    0.040835496,
    -0.002707933,
    -0.068103835,
    0.0087544,
    0.008404652,
    0.023992352,
    -0.007607773,
    -0.049330451,
    -0.005639795,
    0.005676881,
    0.012554017,
    0.021750117,
    0.004414491,
    0.044195469,
    -0.043930728,
    0.006044072,
    -0.044048328,
    0.039927997,
    -0.025205392,
    0.009110426,
    -0.009010085,
    -0.024232844,
    -0.013085293,
    -0.012142299,
    0.005912947,
    0.011020181,
    -0.057857342,
    0.074313544,
    0.022928361,
    -0.047059264,
    0.050533835,
    -0.006698575,
    0.01062307,
    -0.001427917,
    0.069952868,
    -0.030209284,
    -0.029265866,
    -0.043265227,
    0.023400579,
    0.017284412,
    -0.093987681,
    0.025247812,
    0.059854552,
    -0.03049032,
    0.018059244,
    0.039141443,
    0.030507077,
    0.015559555,
    0.024119284,
    0.034177881,
    0.005284114,
    -0.028100755,
    -0.045051161,
    -0.01632986,
    -0.027700625,
    0.049709972,
    -0.04492623,
    0.020619405,
    -0.060282003,
    -0.001592053,
    0.020829119,
    -0.026094453,
    0.022633692,
    0.024594096,
    0.011231534,
    0.041426305,
    -0.004755759,
    0.037018843,
    0.010573465,
    -0.000346471,
    -0.003545984,
    0.022138814,
    0.0275738,
    -0.028771078,
    0.058526509,
    -0.047311306,
    -0.009253355,
    -0.005851643,
    -0.062354639,
    0.030029075,
    0.035947695,
    0.039611135,
    0.023902884,
    -0.021254851,
    0.00723958,
    0.001819601,
    0.002445765,
    -0.015990825,
    -0.024727942,
    0.008543476,
    0.041983359,
    -0.0465107,
    0.035261504,
    -0.047821108,
    0.056274377,
    -0.037664782,
    0.048061963,
    0.023768375,
    0.034964897,
    0.019234803,
    -0.015462575,
    0.003305819,
    -0.017283011,
    -0.000335673,
    0.027655466,
    -0.025897991,
    0.046252679,
    0.038479839,
    0.006180206,
    -0.001177839,
    -0.040449813,
    0.01414171,
    0.006552319,
    -0.010816711,
    0.025972713,
    0.005926188,
    0.057001263,
    0.029459678,
    -0.0124605,
    0.005200648,
    -0.04793847,
    -0.006752654,
    0.054892946,
    -0.036222611,
    -0.005004275,
    0.009068248,
    0.014335607,
    -0.034678746,
    -0.03733911,
    -0.00613022,
    0.040766146,
    -0.039791852,
    0.031617846,
    0.01397426,
    0.02347585,
    -0.037179179,
    0.026085988,
    0.004298022,
    -0.008382229,
    0.049015954,
    -0.043386303,
    -0.054626033,
    0.040466208,
    -0.061598103,
    -0.024838759,
    -0.028074231,
    0.030819234,
    -0.001238786,
    0.005126638,
    -0.068944663,
    -0.03582314,
    0.008909356,
    -0.023461595,
    -0.016924543,
    0.024044104,
    0.03551922,
    -0.049231138,
    0.023173701,
    0.006575081,
    -0.009954134,
    -0.034380846,
    -0.013186774,
    0.02570883,
    -0.032288875,
    -0.016705198,
    0.001390789,
    -0.018738478,
    0.019844573,
    0.001983726,
    0.00649853,
    0.025864556,
    -0.053037733,
    0.036814593,
    -0.073561415,
    -0.03487429,
    0.006808943,
    -0.002197109,
    -0.0246071,
    -0.007307036,
    -0.00205744,
    -0.022510666,
    0.010514637,
    0.017350426,
    0.000384194,
    -0.003833096,
    0.021909878,
    -0.029342569,
    -0.041427106,
    -0.025201485,
    0.008281968,
    0.008302429,
    -0.019522861,
    -0.004515172,
    0.069731131,
    0.047567751,
    -0.022797799,
    -0.064584136,
    -0.015946973,
    -0.060974702,
    -0.02019432,
    0.005100647,
    0.015172506,
    -0.040695116,
    0.017751977,
    -0.028288376,
    -0.03456717,
    0.064261399,
    -0.046248626,
    -0.022906249,
    0.003969449,
    -0.02305083,
    0.000351453,
    0.037112691,
    0.020696646,
    0.018236367,
    -0.025850756,
    0.007934021,
    0.075484432,
    -0.016425574,
    0.012446859,
    0.025965292,
    -0.015975216,
    0.014609602,
    -0.030130813,
    0.101309948,
    0.072025038,
    0.024223777,
    0.001727391,
    0.033565894,
    0.025046634,
    0.017645545,
    -0.005963008,
    0.003380088,
    -0.010078494,
    0.007131563,
    0.00704223,
    0.002181647,
    -0.033312764,
    -0.012797127,
    0.006858134,
    0.019954028,
    0.030869681,
    -0.000540411,
    0.028761627,
    0.020477783,
    0.024864772,
    -0.015413901,
    0.014184218,
    0.019702647,
    0.032338884,
    0.030882539,
    -0.037469879,
    -0.013331522,
    0.005920891,
    -0.040558256,
    -0.045718633,
    -0.011422068,
    -0.013296034,
    -0.015845971,
    0.028152782,
    0.014157253,
    0.021950627,
    0.021485053,
    -0.018392885,
    -0.005074789,
    0.027756779,
    0.029161075,
    0.017969023,
    -0.024397947,
    0.006381269,
    0.00999785,
    -0.009591549,
    0.011192234,
    0.069703117,
    0.057204414,
    0.00058614,
    -0.002196548,
    0.023836737,
    -0.01925208,
    0.015653085,
    0.011941697,
    -0.061357815,
    0.001016821,
    0.014007302,
    -0.015578226,
    0.026867008,
    -0.032888021,
    -0.038980417,
    -0.01943263,
    0.005173682,
    0.009004729,
    0.003059715,
    -0.023759732,
    0.041820455,
    -0.019234048,
    0.015878301,
    0.0248271,
    -0.071365476,
    -0.054378565,
    0.032650746,
    -0.051068284,
    0.002419529,
    0.043151155,
    -0.043920401,
    0.061704803,
    -0.003686161,
    0.020602338,
    -0.021743223,
    0.020124182,
    -0.034522861,
    0.035264611,
    -0.001881016,
    -0.004771897,
    0.005243895,
    -0.026376236,
    0.077578522,
    -0.004044579,
    -0.001774143,
    -0.01028929,
    -0.011251326,
    0.06004969,
    -0.018213883,
    -0.060200762,
    -0.029458543,
    0.024173724,
    -0.021946497,
    0.029066024,
    -0.044947453,
    0.019666828,
    -0.001039999,
    0.010502391,
    0.02428955,
    0.011454474,
    -0.057724211,
    -0.015267523,
    0.005014733,
    -0.020640288,
    -0.010486827,
    0.069265507,
    -0.049396511,
    0.027721984,
    -0.035425391,
    -0.059226234,
    -0.026297119,
    0.035448126,
    -0.012734588,
    0.030139394,
    0.042803023,
    -0.029307518,
    -0.003844717,
    -0.060158785,
    -0.018799005,
    0.008406665,
    -0.000878131,
    0.004332552,
    0.001473311,
    -0.022103053,
    0.015381484,
    0.033747517,
    -0.034271136,
    0.041426059,
    -0.007082067,
    0.032368697,
    0.039892051,
    -0.002376075,
    0.005159352,
    -0.023387674,
    -0.020593446,
    0.026679499,
    0.033080924,
    0.01029934,
    0.00319949,
    0.00098067,
    0.052936658,
    -0.063187659,
    0.007118152,
    -0.003248398,
    0.006329363,
    0.027139939,
    -0.023251107,
    0.043801125,
    -0.010554749,
    0.024875727,
    -0.002576987,
    0.016251788,
    -0.002138281,
    0.045478679,
    -0.020463301,
    0.003650217,
    -0.007434331,
    -0.016499374,
    -0.032776985,
    -0.03239388,
    0.014683301,
    -0.039721914,
    -0.028771672,
    0.002862431,
    0.021353558,
    -0.08849664,
    -0.026386581,
    -0.001195253,
    -0.017387535,
    -0.00347889,
    -0.032919161,
    0.014943875,
    0.057855397,
    -0.028518023,
    0.024856457,
    -0.027499344,
    -0.032893416,
    -0.042975739,
    -0.016342731,
    -0.034742437,
    0.064264216,
    -0.021612091,
    0.013959984,
    -0.031633414,
    -0.005418056,
    0.082670368,
    -0.044152737,
    -0.039650321,
    -0.036568847,
    -0.000296755,
    -0.018333543,
    -0.001126381,
    0.03643268,
    -0.029261885,
    -0.025870971,
    0.041024692,
    0.007659137,
    -0.025865071,
    -0.031889427,
    -0.014990243,
    -0.010274254,
    0.00566422,
    -0.02416941,
    0.021268966,
    0.023181632,
    -0.029958948,
    -0.026911652,
    -0.015884666,
    0.05850758,
    -0.046865989,
    -0.005328688,
    -0.005135588,
    0.031013871,
    0.039387219,
    -0.004479959,
    0.070791885,
    -0.013474408,
    -0.017749527,
    -0.025104992,
    -0.030876437,
    -0.024447843,
    -0.038066056,
    -0.032643862,
    0.01495499,
    -0.054277889,
    0.059196059,
    0.050078243,
    -0.02579084,
    0.011077372,
    -0.020607175,
    0.009046433,
    -0.009807762,
    0.00617161,
    0.009138404,
    0.002376042,
    -0.002097495,
    -0.046357747,
    0.021656744,
    0.03948931,
    -0.064402245,
    0.027254054,
    -0.012614921,
    -0.021456786,
    0.031774372,
    0.004650175,
    0.004746411,
    -0.103896685,
    0.036118455,
    -0.041257903,
    -0.01167351,
    -0.02371903,
    0.046089798,
    0.02441233,
    -0.0161069,
    -0.044614676,
    0.010025507,
    0.01233232,
    -0.014494763,
    0.008118799,
    0.051913831,
    -0.006050211,
    -0.079190671,
    0.029020149,
    -0.01742298,
    0.012453536,
    0.00655822,
    0.016909819,
    -0.016777186,
    -0.021557869,
    0.042232644,
    -0.004476196,
    -0.036814816,
    -0.004372082,
    0.003183395,
    0.025829487,
    -0.006927793,
    0.008462394,
    -0.009674313,
    -0.013656001,
    -0.024105361,
    -0.009154053,
    -0.071070984,
    -0.000363576,
    0.011457255,
    0.015349121,
    0.021075072,
    -0.01824666,
    -0.013156882,
    -0.005761565,
    0.037494279,
    0.044138175,
    0.047158804,
    -0.022980044,
    0.068111211,
    0.029149037,
    -0.014693796,
    0.060275245,
    -0.005388731,
    0.012343667,
    0.032506458,
    0.022151321,
    0.023084071,
    -0.020298984,
    0.009921791,
    0.010055208,
    -0.021108406,
    -0.021382356,
    -0.01305561,
    -0.005455856,
    -0.017942376,
    -0.020329418,
    0.010889268,
    0.02600285,
    0.010456759,
    0.05262354,
    -0.049820591,
    -0.029851882,
    -0.018043561,
    0.003553577,
    0.023140218,
    -0.009125702,
    0.025298199,
    -0.024011413,
    -0.049362849,
    0.030362505,
    -0.008838294,
    -0.043893285,
    0.001575863,
    0.02442492,
    -0.01890084,
    0.004107586,
    -0.046963729,
    0.056157909,
    0.00551232,
    -0.014957102,
    0.00849917,
    -0.03462296,
    -0.031099519,
    0.008252119,
    0.019152703,
    0.050669044,
    0.02982644,
    -0.030149667,
    -0.032788452,
    0.03467913,
    0.006472853,
    0.077946618,
    0.008828911,
    0.000827116,
    0.001728872,
    0.067299426,
    -8.223e-05,
    0.033240426,
    0.033208184,
    0.025922276,
    -0.057774495,
    0.001975523,
    0.049776524,
    -7.7055e-05,
    -0.059076544,
    -0.001560423,
    0.016122222,
    0.00098942,
    -0.009117963,
    0.048970934,
    -0.018931037,
    -0.008035379,
    4.0498e-05,
    0.018299339,
    0.029290633,
    -0.085591987,
    0.028590431,
    0.038270921,
    -0.014872786,
    0.018695239,
    0.001321856,
    0.002982249,
    -0.003124721,
    0.00129249,
    -0.002998772,
    0.014247443,
    0.048504118,
    0.011471631,
    0.017559463,
    0.049869262,
    -0.060470887,
    -0.025617175,
    0.03963241,
    0.053203627,
    0.025898803,
    0.102504328,
    0.043475978,
    0.049385205,
    0.012215813,
    0.037616253,
    -0.026451714,
    -0.013109026,
    -0.017893987,
    0.004052856,
    0.004486823,
    -0.036626928,
    0.055485878,
    0.037465159,
    -0.019656446,
    -0.034628853,
    0.023144973,
    -0.015980655,
    -0.030348528,
    -0.019744646,
    0.033839636,
    -0.017180532,
    -0.030157214,
    -0.019687321,
    0.006478088,
    0.016857056,
    0.024008285,
    0.015548078,
    -0.008932026,
    0.03047232,
    0.065215662,
    -0.011049808,
    -0.005688856,
    -0.039377388,
    -0.001024561,
    -0.05489026,
    0.006789546,
    0.000891928,
    0.001280053,
    0.008392269,
    -0.019497018,
    0.076814383,
    -0.045357838,
    0.022867355,
    0.008163843,
    -0.006653008,
    -0.017888488,
    -0.039453715,
    -0.050397374,
    -0.001386348,
    0.052568637,
    -0.030298213,
    0.001406242,
    0.000360408,
    -0.02287155,
    0.00480517,
    -0.002102567,
    0.053788953,
    0.027689382,
    -0.004890424,
    -0.052491114,
    0.00365133,
    0.029393336,
    0.021191882,
    -0.008026854,
    -0.009656887,
    -0.013394453,
    -0.002130979,
    -0.00753262,
    -0.0035386,
    -0.001763333,
    -0.050632026,
    -0.01301369,
    -0.012639555,
    -0.00851708,
    -0.010810127,
    0.012231219,
    0.071214572,
    -0.029544169,
    -0.066303656,
    0.003764915,
    0.010708164,
    0.034958649,
    -0.054497719,
    0.011299723,
    -0.047212839,
    0.02569351,
    -0.033598352,
    0.018952109,
    0.015757065,
    0.029395571,
    -0.004463628,
    0.003224113,
    0.011778119,
    -0.001280827,
    -0.001428594,
    0.038207941,
    0.007290715,
    -0.095632307,
    -0.031731524,
    -0.003436205,
    -0.014179017,
    -0.016738214,
    0.045374665,
    -0.004179148,
    -0.023241524,
    0.072618909,
    -0.006565499,
    0.032625958,
    -0.019847566,
    0.018895129,
    0.004743156,
    -0.038047545,
    -0.053441968,
    -0.018614927,
    0.027718809,
    -0.005416841,
    -0.081963547,
    -0.015830457,
    -0.02957478,
    -0.009345034,
    -0.020665539,
    0.010726716,
    -0.020763211,
    -0.025002819,
    0.010469154,
    0.023883888,
    -0.012652481,
    -0.009953372,
    -0.005264423,
    0.010816751,
    0.028763158,
    -0.032441128,
    -0.036677323,
    0.012153125,
    0.012675372,
    0.051497143,
    -0.028604973,
    -0.057564247,
    0.052311905,
    0.00295256,
    -0.010417217,
    0.029311689,
    -0.013344158,
    -0.003379132,
    -0.045660079,
    -0.013297307,
    0.019397067,
    -0.012429999,
    -0.063406095,
    0.056359265,
    0.031068323,
    0.029119965,
    -0.031006616,
    -0.03105836,
    0.043465454,
    -0.000624215,
    0.013427909,
    0.030052554,
    0.043860354,
    -0.002088028,
    -0.018161692,
    -0.012514994,
    0.036219299,
    -0.022797473,
    -0.078015558,
    0.039588541,
    0.016924853,
    -0.033970449,
    -0.017097412,
    0.001188035,
    -0.00210229,
    0.009539003,
    -0.016161876,
    0.008994692,
    0.011834629,
    0.005943106,
    0.001683116,
    -0.033370666,
    -0.033091709,
    0.050777175,
    0.019399416,
    -0.0207108,
    0.037193533,
    0.006014107,
    0.02014515,
    0.049199659,
    0.011945115,
    -0.043395013,
    0.010785573,
    0.016438028,
    0.037776403,
    0.040673252,
    -0.052104302,
    -0.048710205,
    0.006811215,
    0.007668078,
    -0.004826304,
    0.032452192,
    0.013399936,
    -0.023785766,
    -0.021736249,
    -0.01549146,
    -0.039025787,
    0.069059543,
    -0.034116808,
    0.034316432,
    -0.065083086,
    -0.018593958,
    0.077366076,
    0.003299047,
    -0.01583048,
    0.021095214,
    -0.019717647,
    -0.0161127,
    -0.021821374,
    0.000159804,
    -0.043978844,
    -0.034644365,
    -0.02008369,
    0.008380189,
    -0.038746081,
    -0.019447293,
    0.02583901,
    -0.01517667,
    0.015373349,
    -0.021266768,
    -0.030593093,
    -0.010242622,
    -0.014469825,
    0.013465322,
    0.018253187,
    0.026736664,
    0.026587298,
    0.001541152,
    -0.056071274,
    -0.073554046,
    0.003878454,
    0.029533587,
    -0.043000825,
    0.004858675,
    -0.010171005,
    -0.021256149,
    0.022978814,
    0.04350391,
    0.021563925,
    -0.013526806,
    -0.009770076,
    0.017660609,
    -0.010819823,
    0.010503788,
    -0.014399808,
    0.057031348,
    0.030001158,
    0.030520381,
    0.018622158,
    -0.011551064,
    0.013679818,
    0.040416948,
    -0.004789474,
    -0.050912976,
    0.015359753,
    -0.036014013,
    -0.012461631,
    0.027553117,
    0.031456359,
    0.020391164,
    -0.005382353,
    -0.063747942,
    -0.010316974,
    -0.003035572,
    -0.0047495,
    0.015275455,
    0.021336313,
    -0.034574345,
    -0.061854303,
    -0.013028728,
    0.007725578,
    0.029146697,
    -0.022541255,
    -0.015487936,
    -0.040088162,
    -0.002688054,
    0.012582531,
    -0.010036481,
    0.016091902,
    0.034538604,
    0.036035825,
    -0.056152701,
    0.015568497,
    -0.026621308,
    -0.042945076,
    -0.035805523,
    -0.081456929,
    0.014487636,
    -0.000326249,
    0.005586335,
    -0.022797588,
    -0.001535733,
    0.010957676,
    0.010906565,
    0.020362915,
    0.014624093,
    0.01490416,
    0.030101925,
    -0.016006811,
    -0.020748192,
    -0.047569767,
    -0.010877308,
    -0.007484021,
    -0.007163192,
    0.033080257,
    0.022042595,
    0.016806696,
    -0.027872773,
    0.045352884,
    0.010153004,
    0.013287443,
    0.021256663,
    0.012334797,
    -0.020330679,
    -0.024211686,
    -0.034712158,
    -0.043639071,
    -0.007580331,
    -0.003800218,
    -0.00532119,
    -0.05898637,
    -0.000481897,
    0.014510696,
    0.016150558,
    0.033795763,
    -0.036157999,
    -0.018248292,
    -0.031676777,
    -0.025908343,
    0.059251063,
    -0.055147622,
    -0.028531553,
    -0.03171625,
    0.018708626,
    -0.013203752,
    0.021299018,
    0.005918755,
    0.011097351,
    -0.030824872,
    0.010795871,
    -0.00680676,
    -0.006343605,
    0.036890108,
    0.020501276,
    0.011677737,
    0.010008725,
    0.013530052,
    -0.021785986,
    0.027416686,
    -0.008625725,
    0.047465894,
    0.025757009,
    0.006671757,
    0.011389833,
    0.020391524,
    0.013744473,
    -0.001555068,
    -0.001207623,
    0.047984876,
    -0.010663572,
    0.02110298,
    -0.035966087,
    0.005846355,
    -0.053811543,
    0.021224329,
    -0.053780165
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/BatchFlushCoordinator.cs",
    "chunk_index": 1,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "// <summary>\n+    /// Forces immediate flush of a file, bypassing the batching queue entirely.\n+    /// Used for critical operations that require immediate durability guarantees.\n+    /// </summary>\n+    /// <param name=\"filePath\">Path to file to be flushed immediately</param>\n+    /// <param name=\"cancellationToken\">Cancellation token</param>\n+    /// <returns>Task that completes when the file has been flushed</returns>\n+    public async Task ForceImmediateFlushAsync(string filePath, CancellationToken cancellationToken = default)\n+    {\n+        ThrowIfDisposed();\n+        \n+        // Critical bypass: skip the queue and flush directly\n+        // This ensures critical operations complete in <50ms instead of waiting for batching\n+        var immediateRequest = new FlushRequest(filePath, FlushPriority.Critical);\n+        var requests = new List<FlushRequest> { immediateRequest };\n+        \n+        try\n+        {\n+            await PerformFlushOperationAsync(requests, cancellationToken).ConfigureAwait(false);\n+            immediateRequest.SetCompleted();\n+        }\n+        catch (Exception ex)\n+        {\n+            immediateRequest.SetError(ex);\n+            throw;\n+        }\n+    }\n+\n+    /// <summary>\n+    /// CRITICAL SECURITY FIX: Forces immediate flush of specific files only, maintaining transaction isolation.\n+    /// Used for critical operations that require immediate durability guarantees while preserving\n+    /// MVCC isolation by only flushing files from the current transaction.\n+    /// \n+    /// This prevents critical operations from forcing persistence of other transactions' data,\n+    /// which could violate ACID properties and create security vulnerabilities.\n+    /// </summary>\n+    /// <param name=\"filePaths\">Collection of specific file paths to flush immediately</param>\n+    /// <param name=\"cancellationToken\">Cancellation token</param>\n+    /// <returns>Task that completes when all specified files have been flushed</returns>\n+    public async Task ForceImmediateFlushSpecificFilesAsync(ICollection<string> filePaths, CancellationToken cancellationToken = default)\n+    {\n+        ThrowIfDisposed();\n+        \n+        if (filePaths == null || filePaths.Count == 0)\n+        {\n+            return; // Nothing to flush\n+        }\n+        \n+        // Create critical requests for each file that exists\n+        var requests = filePaths\n+            .Where(File.Exists) // Only flush files that actually exist\n+            .Select(filePath => new FlushRequest(filePath, FlushPriority.Critical))\n+            .ToList();\n+        \n+        if (requests.Count == 0)\n+        {\n+            return; // No existing files to flush\n+        }\n+        \n+        try\n+        {\n+            // Critical bypass: skip the queue and flush directly\n+            // This ensures critical operations complete quickly while maintaining isolation\n+            await PerformFlushOperationAsync(requests, cancellationToken).ConfigureAwait(false);\n+            \n+            // Mark all requests as completed\n+            foreach (var request in requests)\n+            {\n+                request.SetCompleted();\n+            }\n+        }\n+        catch (Exception ex)\n+        {\n+            // Mark all requests as failed\n+            foreach (var request in requests)\n+            {\n+                request.SetError(ex);\n+            }\n+            throw;\n         }\n     }\n \n     /// <summary>\n     /// Queues a file for batch flushing\n@@ -165,14 +303,21 @@ public class BatchFlushCoordinator : IDisposable\n             while (await _reader.WaitToReadAsync(cancellationToken).ConfigureAwait(false))\n             {\n                 // Collect requests for batching\n                 var batchStartTime = DateTime.UtcNow;\n                 \n-                // Read available requests up to batch size or until timeout\n+                // CRITICAL FIX: Add bounds checking to prevent unbounded memory growth and infinite loops\n+                // Read available requests up to batch size or until timeout with safety limits\n+                var maxIterations = "
}