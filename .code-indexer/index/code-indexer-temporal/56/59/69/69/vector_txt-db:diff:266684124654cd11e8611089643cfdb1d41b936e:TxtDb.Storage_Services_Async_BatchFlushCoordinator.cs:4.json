{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/BatchFlushCoordinator.cs:4",
  "vector": [
    0.001963946,
    -0.007292917,
    0.004191077,
    0.047187142,
    -0.050941508,
    -0.028654654,
    -0.032329656,
    -0.02516865,
    0.048345216,
    0.009462715,
    0.021876069,
    0.005097562,
    0.06597843,
    -0.02313252,
    -0.047043461,
    -0.033980228,
    0.042437192,
    -0.035690222,
    -0.03779868,
    0.004549564,
    -0.018532798,
    -0.058162265,
    -0.063662425,
    0.049214296,
    -0.046454251,
    0.0060545,
    0.025127942,
    0.050710153,
    0.001581497,
    0.032790352,
    -0.023339564,
    -0.061301868,
    -0.021696929,
    0.034859776,
    0.014222123,
    0.025655206,
    -0.040944651,
    -0.033776283,
    0.025468467,
    0.021048887,
    0.026337743,
    0.009678507,
    0.038842324,
    -0.045232024,
    -0.000685481,
    -0.04607068,
    0.039180327,
    -0.029876517,
    0.027104188,
    -0.026440393,
    -0.001929884,
    -0.03067877,
    -0.000203097,
    0.012898535,
    0.01980895,
    -0.048825495,
    0.077803545,
    -0.000438447,
    -0.062243622,
    0.034230404,
    0.028039977,
    0.007879504,
    -0.010482965,
    0.048681352,
    -0.04117889,
    -0.023406368,
    -0.026654627,
    0.030503953,
    -0.018688034,
    -0.068475842,
    -0.010986377,
    0.016048249,
    -0.031019114,
    0.000349437,
    0.035591848,
    0.018444834,
    0.052631792,
    0.020218443,
    0.006661931,
    0.0141246,
    -0.034505993,
    -0.021432582,
    0.011232655,
    0.008237651,
    0.054480299,
    -0.040646173,
    0.008309593,
    -0.050282091,
    -0.018485198,
    0.020333301,
    -0.009435721,
    0.001493358,
    0.032655139,
    0.00621446,
    0.020470772,
    -0.000261728,
    0.052614551,
    0.00480921,
    0.00324946,
    -0.020743407,
    0.014360156,
    0.009928301,
    -0.003218011,
    0.055711072,
    -0.049424291,
    0.001661509,
    -0.01202899,
    -0.068729833,
    0.026231624,
    0.029695759,
    0.016477386,
    0.019924954,
    0.008822506,
    0.007995977,
    0.028066961,
    -0.006418048,
    -0.006790968,
    -0.012724737,
    0.006076337,
    0.024473052,
    -0.028391782,
    0.037749879,
    -0.033576742,
    0.021533266,
    -0.02769113,
    0.042221498,
    0.00757144,
    0.024791168,
    0.033250749,
    -0.028519524,
    0.015369821,
    -0.017833887,
    -0.021267712,
    0.013534103,
    -0.012511672,
    0.049516018,
    0.058389071,
    0.015105054,
    -0.030536219,
    -0.029918604,
    0.015841648,
    -0.001032452,
    -0.010645223,
    0.023360921,
    0.014679324,
    0.053371798,
    0.042818204,
    -0.018086439,
    -0.005096682,
    -0.066728212,
    -0.008947927,
    0.048704371,
    -0.032474987,
    0.001666125,
    0.023093533,
    0.015688041,
    -0.042043373,
    -0.02879844,
    -0.020234007,
    0.021948699,
    -0.028856071,
    0.032155536,
    -0.013622236,
    0.012923098,
    -0.029418595,
    0.063996844,
    0.023590248,
    -0.012059104,
    0.059127484,
    -0.069954224,
    -0.038558614,
    0.038514007,
    -0.093317837,
    -0.014856342,
    -0.016133066,
    0.048475388,
    -0.01180653,
    0.016630491,
    -0.069912203,
    -0.037998497,
    0.034661904,
    -0.027136974,
    0.006173882,
    -0.012024569,
    0.008300917,
    -0.033880297,
    0.03903877,
    -0.004336248,
    -0.032162011,
    -0.013478462,
    -0.025169972,
    0.018452667,
    -0.022931514,
    -0.016201159,
    0.007064142,
    -0.025404485,
    -0.013354591,
    -0.00606064,
    -0.025098657,
    0.039019842,
    -0.056275431,
    0.054748654,
    -0.083471671,
    -0.037893184,
    -0.011214941,
    0.002556245,
    0.000460165,
    0.008807052,
    0.015096396,
    -0.011172405,
    -0.010602379,
    0.023046732,
    0.008766842,
    -0.015346584,
    0.037679456,
    -0.007546721,
    -0.039788879,
    -0.007584696,
    0.000327232,
    -0.016355677,
    -0.030212805,
    -0.016071893,
    0.063556038,
    0.082230255,
    -0.002807519,
    -0.035901036,
    -0.03255862,
    -0.040570665,
    -0.00650461,
    -0.012547835,
    0.023744902,
    -0.044167858,
    0.009526751,
    -0.012734009,
    -0.044817917,
    0.053612854,
    -0.024834653,
    -0.048922133,
    -0.017996522,
    -0.020463148,
    -0.013926167,
    0.041877586,
    0.030309662,
    -0.007154447,
    -0.049517155,
    0.008041147,
    0.085625723,
    -0.008884193,
    -0.005766449,
    0.008962807,
    -0.0221863,
    0.010754217,
    -0.0486263,
    0.088989548,
    0.06237011,
    0.011673016,
    -0.015604298,
    0.027376594,
    0.028642314,
    0.026476029,
    0.014532623,
    0.020760506,
    0.004898074,
    -0.009778616,
    0.019709785,
    0.011865484,
    -0.041943986,
    -0.020125745,
    0.010210318,
    0.036690958,
    0.036673628,
    -0.005771225,
    0.022406098,
    -0.0129426,
    -0.017340142,
    -0.047324851,
    0.043929365,
    0.021596378,
    0.008604306,
    -0.000438436,
    -0.040007431,
    -0.028460028,
    0.005344449,
    -0.028325533,
    -0.01308619,
    -0.021412099,
    -0.019799221,
    -0.007654118,
    0.012607993,
    0.005332976,
    0.002898455,
    -0.018639101,
    -0.000182244,
    -0.000284711,
    0.046706844,
    0.03765595,
    0.043996964,
    -0.036767866,
    0.040863976,
    0.002055513,
    -0.04938893,
    0.013867912,
    0.060512658,
    0.049954295,
    -0.017268214,
    -0.011111771,
    0.008916218,
    -0.036258463,
    0.000953756,
    0.015367753,
    -0.084623285,
    0.001182216,
    0.008589875,
    0.018370785,
    0.057623766,
    -0.055616651,
    -0.061670862,
    -0.023060823,
    0.00154071,
    0.015809033,
    0.030849693,
    -0.020926805,
    0.048966952,
    -0.014755663,
    0.012747735,
    -0.013756418,
    -0.071930826,
    -0.03648917,
    0.017069472,
    -0.039342798,
    -0.015678907,
    0.014294373,
    -0.039430629,
    0.049302712,
    -0.000158145,
    0.01024092,
    -0.009295527,
    -0.001341708,
    -0.030097483,
    0.022838978,
    -0.010662284,
    -0.018842557,
    0.018442847,
    -0.020723484,
    0.075527869,
    -0.023033192,
    -0.00650685,
    -0.020553825,
    -0.014532316,
    0.035518121,
    -0.026539929,
    -0.064804971,
    0.002932261,
    0.019158874,
    -0.008169419,
    0.010118061,
    -0.02149068,
    0.023820657,
    -0.010496629,
    0.015171363,
    0.037125878,
    0.008733826,
    -0.052082036,
    -0.022305246,
    3.73e-07,
    0.004168261,
    -0.010520744,
    0.057546321,
    -0.04537899,
    0.027888378,
    -0.009619791,
    -0.088856682,
    -0.027588895,
    0.042518418,
    0.006501899,
    0.023867739,
    0.060013831,
    -0.023911431,
    0.02434545,
    -0.044863392,
    -0.030372113,
    0.002258374,
    -0.017492013,
    0.010039363,
    -0.009646132,
    -0.02025767,
    0.035142284,
    0.006518795,
    -0.000261513,
    0.037976451,
    -0.006545053,
    0.02525478,
    0.003323325,
    0.021207869,
    0.010173088,
    -0.028582562,
    0.004900815,
    0.019922787,
    -0.006236483,
    0.010936476,
    0.006702935,
    -0.021240652,
    0.055415299,
    -0.038340922,
    0.018047137,
    -0.010775974,
    0.012099039,
    0.025677435,
    -0.023742074,
    0.034727741,
    0.006980499,
    0.029536471,
    0.00385772,
    0.014425519,
    -0.002475492,
    0.022802945,
    -0.002259635,
    0.018728521,
    0.022028396,
    -0.034927242,
    -0.025928937,
    -0.013843517,
    0.019010028,
    -0.052470714,
    -0.022597663,
    -0.028454525,
    0.028414181,
    -0.092011273,
    -0.024113867,
    -0.012169803,
    -0.012667467,
    -0.045244448,
    -0.028824784,
    -0.003466555,
    0.039453406,
    -0.017657254,
    0.011419063,
    -0.034822274,
    -0.052519143,
    -0.023901645,
    0.00414094,
    -0.036873836,
    0.060853966,
    -0.024264107,
    -0.010574347,
    -0.044905938,
    0.004769041,
    0.06610994,
    -0.017396901,
    -0.038006805,
    -0.041867103,
    0.009572684,
    -0.043901388,
    0.014343658,
    0.01950619,
    -0.032160316,
    -0.041969188,
    0.033665583,
    0.003960452,
    -0.004199262,
    -0.014099319,
    -0.019240448,
    0.011958205,
    -0.008882423,
    0.010054751,
    0.006643266,
    0.02664729,
    -0.058625512,
    -0.024051344,
    -0.003859381,
    0.047726396,
    -0.011917583,
    -0.008725581,
    -0.012630822,
    0.028036376,
    0.017139738,
    -0.007130531,
    0.078806654,
    -0.005995953,
    -0.019445091,
    -0.023631852,
    -0.029365236,
    -0.060744446,
    -0.02918566,
    -0.029186483,
    0.008516761,
    -0.035872623,
    0.058085471,
    0.057213716,
    -0.010410669,
    0.009699426,
    -0.022665597,
    -0.00787821,
    -0.00252148,
    0.009949172,
    0.007027796,
    -0.006704388,
    0.008946069,
    -0.015664849,
    0.04073764,
    0.018234696,
    -0.073051758,
    0.01196237,
    -0.006394588,
    -0.040983327,
    0.048513804,
    0.012097432,
    -0.024956949,
    -0.099145062,
    0.035353094,
    -0.036655512,
    -0.002893743,
    -0.01812808,
    0.030542832,
    0.003923246,
    -0.027581505,
    0.006863671,
    0.021565842,
    0.019468151,
    -0.009383244,
    0.011089613,
    0.05372278,
    -0.010711649,
    -0.109983183,
    -0.007705342,
    -0.026587082,
    0.038887311,
    0.008532299,
    0.008944174,
    -0.000446039,
    -0.012291113,
    0.034084663,
    -0.035060391,
    -0.020608546,
    -0.002923255,
    0.007127071,
    0.023241846,
    -0.003827281,
    -0.000995695,
    -0.020537725,
    -0.0277403,
    -0.022824762,
    -0.060803916,
    -0.038262691,
    -0.019968616,
    -0.001552138,
    0.00843395,
    0.052333031,
    -0.009668256,
    -0.012879611,
    -0.008830656,
    0.011111968,
    0.039224021,
    0.050949465,
    -0.021836214,
    0.066675648,
    0.007386937,
    0.009263711,
    0.072146147,
    -0.017897215,
    0.035117839,
    0.034107473,
    0.018037861,
    0.032921176,
    -0.032759774,
    0.011824711,
    0.022122068,
    -0.005961494,
    0.0040686,
    -0.056870159,
    0.000127038,
    -0.006344091,
    -0.01703435,
    0.004914876,
    -0.003990018,
    0.017573871,
    0.062100433,
    -0.048053395,
    -0.011552674,
    -0.01879869,
    -0.008029363,
    0.013421941,
    0.01019965,
    0.024145272,
    -0.04496393,
    -0.05709549,
    0.017466214,
    -0.001785709,
    -0.028987983,
    -0.020508505,
    -0.008614588,
    -0.001748799,
    0.002743461,
    -0.073690452,
    0.083805114,
    -0.002901301,
    -0.000766565,
    -0.012182724,
    -0.000235835,
    -0.009412837,
    0.013119113,
    -0.028705625,
    0.066571862,
    0.025179347,
    -0.007218969,
    -0.035192505,
    0.031548135,
    0.011440718,
    0.064123884,
    0.02092978,
    0.002097229,
    -0.000823353,
    0.062855303,
    -0.003332217,
    0.027375491,
    -0.000340838,
    0.025260676,
    -0.054900762,
    0.032908749,
    0.04599607,
    0.000826457,
    -0.027936615,
    0.007746651,
    0.012963351,
    0.011589508,
    -0.00921088,
    0.03969077,
    -0.034200724,
    -0.007781181,
    0.000583834,
    0.015697261,
    0.008493478,
    -0.054329321,
    0.011190269,
    0.012009731,
    -0.010460826,
    0.017625662,
    -0.005024906,
    -0.00246451,
    -0.013491145,
    -0.032201312,
    -0.0052216,
    0.039625838,
    0.036821596,
    0.016426386,
    0.029169241,
    0.05096516,
    -0.042611163,
    -0.01352497,
    0.057889339,
    0.055027422,
    0.023409842,
    0.108974248,
    0.068079561,
    0.04914676,
    0.020241182,
    0.005084917,
    -0.02020763,
    -0.020040566,
    -0.005959245,
    0.015788091,
    -0.023679508,
    -0.017391166,
    0.038503263,
    0.041127626,
    -0.030356031,
    -0.047952652,
    0.007704564,
    -0.056396317,
    0.002191349,
    -0.038400751,
    0.018441442,
    0.025472714,
    -0.040205002,
    0.007492998,
    -0.016514989,
    -0.006391669,
    0.035714421,
    0.006247342,
    -0.019832904,
    0.011960639,
    0.059521724,
    0.013176539,
    -0.010929472,
    -0.004497357,
    -0.003867699,
    -0.039386503,
    0.028921535,
    0.000813612,
    0.008827864,
    0.007628391,
    0.002006169,
    0.077146485,
    -0.018939495,
    0.021947775,
    0.010941873,
    -0.010447032,
    0.000749981,
    -0.033597138,
    -0.059199329,
    -0.003688575,
    0.028146802,
    -0.010621121,
    0.013679183,
    0.024879387,
    -0.008747713,
    -0.02224974,
    0.028808869,
    0.066097051,
    0.044432167,
    -0.026762016,
    -0.047930144,
    0.006046069,
    0.048225656,
    0.004153887,
    -0.002312947,
    -0.035667259,
    -0.042603597,
    0.008384003,
    0.015239655,
    -0.010509285,
    -0.003930336,
    -0.043475449,
    -0.021221334,
    -0.002694889,
    -0.029203052,
    -0.00554525,
    0.003499313,
    0.08006572,
    -0.023432776,
    -0.034138557,
    -0.03033784,
    0.00945171,
    0.014142369,
    -0.05535803,
    0.013899645,
    -0.044928703,
    0.018317861,
    -0.041326586,
    0.007226082,
    0.034001891,
    0.021548476,
    -0.026612557,
    -0.002140065,
    -0.007795046,
    -0.01270368,
    -0.015782556,
    0.058314864,
    0.002010112,
    -0.079682462,
    -0.018807111,
    -0.012760693,
    0.015784383,
    -0.005812353,
    0.055352662,
    -0.016753046,
    -0.015608826,
    0.061010607,
    -0.025767583,
    0.04705606,
    -0.014398635,
    0.00800784,
    0.017373253,
    -0.005583254,
    -0.035721559,
    -0.036858566,
    0.025953658,
    0.003943715,
    -0.062135559,
    -0.010550227,
    -0.031085499,
    -0.007491105,
    -0.016606335,
    -0.001250858,
    -0.038809311,
    -0.035600092,
    0.032771129,
    0.019836931,
    -0.027179234,
    -0.013284478,
    0.003669852,
    0.015925288,
    0.011970474,
    -0.005298462,
    -0.040381141,
    0.018483121,
    0.014750726,
    0.041055661,
    -0.02933841,
    -0.077761836,
    0.046600018,
    0.007587398,
    -0.017751865,
    0.022548696,
    -0.00156596,
    0.012122808,
    -0.054739971,
    -0.01600619,
    -0.010894963,
    -0.040448681,
    -0.031231275,
    0.071009889,
    0.03711256,
    0.034784026,
    -0.019491227,
    -0.02602293,
    0.040993921,
    -0.04046138,
    0.02076276,
    0.007618374,
    0.02919819,
    -0.018380916,
    -0.000950495,
    -0.014655339,
    0.039842878,
    -0.054381892,
    -0.066846423,
    0.044739377,
    0.006234091,
    -0.015979078,
    0.001734914,
    -0.015601533,
    1.0205e-05,
    0.009544886,
    -0.028430909,
    0.013216785,
    0.006304226,
    0.006444632,
    -0.044857338,
    -0.030463349,
    -0.02936054,
    0.038823768,
    0.002746234,
    -0.035677623,
    0.049491797,
    0.012649361,
    0.038969357,
    0.052179117,
    0.003192227,
    -0.055897996,
    0.004517884,
    0.013571491,
    0.022451032,
    0.035700548,
    -0.047184605,
    -0.026760366,
    0.016823318,
    0.013308259,
    -0.005766327,
    0.037142273,
    0.013797804,
    -0.004574,
    -0.012210701,
    -0.009851935,
    -0.024862833,
    0.090046398,
    -0.028522477,
    0.013550637,
    -0.067054771,
    -0.000464599,
    0.056760423,
    0.009637602,
    -0.009335165,
    0.003843786,
    -0.000115549,
    -0.025344953,
    0.010978168,
    -0.013826385,
    -0.041046295,
    -0.03919024,
    -0.011083321,
    -0.002933888,
    -0.031856287,
    -0.008487104,
    0.020848105,
    -0.019442936,
    0.021626659,
    -0.008746575,
    -0.024889875,
    -0.001758586,
    0.004571738,
    -0.007592805,
    0.022412647,
    0.026822031,
    0.011205077,
    0.00016891,
    -0.013175495,
    -0.038804814,
    0.004617367,
    0.033752039,
    -0.049310982,
    -0.010051813,
    -0.007477575,
    0.0128654,
    0.015496388,
    0.028301092,
    0.021830445,
    -0.017584378,
    -0.009493115,
    0.028736865,
    -0.012444085,
    0.024275215,
    -0.036902271,
    0.033199612,
    0.051801845,
    -0.004916515,
    0.01932629,
    -0.016333515,
    0.026384214,
    0.02328386,
    0.004622643,
    -0.046573039,
    0.009588904,
    -0.049622498,
    -0.002259672,
    0.022178072,
    0.01606331,
    0.055483196,
    -0.013643166,
    -0.077123106,
    0.00178794,
    -0.019703617,
    -0.004165325,
    0.014520137,
    0.00043464,
    -0.018442394,
    -0.058422606,
    0.000940765,
    -0.021066882,
    0.047220517,
    -0.02542696,
    -0.022263853,
    -0.051629614,
    -0.015981084,
    -0.000959642,
    -0.002620738,
    0.015660947,
    0.008335568,
    0.02624335,
    -0.017639237,
    0.006405234,
    -0.016835367,
    -0.034221686,
    -0.018655116,
    -0.051136903,
    0.022445977,
    -0.001552057,
    -0.018304678,
    -0.003035068,
    -0.003172628,
    0.015865002,
    -0.012264368,
    0.024687722,
    0.034939662,
    0.009736086,
    0.042678244,
    -0.006778087,
    -0.031843677,
    -0.035403989,
    -0.005219225,
    0.019683557,
    0.00719801,
    0.057339914,
    0.020142712,
    0.005701769,
    -0.055230685,
    0.029142058,
    0.029284801,
    -0.003197569,
    0.037122771,
    -0.001762601,
    0.002191958,
    -0.028565817,
    -0.014008484,
    -0.024607977,
    -0.009014775,
    0.009889987,
    -0.019742806,
    -0.042131331,
    0.010720543,
    0.022643799,
    0.013264759,
    0.047332194,
    -0.035852674,
    -0.004642646,
    -0.072031766,
    -0.026321528,
    0.027744615,
    -0.054216348,
    -0.028734442,
    -0.044640679,
    0.034585282,
    0.002114891,
    0.031990107,
    -0.00667535,
    0.005843321,
    -0.028486235,
    -0.011378334,
    -0.001822889,
    -0.005268597,
    0.018680882,
    0.003033806,
    0.044883639,
    0.002811724,
    -0.001271585,
    -0.037199814,
    0.009695766,
    -0.011197586,
    0.034806281,
    0.013279296,
    -0.000770863,
    0.018388564,
    0.013202429,
    0.01346126,
    0.014851521,
    -0.008547728,
    0.035902862,
    -0.038138889,
    0.011224072,
    -0.015696481,
    0.000133866,
    -0.044800609,
    0.024206419,
    -0.076383762
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/BatchFlushCoordinator.cs",
    "chunk_index": 4,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": " but synchronous flush succeeded for {request.FilePath}: {flushAsyncEx.Message}\", flushAsyncEx);\n+                }\n+                \n+                // Both flushes succeeded - force OS buffer flush for guaranteed durability\n                 fileStream.Flush(flushToDisk: true);\n+                \n+                // Success! Record for circuit breaker and return\n+                RecordFlushSuccess();\n+                return;\n+            }\n+            catch (OperationCanceledException) when (cancellationToken.IsCancellationRequested)\n+            {\n+                // Main cancellation token was cancelled - don't retry\n+                RecordFlushFailure();\n+                throw;\n+            }\n+            catch (OperationCanceledException ex)\n+            {\n+                // Timeout occurred\n+                lastException = new TimeoutException($\"Flush operation timed out after {_config.FlushTimeoutMs}ms for {request.FilePath}\", ex);\n+            }\n+            catch (UnauthorizedAccessException ex)\n+            {\n+                // File locked - could be transient, but record failure\n+                lastException = new IOException($\"Cannot open {request.FilePath} for flushing - file is locked or insufficient permissions: {ex.Message}\", ex);\n             }\n             catch (Exception ex) when (!(ex is FileNotFoundException))\n             {\n-                throw new IOException($\"Failed to flush {request.FilePath}: {ex.Message}\", ex);\n+                lastException = new IOException($\"Failed to flush {request.FilePath}: {ex.Message}\", ex);\n+            }\n+\n+            // If we've reached the max attempts, don't delay\n+            if (attempts >= maxAttempts)\n+                break;\n+\n+            // Exponential backoff delay before retry\n+            var delayMs = _config.RetryDelayMs * (int)Math.Pow(2, attempts - 1);\n+            try\n+            {\n+                await Task.Delay(delayMs, cancellationToken).ConfigureAwait(false);\n+            }\n+            catch (OperationCanceledException)\n+            {\n+                // Cancellation requested during retry delay\n+                break;\n             }\n         }\n+\n+        // All attempts failed\n+        RecordFlushFailure();\n+        throw lastException ?? new IOException($\"Failed to flush {request.FilePath} after {attempts} attempts\");\n     }\n \n+    /// <summary>\n+    /// Circuit breaker implementation for handling continuous failures\n+    /// Prevents resource exhaustion and provides fail-fast behavior\n+    /// </summary>\n+    private bool ShouldBypassCircuitBreaker()\n+    {\n+        lock (_circuitBreakerLock)\n+        {\n+            if (!_circuitBreakerOpen)\n+                return false;\n+                \n+            // Check if circuit breaker timeout has elapsed\n+            if (DateTime.UtcNow - _lastFailureTime > CircuitBreakerTimeout)\n+            {\n+                // Reset circuit breaker to half-open state\n+                _circuitBreakerOpen = false;\n+                _consecutiveFailures = 0;\n+                return false;\n+            }\n+            \n+            return true; // Circuit breaker is open, bypass operation\n+        }\n+    }\n+    \n+    private void RecordFlushSuccess()\n+    {\n+        lock (_circuitBreakerLock)\n+        {\n+            _consecutiveFailures = 0;\n+            _circuitBreakerOpen = false;\n+        }\n+    }\n+    \n+    private void RecordFlushFailure()\n+    {\n+        lock (_circuitBreakerLock)\n+        {\n+            _consecutiveFailures++;\n+            _lastFailureTime = DateTime.UtcNow;\n+            \n+            if (_consecutiveFailures >= MaxConsecutiveFailures)\n+            {\n+                _circuitBreakerOpen = true;\n+            }\n+        }\n+    }\n+    \n     private void ThrowIfDisposed()\n     {\n         if (_disposed)\n             throw new ObjectDisposedException(nameof(BatchFlushCoordinator));\n     }\n@@ -327,16 +628,73 @@ public class BatchFlushCoordinator : IDisposable\n \n         _disposed = true;\n         \n         try\n         {\n-            StopAsync().Wait(TimeSpan.FromSeconds(5));\n+           "
}