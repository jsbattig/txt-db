{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs:5",
  "vector": [
    0.020609677,
    -0.009531111,
    -0.00434204,
    0.051805221,
    -0.010572872,
    0.009293607,
    -0.00657988,
    -0.004519718,
    0.051624507,
    -0.002591022,
    0.0229403,
    -0.013650831,
    0.067740381,
    -0.000904547,
    -0.091641337,
    -0.028186865,
    0.035375085,
    0.004413014,
    -0.056062747,
    0.003447028,
    -0.021012032,
    -0.039740879,
    -0.048212189,
    0.065737985,
    -0.038821016,
    0.01597169,
    0.023135796,
    0.033003382,
    -3.5786e-05,
    0.044814087,
    -0.023864361,
    -0.044738304,
    0.029735219,
    0.032264125,
    0.037539527,
    -0.024234911,
    -0.025860533,
    -0.022642037,
    -0.023806589,
    0.031179348,
    0.030926075,
    -0.027196597,
    0.020187108,
    -0.03077485,
    0.00922077,
    -0.038280692,
    0.01464577,
    -0.00035035,
    0.019801697,
    0.017366083,
    -0.003152909,
    -0.002329046,
    -0.029519301,
    0.068307064,
    0.003231425,
    -0.047571559,
    0.075991176,
    0.029155487,
    -0.040626887,
    0.051773086,
    -0.046986993,
    -0.042718884,
    -0.005303505,
    0.002443172,
    -0.009053812,
    -0.05027315,
    -0.055413045,
    0.041615661,
    0.02767664,
    -0.069638297,
    0.012103742,
    0.016885487,
    -0.002167497,
    0.047057234,
    0.031845372,
    0.039493181,
    0.055044375,
    0.028676659,
    0.028465927,
    0.009456213,
    -0.036223963,
    -0.034361627,
    0.004211643,
    -0.030701965,
    0.022940369,
    -0.017189896,
    0.029142126,
    -0.068413697,
    0.004833203,
    -0.007795995,
    -0.02191774,
    0.053819899,
    0.042946186,
    0.019916972,
    0.011181762,
    0.025379423,
    0.003604938,
    0.011286814,
    0.036814973,
    -0.018388873,
    -0.011530354,
    -0.006082044,
    -0.034211684,
    0.064341038,
    -0.064702131,
    -0.010410681,
    0.011684096,
    -0.048948605,
    0.006818004,
    0.029049704,
    0.042816341,
    0.005552411,
    0.019413806,
    0.003011915,
    0.01059447,
    0.00395641,
    -0.005137762,
    -0.014853784,
    0.020104159,
    0.063118622,
    -0.006386787,
    0.003812031,
    -0.030223072,
    0.029720211,
    -0.02586296,
    0.058461674,
    0.008651747,
    0.063799828,
    0.008731041,
    -0.027925372,
    0.00096705,
    -0.044268988,
    0.018358596,
    0.022078587,
    0.008609602,
    0.041879002,
    0.004570018,
    0.04717141,
    -0.004555332,
    -0.040572792,
    0.034032948,
    -0.009396839,
    -0.010232258,
    0.026522256,
    -0.010346401,
    0.003532772,
    0.044679608,
    -0.009816933,
    0.000573076,
    -0.07735464,
    0.003716599,
    0.046326231,
    -0.042465594,
    0.016540028,
    -0.011873611,
    0.042223141,
    -0.009151457,
    -0.028853662,
    0.011616096,
    -0.031504054,
    -0.042412803,
    0.011133364,
    0.037031256,
    0.019167271,
    -0.031894341,
    0.058338869,
    -0.01051585,
    -0.006505745,
    0.012067273,
    -0.031047085,
    -0.079442017,
    0.019666206,
    -0.046175085,
    0.009636354,
    -0.033492137,
    0.003695987,
    0.055528082,
    0.014235996,
    -0.070746467,
    -0.042432703,
    0.014973447,
    0.014468957,
    -0.007686532,
    0.021552067,
    -0.010811009,
    -0.005987225,
    0.055969007,
    0.023879696,
    0.028812878,
    0.014583802,
    -0.036956564,
    0.001949092,
    -0.045149442,
    -0.012040049,
    -0.023726221,
    -0.008774531,
    -0.02411058,
    -0.015557259,
    0.043467049,
    0.022715261,
    -0.031963419,
    0.030464139,
    -0.070249833,
    -0.008937593,
    0.019853417,
    -0.004845149,
    -0.02543173,
    -0.056199871,
    0.004447115,
    0.01770035,
    -0.002178389,
    -0.026420446,
    0.018635409,
    -0.0260903,
    0.024166051,
    -0.002088653,
    -0.054674055,
    -0.009503491,
    0.042706348,
    0.002856168,
    0.00765037,
    -0.018210085,
    0.053271573,
    0.023312008,
    -0.043833192,
    -0.028264225,
    -0.060601499,
    -0.042440929,
    -0.023510577,
    -0.030633353,
    0.01826602,
    -0.045300029,
    0.020088403,
    -0.047619645,
    -0.086501248,
    0.036474623,
    0.013608089,
    -0.013931637,
    -0.00659107,
    -0.018009057,
    -0.013964723,
    0.064349823,
    0.001589774,
    0.001684966,
    -0.041050602,
    0.014076862,
    0.061242945,
    0.009625018,
    -0.007735274,
    -0.005169909,
    -0.049819786,
    0.045853768,
    -0.028321402,
    0.075009838,
    0.058124494,
    0.002660719,
    -0.024247622,
    0.00465299,
    0.021448703,
    -0.025544155,
    -0.002750848,
    -0.002035913,
    -0.015654109,
    0.024099607,
    -0.009170543,
    0.043837741,
    -0.027872091,
    -0.02306889,
    -0.008624711,
    0.039416727,
    0.02041815,
    0.0276933,
    0.029664276,
    0.013050348,
    0.001495619,
    -0.019749654,
    0.032166082,
    0.056982491,
    0.022714721,
    0.003504228,
    -0.06439767,
    -0.002483632,
    0.012733301,
    -0.025189823,
    -0.012043809,
    -0.034183037,
    0.037795193,
    -0.004598164,
    0.057769284,
    0.024785034,
    0.027901089,
    -0.021974929,
    -0.008978203,
    -0.018797908,
    0.075601414,
    0.011720885,
    0.029026693,
    -0.010456904,
    -0.011768171,
    -0.057678726,
    -0.02029434,
    -0.013046293,
    0.048191715,
    0.007609177,
    0.018033393,
    0.025123151,
    0.031886041,
    -0.022725133,
    0.020473963,
    -0.031670272,
    -0.054234639,
    -0.011491861,
    0.035990205,
    -0.000509011,
    0.048930265,
    -0.039479759,
    -0.022838278,
    -0.005688355,
    -0.00926271,
    0.00668778,
    0.001147076,
    -0.017053885,
    0.016994892,
    -0.086439036,
    0.030831868,
    0.001293276,
    -0.064863637,
    -0.025843881,
    0.03212465,
    -0.025439646,
    -0.008992956,
    0.039316345,
    -0.019059194,
    0.055882555,
    0.001659041,
    0.031046361,
    -0.030926831,
    0.012073682,
    -0.035346996,
    0.015068,
    -0.009417081,
    -0.027101506,
    0.017563418,
    -0.02300071,
    0.070683718,
    -0.026974218,
    -0.000730688,
    -0.014710705,
    -0.014932088,
    0.046348143,
    -0.019124411,
    -0.051662218,
    0.014671425,
    0.008259215,
    -0.043356258,
    0.035778459,
    -0.014016465,
    0.036215372,
    -0.019605197,
    0.019248888,
    0.023014413,
    0.048100933,
    -0.032499779,
    -0.015904654,
    -0.025733238,
    -0.014442471,
    -0.020363776,
    0.063428439,
    -0.018926179,
    0.002559842,
    -0.06451878,
    -0.041334897,
    -0.039815936,
    -0.009128252,
    0.004646908,
    0.015432735,
    0.026282877,
    0.002618955,
    -0.02532376,
    -0.019635802,
    0.022198979,
    0.009272031,
    0.028094394,
    0.005900759,
    -0.020986343,
    -0.034523301,
    0.024959043,
    0.0270421,
    -0.024053272,
    0.058032975,
    -0.021368451,
    0.032849152,
    0.022165088,
    -0.008451015,
    -0.023946753,
    -0.026077675,
    0.005813054,
    0.039695788,
    0.006085364,
    -0.055710606,
    0.020659156,
    -0.006181629,
    0.016120568,
    -0.086986408,
    0.008523843,
    0.011621036,
    0.009142726,
    0.037881419,
    0.009885521,
    0.035419255,
    -0.015346917,
    0.024838706,
    -0.033243541,
    0.026746556,
    -0.034974951,
    0.051740658,
    -0.030986993,
    -0.020127118,
    0.025052901,
    -0.022728287,
    -0.022847829,
    -0.032329619,
    -0.002515848,
    -0.003512394,
    -0.0397266,
    0.021926697,
    0.008353479,
    -0.081259832,
    -0.027358761,
    0.005280067,
    0.005782527,
    0.008531654,
    -0.038126346,
    0.02376996,
    0.023468142,
    -0.046552319,
    0.022313816,
    -0.004066657,
    -0.032345366,
    -0.037946142,
    0.034997247,
    -0.033821594,
    0.016769046,
    -0.017780554,
    -0.013254723,
    -0.01764193,
    0.034687165,
    0.041488949,
    -0.029547704,
    -0.015656685,
    -0.070934705,
    -0.02105643,
    -0.047449436,
    -0.00622238,
    0.072425865,
    -0.028830895,
    0.007361286,
    0.047026426,
    -0.002332884,
    -0.051738698,
    -0.037062168,
    -0.03280843,
    -0.000342254,
    0.002314001,
    0.005852832,
    0.03213622,
    0.034460135,
    -0.03085318,
    -0.015714489,
    0.007649048,
    0.039921712,
    -0.023456257,
    -0.007322609,
    0.009992818,
    0.041655291,
    0.020896681,
    0.009795942,
    0.045713861,
    -0.019033754,
    -0.046649579,
    -0.025899049,
    -0.060590386,
    -0.030367197,
    -0.043562524,
    0.000956507,
    -0.0066325,
    -0.027731339,
    0.03592892,
    0.003918306,
    -0.01646742,
    -0.011244017,
    0.003983232,
    -0.017202843,
    -0.011984147,
    0.006383348,
    0.001334165,
    -0.013502724,
    -0.033675306,
    -0.022292407,
    0.046717472,
    0.020493781,
    -0.098278649,
    0.023472454,
    -0.020169558,
    -0.025379397,
    0.027435383,
    0.006572872,
    -0.030803742,
    -0.083405592,
    0.022430582,
    -0.006807658,
    0.001981033,
    -0.005747759,
    -0.002027625,
    0.043986931,
    -0.035061933,
    -0.022515016,
    0.065780558,
    -0.003172257,
    -0.023029266,
    0.033860736,
    -0.02365895,
    -0.039742172,
    -0.055873599,
    -0.000914714,
    -0.01106609,
    0.008996477,
    0.011636851,
    0.019850831,
    -0.014519725,
    0.013718589,
    0.022717252,
    -0.002137347,
    -0.04462019,
    0.010885523,
    -0.006193749,
    0.011273124,
    0.019798614,
    -0.005848741,
    -0.008415827,
    -0.048888151,
    0.009472042,
    -0.015823521,
    -0.044997431,
    0.033788476,
    0.002694743,
    0.012636264,
    0.032867957,
    0.007513997,
    -0.000476428,
    -0.020618167,
    0.036105573,
    0.037219238,
    0.068382829,
    -0.047327302,
    0.071612261,
    0.015331549,
    -0.014459236,
    0.059244163,
    -0.029557956,
    0.042039853,
    0.01424123,
    -0.002057328,
    -0.002064464,
    -0.059627865,
    0.021491382,
    0.04101241,
    0.012716013,
    -0.043573976,
    -0.016508864,
    -0.018472627,
    -0.01768741,
    0.032454859,
    0.005236347,
    -0.020818979,
    0.016474336,
    0.033706669,
    -0.065295845,
    -0.008930702,
    0.017718907,
    0.005596108,
    0.014718627,
    0.027685095,
    0.024916017,
    0.001705765,
    -0.062783852,
    0.019619629,
    0.001930526,
    -0.040164389,
    -0.030963959,
    0.045182474,
    -0.021435538,
    0.041030757,
    -0.028301675,
    0.059411325,
    0.008027158,
    -0.013226137,
    -0.01465804,
    -0.02413407,
    -0.035364844,
    -0.012041399,
    0.021244619,
    0.04545122,
    0.0284032,
    -0.019200968,
    -0.034685295,
    0.033025187,
    -0.017997406,
    0.056202985,
    0.040964592,
    0.008462118,
    0.012820179,
    0.06929411,
    -0.00320185,
    0.032164186,
    0.011887292,
    0.017755868,
    -0.07770104,
    0.037190866,
    0.006760671,
    0.034118205,
    -0.026307253,
    -0.020119935,
    -0.034518,
    0.001571141,
    -0.032116454,
    0.030370092,
    0.013027568,
    0.029697884,
    0.011184071,
    -0.008349425,
    0.013397997,
    -0.056575444,
    0.039904997,
    -0.003789501,
    0.016967287,
    0.010939213,
    0.015887924,
    -0.003202792,
    0.01534967,
    -0.026079459,
    -0.002370179,
    0.025201917,
    0.004391197,
    0.059250057,
    0.036825038,
    0.04275848,
    -0.044054236,
    -0.018286442,
    0.03731757,
    0.028507195,
    0.004439414,
    0.106534027,
    0.032442085,
    0.019543402,
    0.007744438,
    -0.003941067,
    -0.016514702,
    -0.030435398,
    -0.00259347,
    -0.026140533,
    -0.03308782,
    -0.000792909,
    0.009535566,
    0.026657494,
    -0.013198835,
    -0.010991964,
    0.028054805,
    -0.038562525,
    -0.007090616,
    -0.022229441,
    0.015564937,
    -0.05305611,
    -0.01426406,
    -0.0178998,
    -0.014409037,
    0.000465957,
    0.036241584,
    -0.01664824,
    0.012251461,
    0.013305553,
    0.067657545,
    -0.021774292,
    -0.015716508,
    -0.061269019,
    0.003472654,
    -0.019817019,
    0.043279722,
    -0.010040688,
    0.010391184,
    -0.013842854,
    -0.033388793,
    0.068639711,
    -0.020105094,
    -0.006368067,
    0.004078184,
    0.030090936,
    -0.02303784,
    -0.033768669,
    -0.029680492,
    -0.01090854,
    0.043837532,
    0.00255364,
    0.022720778,
    0.0052103,
    -0.026702402,
    -0.01327325,
    -0.02927294,
    0.066808365,
    -0.012599827,
    -0.011071469,
    -0.027780155,
    0.00223444,
    0.009400317,
    0.004747573,
    -0.005395616,
    -0.041939858,
    -0.058157396,
    0.001785954,
    0.029221293,
    0.031730704,
    -0.022141196,
    -0.051222559,
    0.006903559,
    -0.001052569,
    -0.008122214,
    0.008704873,
    -0.00104346,
    0.05571232,
    -0.006912136,
    -0.021873938,
    0.022359105,
    0.014568862,
    0.028352732,
    -0.071365058,
    -0.002288844,
    -0.066237532,
    0.01201535,
    -0.030332237,
    -0.006922116,
    0.012442382,
    0.014264155,
    -0.028034445,
    0.014853738,
    0.001530152,
    0.007049199,
    -0.031841971,
    0.016138552,
    -0.011051673,
    -0.032118507,
    -0.03845454,
    0.017946932,
    0.021578006,
    0.001873252,
    0.048794903,
    -0.00633505,
    -0.026008911,
    0.051128767,
    -0.020602208,
    0.040051393,
    -0.02635848,
    0.026192065,
    -0.010968297,
    -0.053980485,
    -0.028213477,
    -0.047719564,
    0.001338905,
    0.034577917,
    -0.053819936,
    0.009066414,
    -0.055014506,
    -0.001765439,
    -0.018319855,
    0.024366314,
    -0.020321991,
    -0.043284267,
    0.032176133,
    -0.001531777,
    -0.026655883,
    -0.006857177,
    -0.000222883,
    0.001722943,
    0.017093822,
    -0.010777708,
    -0.034706671,
    0.011742066,
    -0.003756519,
    0.023396043,
    -0.038114402,
    -0.047368631,
    0.055171527,
    -0.00448868,
    -0.02148154,
    0.020373443,
    0.017132232,
    0.00513149,
    -0.05152858,
    -0.035835911,
    0.002828415,
    0.015480089,
    -0.052645948,
    0.036499005,
    0.003029313,
    0.060849216,
    -0.013175881,
    -0.023198318,
    0.057365105,
    -0.005545039,
    0.014523887,
    -0.018220492,
    -0.000761642,
    -0.012740468,
    -0.050578158,
    0.012441522,
    0.034401182,
    -0.002642556,
    -0.0655763,
    0.010897848,
    -0.001294428,
    -0.007246444,
    0.026944956,
    0.010456315,
    0.030420117,
    0.009256136,
    -0.036487605,
    0.004170735,
    -0.02438627,
    0.004050802,
    0.003067179,
    -0.003181077,
    -0.055136457,
    0.032633398,
    -0.010190552,
    -0.017963607,
    0.046904862,
    -0.00297421,
    -0.02546878,
    0.033703662,
    0.005756281,
    -0.038748097,
    -0.012617372,
    0.015941996,
    0.039201338,
    -0.01401529,
    -0.041590761,
    -0.05327829,
    -0.017719872,
    0.001535487,
    -0.027820079,
    0.021533079,
    0.004996925,
    -0.011403828,
    -0.010287633,
    -0.019059289,
    -0.018264797,
    0.054360613,
    -0.004483466,
    0.012046009,
    -0.046805095,
    -0.023663202,
    0.052426998,
    0.057329528,
    0.005453841,
    -0.023511708,
    -0.042274751,
    -0.045261964,
    -0.000593469,
    -0.006991792,
    -0.045040399,
    -0.022686776,
    -0.011688876,
    0.051561687,
    -0.066237532,
    -0.00136067,
    0.031998444,
    0.005888974,
    0.043039117,
    -0.024545837,
    -0.029506773,
    0.033211857,
    0.002380473,
    0.01258002,
    0.019699642,
    0.020361261,
    0.018456561,
    -0.030019637,
    -0.028786309,
    -0.000507761,
    -0.026388129,
    0.025994824,
    -0.035233628,
    -0.013706823,
    -0.000424259,
    0.063204452,
    -0.004908375,
    0.0704749,
    -0.001664763,
    0.00125026,
    0.006793159,
    0.002436463,
    -0.008573414,
    0.030422274,
    -0.037384562,
    0.070313543,
    0.03370605,
    -0.002416509,
    -0.008121351,
    0.012130604,
    0.005633292,
    0.061141863,
    0.004677063,
    -0.035214543,
    0.004374671,
    -0.035674565,
    -0.0136785,
    -0.017534703,
    0.034300506,
    0.045862753,
    -0.004932717,
    -0.036263507,
    0.008968624,
    -0.024891131,
    0.000906928,
    0.041036099,
    0.029987508,
    -0.001202052,
    -0.051898163,
    -0.000480515,
    -0.041882094,
    0.026944704,
    -0.016633026,
    -0.000312104,
    -0.001290122,
    0.009017256,
    0.001144633,
    -0.010128145,
    -0.022362571,
    0.039811935,
    0.033071999,
    -0.026903139,
    0.011563124,
    -0.020077793,
    -0.019545246,
    -0.012493439,
    -0.047419243,
    -0.020443046,
    -0.006137267,
    0.036018848,
    0.022785835,
    -0.011824232,
    -0.00713381,
    -0.025148978,
    0.020957259,
    0.0492201,
    0.0343748,
    0.012160539,
    -0.037023995,
    -0.027470546,
    -0.028390445,
    -0.020312089,
    0.015394008,
    -0.014366355,
    0.022209868,
    0.029382924,
    0.025273811,
    0.0077668,
    0.051508784,
    0.048635818,
    0.039428458,
    0.004847654,
    0.001891113,
    -0.035070498,
    -0.032522559,
    -0.0079019,
    -0.00090343,
    0.005290874,
    0.019422792,
    0.011063698,
    -0.046434276,
    0.005859627,
    0.062564082,
    0.003713041,
    0.04705878,
    -0.013517361,
    0.016044762,
    -0.046358898,
    -0.068265155,
    0.032244235,
    -0.05764468,
    -0.026028797,
    0.009363264,
    0.011307107,
    0.027559735,
    0.022471938,
    -0.00542806,
    -0.012711487,
    -0.048554998,
    -0.03205429,
    0.020025486,
    -0.008583271,
    0.02522973,
    -3.25e-06,
    0.021723514,
    -0.009487726,
    -0.003957279,
    -0.045430664,
    0.015180656,
    0.01608742,
    0.057180628,
    0.03667789,
    0.013608167,
    0.036538776,
    0.029753145,
    0.014933104,
    -0.002327224,
    0.032219946,
    0.037671994,
    -0.017334707,
    0.027385026,
    0.024688983,
    0.003451822,
    -0.032518968,
    0.018978428,
    -0.055569749
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs",
    "chunk_index": 5,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "ncelled during pattern matching\", ex, cancellationToken);\n+            }\n+            \n+            // Read page content asynchronously with frequent cancellation checks\n             var readTasks = pageGroups.Select(async pageId =>\n             {\n+                // Check cancellation before reading each page\n+                cancellationToken.ThrowIfCancellationRequested();\n+                \n                 var pageContent = await ReadPageInternalAsync(transactionId, namespaceName, pageId, cancellationToken).ConfigureAwait(false);\n                 if (pageContent.Length > 0)\n                 {\n                     return new KeyValuePair<string, object[]>(pageId, pageContent);\n                 }\n                 return default(KeyValuePair<string, object[]>?);\n             });\n             \n             var pageResults = await Task.WhenAll(readTasks).ConfigureAwait(false);\n             \n+            // Check cancellation before final result processing\n+            cancellationToken.ThrowIfCancellationRequested();\n+            \n             foreach (var pageResult in pageResults.Where(r => r.HasValue))\n             {\n+                // Check cancellation during result aggregation\n+                cancellationToken.ThrowIfCancellationRequested();\n+                \n                 var kvp = pageResult!.Value;\n                 result[kvp.Key] = kvp.Value;\n             }\n             \n             return result;\n@@ -355,22 +484,31 @@ public class AsyncStorageSubsystem : StorageSubsystem, IAsyncStorageSubsystem\n                 cancellationToken.ThrowIfCancellationRequested();\n                 \n                 // Ensure namespace directory exists\n                 Directory.CreateDirectory(namespacePath);\n                 \n+                // Check cancellation before starting CPU-intensive operations\n+                cancellationToken.ThrowIfCancellationRequested();\n+                \n                 // Find or create page for insertion\n                 var pageId = FindOrCreatePageForInsertion(namespaceName, obj);\n                 var fullPageId = $\"{namespaceName}:{pageId}\";\n                 \n+                // Check cancellation before reading current content\n+                cancellationToken.ThrowIfCancellationRequested();\n+                \n                 // Read current page content\n                 object[] currentContent;\n                 if (transaction.WrittenPages.ContainsKey(fullPageId))\n                 {\n                     var versionFile = Path.Combine(namespacePath, $\"{pageId}{_formatAdapter.FileExtension}.v{transactionId}\");\n                     if (File.Exists(versionFile))\n                     {\n                         var content = await File.ReadAllTextAsync(versionFile, cancellationToken).ConfigureAwait(false);\n+                        \n+                        // Check cancellation before deserialization (CPU-intensive for large data)\n+                        cancellationToken.ThrowIfCancellationRequested();\n                         currentContent = _formatAdapter.DeserializeArray(content, typeof(object));\n                     }\n                     else\n                     {\n                         currentContent = Array.Empty<object>();\n@@ -379,21 +517,29 @@ public class AsyncStorageSubsystem : StorageSubsystem, IAsyncStorageSubsystem\n                 else\n                 {\n                     currentContent = await ReadPageInternalAsync(transactionId, namespaceName, pageId, cancellationToken).ConfigureAwait(false);\n                 }\n                 \n+                // Check cancellation before processing large data\n+                cancellationToken.ThrowIfCancellationRequested();\n+                \n                 var newContent = currentContent.Concat(new[] { obj }).ToArray();\n                 \n-                // Write new version asynchronously\n+                // Write new version asynchronously with cancellation support\n                 await WritePageVersionAsync(transactionId, namespaceName, pageId, newContent, cancellationToken).ConfigureAwait(false);\n                 \n    "
}