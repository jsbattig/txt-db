{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/BatchFlushCoordinator.cs:2",
  "vector": [
    0.007606721,
    -0.007609691,
    -0.014788817,
    0.05902366,
    -0.057497896,
    -0.029654583,
    -0.016586469,
    -0.007617617,
    0.061600801,
    -0.0027305,
    0.017445253,
    0.038490437,
    0.054262172,
    -0.039352939,
    -0.051702503,
    -0.014261913,
    0.028285969,
    -0.020539138,
    -0.031409919,
    -0.002888234,
    -0.02911984,
    -0.058436111,
    -0.074596018,
    0.046456471,
    -0.046416402,
    -0.007280183,
    0.028718978,
    0.045713175,
    -0.007259412,
    0.03866981,
    -0.034393758,
    -0.064403124,
    -0.001254332,
    0.038221173,
    0.011250703,
    0.007083827,
    -0.057685848,
    -0.018007599,
    0.001302966,
    0.022860734,
    0.021042194,
    -0.011566089,
    0.019581098,
    -0.05754251,
    0.013789372,
    -0.042643536,
    0.043657325,
    -0.007778751,
    0.019028278,
    -0.017090779,
    -0.007449396,
    -0.014240152,
    -0.007425937,
    0.0071313,
    0.010844871,
    -0.046393681,
    0.082864977,
    0.016262252,
    -0.061777521,
    0.041346595,
    0.002574015,
    0.005052712,
    -0.020781429,
    0.075548381,
    -0.028148985,
    -0.026746888,
    -0.044140447,
    0.033456855,
    -0.002087468,
    -0.081735894,
    0.002751864,
    0.05212564,
    -0.041633751,
    -0.003476423,
    0.022121692,
    0.014001658,
    0.022313222,
    0.012643574,
    0.001384364,
    0.010545448,
    -0.04000197,
    -0.040543146,
    -0.002613381,
    -0.01461655,
    0.050464287,
    -0.046472169,
    0.014342408,
    -0.067853808,
    -0.016923547,
    0.022442261,
    -0.018831106,
    0.01847369,
    0.034183118,
    0.008763684,
    0.037704434,
    -0.008485727,
    0.050004371,
    0.009919261,
    0.006803644,
    -0.010478145,
    0.030480834,
    0.018656602,
    -0.020681309,
    0.040322304,
    -0.059057005,
    -0.000162114,
    -0.003394641,
    -0.057047386,
    0.016073301,
    0.028431462,
    0.032908227,
    0.008934584,
    -0.010397465,
    0.004313162,
    0.018581247,
    0.018112866,
    -0.023292441,
    -0.017974291,
    0.014463744,
    0.060472332,
    -0.032228712,
    0.040419098,
    -0.032749735,
    0.046340767,
    -0.031496536,
    0.04618188,
    0.02104261,
    0.03613412,
    0.013228121,
    -0.017512845,
    0.010844274,
    -0.001211842,
    -0.013946735,
    0.005254235,
    -0.017597396,
    0.051473457,
    0.042590469,
    0.02232956,
    -0.004165796,
    -0.018026726,
    0.025194826,
    0.004648105,
    -0.009229603,
    0.030133296,
    0.026559662,
    0.073770046,
    0.028091127,
    -0.000962605,
    -0.002038549,
    -0.057942707,
    0.003452152,
    0.038364243,
    -0.036001481,
    0.002547437,
    0.004025366,
    0.017268581,
    -0.028903527,
    -0.018012067,
    0.0081597,
    0.030925889,
    -0.054412134,
    0.025393194,
    -0.006762593,
    0.013089419,
    -0.02199192,
    0.039991062,
    0.007761476,
    0.00422051,
    0.049768247,
    -0.045352969,
    -0.051246881,
    0.048340276,
    -0.085421823,
    -0.015863204,
    -0.014018034,
    0.022655785,
    -1.684e-06,
    0.0080988,
    -0.071361504,
    -0.026729815,
    0.014528862,
    -0.021517087,
    -0.015708579,
    -0.005267031,
    0.03094955,
    -0.040237427,
    0.016582051,
    -0.00785879,
    -0.018642619,
    -0.026633494,
    -0.007194856,
    0.016069626,
    -0.022540195,
    -0.035492878,
    -0.021351147,
    -0.018285725,
    -0.001812255,
    -0.005267215,
    -0.009029679,
    0.034714881,
    -0.03721834,
    0.020316718,
    -0.065238476,
    -0.037626687,
    0.017874848,
    0.000509468,
    -0.01911683,
    -0.001744332,
    0.001747814,
    -0.023628691,
    -0.008463449,
    0.012055231,
    -0.007546444,
    -0.010006846,
    0.005258772,
    -0.027003948,
    -0.052219715,
    -0.014225332,
    -0.01176344,
    -0.00696197,
    -0.022467831,
    0.008926256,
    0.07165356,
    0.053445835,
    -0.025339214,
    -0.041051444,
    -0.039307863,
    -0.047195129,
    -0.020322733,
    0.002870869,
    0.022201888,
    -0.051865328,
    0.00440371,
    -0.003362382,
    -0.055646382,
    0.058658082,
    -0.032762215,
    -0.038698278,
    0.005629895,
    -0.015052647,
    0.002318098,
    0.042614143,
    0.017892566,
    -0.00321399,
    -0.041381199,
    -0.001776491,
    0.093244381,
    -0.024222413,
    0.023356883,
    0.032428693,
    -0.009147843,
    0.040632371,
    -0.02067041,
    0.105315581,
    0.067478552,
    0.00655692,
    -0.009871264,
    0.031893175,
    0.040970478,
    0.015222603,
    -0.003648946,
    0.01989297,
    -0.015675092,
    -4.126e-05,
    0.007521925,
    0.036243476,
    -0.050190236,
    -0.018825086,
    0.022081705,
    0.027332043,
    0.02084269,
    0.001131795,
    0.032172341,
    0.009920783,
    0.001814773,
    -0.018764969,
    0.011558433,
    0.031731073,
    0.025479229,
    0.018012229,
    -0.037407458,
    -0.006585316,
    -0.009678973,
    -0.029826717,
    -0.03036934,
    0.009655969,
    -0.00224405,
    -0.000987326,
    0.034498259,
    0.015626304,
    0.023902958,
    0.015985968,
    -0.020653717,
    0.004654602,
    0.050162438,
    0.017955257,
    0.026893849,
    -0.025829911,
    0.014179276,
    -0.011045794,
    -0.008292735,
    -0.005589532,
    0.068389736,
    0.030088365,
    0.000978304,
    -0.008352983,
    0.028799092,
    -0.036719333,
    0.00175632,
    0.00448247,
    -0.046264142,
    -0.007030929,
    0.003309527,
    0.014341795,
    0.054455969,
    -0.051960573,
    -0.035361405,
    -0.010173586,
    0.014370821,
    -0.004155174,
    0.008947556,
    -0.036485124,
    0.038102623,
    -0.019275192,
    0.034323946,
    0.006496961,
    -0.097265251,
    -0.057486001,
    0.027526774,
    -0.062066231,
    -0.016660353,
    0.013291834,
    -0.041743949,
    0.04032528,
    -0.001180455,
    0.014467956,
    -0.013418792,
    0.007761237,
    -0.043537304,
    0.024252428,
    -0.010975538,
    -0.014052478,
    -0.002014888,
    -0.028067188,
    0.077061713,
    0.00148718,
    -0.015615863,
    -0.017933784,
    -0.016717512,
    0.062260296,
    -0.021802016,
    -0.050233837,
    -0.008873648,
    0.026883902,
    -0.025620416,
    0.019993583,
    -0.042144056,
    0.020130981,
    0.012230628,
    0.018314691,
    0.034612924,
    0.013606681,
    -0.044862852,
    -0.022810113,
    -0.004135304,
    -0.035078,
    0.003503731,
    0.057951842,
    -0.055100325,
    0.030491857,
    -0.039481983,
    -0.077759959,
    -0.016031133,
    0.050437689,
    -0.006767528,
    0.01706584,
    0.038347766,
    -0.025345832,
    -0.004100054,
    -0.042006809,
    -0.027152935,
    0.006931012,
    -0.003727891,
    -0.008882596,
    -0.015630214,
    -0.022853924,
    0.027390052,
    0.021607056,
    -0.01526602,
    0.046242844,
    -0.014952751,
    0.032209326,
    0.021607459,
    -0.00233555,
    -0.002755679,
    -0.028345875,
    -0.000664799,
    0.029175341,
    0.028243607,
    -0.000188581,
    0.003702139,
    -0.016827151,
    0.051103588,
    -0.045709934,
    0.010259664,
    -0.002023772,
    0.009067763,
    0.016174542,
    -0.024183018,
    0.025583876,
    -0.011683472,
    0.025966823,
    -0.012044276,
    0.035750154,
    0.0014871,
    0.029984541,
    -0.010619329,
    0.03063261,
    -5.1738e-05,
    -0.033577066,
    -0.035814311,
    -0.016923511,
    0.000509682,
    -0.042888526,
    -0.018025685,
    -0.010262054,
    0.012523321,
    -0.079256169,
    -0.009810182,
    -0.01722821,
    -0.003739584,
    -0.015409653,
    -0.03710423,
    -0.006980947,
    0.043711647,
    -0.02006137,
    0.037355117,
    -0.048949648,
    -0.038623922,
    -0.030941218,
    -0.000940082,
    -0.031145249,
    0.055782039,
    -0.038417432,
    0.007649163,
    -0.038497265,
    0.002085659,
    0.052086677,
    -0.04434656,
    -0.062178645,
    -0.034710176,
    -0.003674934,
    -0.03514367,
    0.000771954,
    0.022965744,
    -0.031994406,
    -0.021170132,
    0.049832124,
    0.011570139,
    -0.023630947,
    -0.025535228,
    -0.014685082,
    -0.000840424,
    0.00513078,
    -0.006757994,
    0.016031269,
    0.024623007,
    -0.025381749,
    -0.018791465,
    -0.015589287,
    0.050282005,
    -0.022729259,
    -0.013391133,
    0.000710452,
    0.020033536,
    0.022491738,
    -0.007865103,
    0.090730332,
    -0.009644508,
    -0.013149073,
    -0.039571553,
    -0.029022485,
    -0.03380749,
    -0.027797796,
    -0.025996396,
    0.011164018,
    -0.03167364,
    0.061313495,
    0.05062107,
    -0.005494639,
    0.010227778,
    -0.021082627,
    -0.008984881,
    -0.017721917,
    0.021185696,
    0.006599027,
    0.010188515,
    -0.005299077,
    -0.02696703,
    0.030413995,
    0.052869745,
    -0.06201458,
    0.01666701,
    -0.005353591,
    -0.038810138,
    0.035220183,
    -0.002658763,
    0.00146016,
    -0.115361482,
    0.04100639,
    -0.033343542,
    0.001285766,
    -0.005480595,
    0.025877899,
    0.010973398,
    -0.020537702,
    -0.036624447,
    0.019880913,
    0.011500401,
    -0.028256753,
    0.001867879,
    0.038958464,
    0.004058166,
    -0.103809133,
    0.009398307,
    -0.025168793,
    0.040413219,
    -0.000479381,
    -0.003398872,
    -0.021750676,
    -0.01916039,
    0.042895373,
    -0.034637988,
    -0.050165638,
    0.006475932,
    0.004753501,
    0.032424837,
    -0.010329376,
    0.009658503,
    -0.003931409,
    -0.013479093,
    -0.03636571,
    -0.036478903,
    -0.048744746,
    -0.014598577,
    0.013119336,
    0.022730434,
    0.046060957,
    -0.008212817,
    -0.003693583,
    -0.017966336,
    0.02620092,
    0.05172956,
    0.040693112,
    -0.027638024,
    0.059394836,
    0.024129253,
    0.002447249,
    0.070690908,
    -0.030243557,
    0.022284826,
    0.019142218,
    0.012763304,
    0.019770412,
    -0.030308701,
    0.001478935,
    0.008302948,
    -0.025153011,
    0.00402771,
    -0.017651696,
    -8.1532e-05,
    -0.021988153,
    -0.020255895,
    0.003995078,
    0.020037694,
    0.020847064,
    0.044757791,
    -0.034689795,
    -0.026136514,
    -0.02369817,
    0.00801438,
    0.021415809,
    -0.000515558,
    0.021435302,
    -0.025165217,
    -0.043323576,
    0.020086255,
    0.004631834,
    -0.040954519,
    -0.006036152,
    0.023889186,
    -0.023290198,
    -0.00222041,
    -0.043454625,
    0.072501339,
    0.000536821,
    0.008298852,
    0.010706266,
    -0.028242355,
    -0.024146242,
    0.01487483,
    2.5593e-05,
    0.062961258,
    0.022478949,
    -0.01608518,
    -0.036990937,
    0.030521683,
    0.004761395,
    0.076732017,
    0.018735316,
    -0.005901319,
    0.013333105,
    0.05207406,
    0.006316131,
    0.028795885,
    0.028462872,
    0.044875655,
    -0.051426936,
    0.006478843,
    0.04746208,
    -0.002919957,
    -0.039260931,
    -0.005495699,
    0.00497399,
    -0.006857099,
    -0.00669855,
    0.037035022,
    -0.027006691,
    -0.008887261,
    0.001910388,
    0.00728398,
    0.020023575,
    -0.073986329,
    0.020971147,
    0.017825238,
    0.002934231,
    0.014093223,
    -0.011293849,
    0.003632066,
    -0.001995975,
    -0.030254345,
    -0.01270313,
    0.018782033,
    0.040776536,
    0.021101315,
    0.031195775,
    0.045259055,
    -0.05618231,
    -0.016514529,
    0.039750874,
    0.054895803,
    0.026376234,
    0.105189636,
    0.024811931,
    0.061877549,
    0.026623471,
    0.009288556,
    -0.018828884,
    -0.01166407,
    -0.024693239,
    0.018691674,
    -0.008434768,
    -0.022877328,
    0.037108213,
    0.034215566,
    -0.031739086,
    -0.030754475,
    0.031672038,
    -0.027721211,
    -0.018963162,
    -0.039374884,
    0.028743472,
    -0.004034571,
    -0.03643816,
    -0.023171533,
    -0.000780403,
    0.009300435,
    0.028440664,
    -0.002033771,
    -0.010162331,
    0.028150517,
    0.058725115,
    0.011768658,
    0.022793151,
    -0.039359063,
    -0.015614777,
    -0.063177958,
    0.0123494,
    0.011284964,
    0.006692849,
    0.010549722,
    -0.007904133,
    0.072026521,
    -0.039080355,
    0.011639548,
    -0.000776035,
    0.000823663,
    -0.023188835,
    -0.018694663,
    -0.071640089,
    0.011091795,
    0.060700051,
    -0.01816991,
    0.014541216,
    0.009037801,
    -0.016975189,
    -0.006280197,
    0.003545333,
    0.033401038,
    0.016444845,
    -0.021142522,
    -0.047753636,
    0.006044344,
    0.032168638,
    0.033637445,
    -0.015620968,
    -0.025557607,
    -0.021422742,
    0.007904346,
    -0.009561107,
    -0.011156744,
    -0.00792787,
    -0.034432855,
    -0.007693816,
    -0.006402732,
    -0.01108948,
    -0.010169235,
    2.8934e-05,
    0.079384424,
    -0.038003646,
    -0.058465902,
    -0.018568303,
    0.018434621,
    0.013626146,
    -0.064415045,
    0.014895504,
    -0.054050356,
    -0.00066853,
    -0.041118756,
    0.000401381,
    0.033397336,
    0.020504052,
    -0.014556939,
    0.000805438,
    0.013624903,
    0.010163976,
    0.015145612,
    0.052612368,
    0.002402397,
    -0.078000635,
    -0.035628371,
    -0.011983221,
    -0.005197329,
    -0.016762139,
    0.069435306,
    -0.019206446,
    -0.01112403,
    0.073212609,
    -0.004905756,
    0.011497199,
    -0.014610375,
    0.019384163,
    -0.005182152,
    -0.036687259,
    -0.03088828,
    -0.036051426,
    0.007743144,
    0.002607726,
    -0.075479411,
    -0.004352649,
    -0.018140437,
    -0.01496735,
    -0.01913227,
    0.018404143,
    -0.036263924,
    -0.009019717,
    0.025910161,
    0.028949015,
    -0.031772316,
    -0.024657506,
    -0.01702443,
    -0.001102242,
    0.017904485,
    -0.004297093,
    -0.037465639,
    0.014088938,
    0.003033147,
    0.037517361,
    -0.013472516,
    -0.077627786,
    0.053007994,
    0.000793593,
    -0.007426792,
    0.02894645,
    -0.021791071,
    0.011993838,
    -0.053927369,
    -0.035453036,
    0.00610644,
    -0.023196539,
    -0.0436792,
    0.060830329,
    0.042141303,
    0.03656783,
    -0.035201903,
    -0.033506554,
    0.029823501,
    -0.034684546,
    0.006601243,
    0.007649899,
    0.034447726,
    -0.010201092,
    -0.015953688,
    -0.017466735,
    0.038238794,
    -0.039158382,
    -0.062603146,
    0.040037174,
    0.010484344,
    -0.022463368,
    -0.008594587,
    -0.033478227,
    0.002550978,
    0.004833108,
    -0.029218176,
    0.019483149,
    0.010283367,
    0.002750896,
    -0.009181985,
    -0.031055188,
    -0.03434936,
    0.041384317,
    -0.002790892,
    -0.015519252,
    0.038415167,
    -0.002883223,
    0.042356052,
    0.061003763,
    0.031905375,
    -0.039104097,
    0.022121446,
    0.019457806,
    0.038187366,
    0.024853591,
    -0.04005979,
    -0.033661127,
    -0.009269275,
    0.018644823,
    0.031758178,
    0.038746618,
    0.022380324,
    -0.026597427,
    -0.003185041,
    -0.019874148,
    -0.022157863,
    0.100285172,
    -0.024952957,
    0.031821694,
    -0.058189765,
    -0.017744865,
    0.069564395,
    0.012844962,
    -0.016648985,
    -0.00711138,
    -0.024713125,
    -0.041976243,
    -0.012710261,
    -0.008923557,
    -0.066451855,
    -0.038983829,
    -0.011835815,
    5.3627e-05,
    -0.02679782,
    0.005232631,
    0.031050174,
    -0.017433649,
    0.01511382,
    -0.015920954,
    -0.020633835,
    -0.000529104,
    -0.010059751,
    0.005310186,
    0.032014675,
    0.021362064,
    0.014256782,
    0.021107802,
    -0.039935436,
    -0.059144303,
    -0.023059888,
    0.041502222,
    -0.033978645,
    0.005305582,
    -0.008900075,
    0.008511592,
    0.025848685,
    0.02127146,
    0.032592159,
    -0.006333121,
    -0.015143824,
    0.032868911,
    -0.013115057,
    0.003161245,
    -0.017836427,
    0.043063514,
    0.047037181,
    0.012666472,
    0.032029115,
    -0.011670311,
    0.036103681,
    0.014544691,
    -0.002349271,
    -0.04834773,
    0.026995387,
    -0.028557872,
    -0.027456911,
    0.001389496,
    0.026655972,
    0.03529099,
    -0.018129297,
    -0.057219729,
    0.001721636,
    0.001262801,
    0.00136496,
    0.025262944,
    0.021738771,
    -0.034777783,
    -0.048232455,
    -0.009245745,
    -0.00326222,
    0.038054552,
    -0.034198023,
    0.004029592,
    -0.055609018,
    -0.019865075,
    0.009811276,
    -0.026822545,
    0.020836139,
    0.013016512,
    0.051790338,
    -0.033437956,
    0.011109882,
    -0.032607313,
    -0.039970122,
    -0.04645722,
    -0.074347109,
    0.020179769,
    -0.006501059,
    0.00231182,
    -0.004971104,
    -0.004115898,
    0.012016074,
    -0.001896598,
    0.016798874,
    0.031859241,
    0.01824172,
    0.045505799,
    -0.027896825,
    -0.040870011,
    -0.041529641,
    0.004619955,
    -0.005667923,
    -0.009454357,
    0.038512852,
    0.026606271,
    0.007465838,
    -0.032726102,
    0.038561013,
    0.022478042,
    0.008002298,
    0.024575902,
    -0.020374842,
    -0.027346823,
    -0.025702387,
    -0.020372611,
    -0.031437185,
    -0.006640007,
    -0.008328466,
    -0.021305714,
    -0.064048037,
    0.002399405,
    0.025643626,
    0.016809683,
    0.040593099,
    -0.049656346,
    0.003461055,
    -0.059266392,
    -0.03607158,
    0.025358101,
    -0.059181254,
    -0.029595856,
    -0.034779757,
    0.030821348,
    -0.002758269,
    0.005657509,
    -0.007154527,
    -0.000102651,
    -0.024295257,
    0.006613133,
    -0.015284512,
    0.006776186,
    0.021415552,
    -0.002485577,
    0.004799531,
    0.000721494,
    0.003880407,
    -0.029137621,
    0.028551325,
    -0.012915704,
    0.03720995,
    0.018594593,
    -0.008476657,
    0.012073837,
    0.004522035,
    0.014705436,
    0.008971846,
    -0.004631962,
    0.05659366,
    -0.037167374,
    0.014458751,
    -0.031470675,
    -0.010557616,
    -0.051112924,
    0.022189341,
    -0.063409105
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/BatchFlushCoordinator.cs",
    "chunk_index": 2,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": ",14 +303,21 @@ public class BatchFlushCoordinator : IDisposable\n             while (await _reader.WaitToReadAsync(cancellationToken).ConfigureAwait(false))\n             {\n                 // Collect requests for batching\n                 var batchStartTime = DateTime.UtcNow;\n                 \n-                // Read available requests up to batch size or until timeout\n+                // CRITICAL FIX: Add bounds checking to prevent unbounded memory growth and infinite loops\n+                // Read available requests up to batch size or until timeout with safety limits\n+                var maxIterations = _config.MaxBatchSize * 10; // Safety limit to prevent infinite loops\n+                var iterationCount = 0;\n+                \n                 while (pendingRequests.Count < _config.MaxBatchSize && \n-                       (DateTime.UtcNow - batchStartTime).TotalMilliseconds < _config.MaxDelayMs)\n+                       (DateTime.UtcNow - batchStartTime).TotalMilliseconds < _config.MaxDelayMs &&\n+                       iterationCount < maxIterations)\n                 {\n+                    iterationCount++;\n+                    \n                     if (_reader.TryRead(out var request))\n                     {\n                         pendingRequests.Add(request);\n                         \n                         if (request.Priority == FlushPriority.Critical)\n@@ -184,10 +329,14 @@ public class BatchFlushCoordinator : IDisposable\n                     {\n                         // No more requests available, wait a bit for more\n                         if (pendingRequests.Count == 0)\n                             break;\n                             \n+                        // Add cancellation check to prevent infinite waiting\n+                        if (cancellationToken.IsCancellationRequested)\n+                            break;\n+                            \n                         await Task.Delay(5, cancellationToken).ConfigureAwait(false);\n                     }\n                 }\n \n                 if (pendingRequests.Count > 0)\n@@ -242,10 +391,23 @@ public class BatchFlushCoordinator : IDisposable\n     {\n         await _flushSemaphore.WaitAsync(cancellationToken).ConfigureAwait(false);\n         \n         try\n         {\n+            // Handle special force flush request\n+            var forceFlushRequest = requests.FirstOrDefault(r => r.FilePath == \"__FORCE_FLUSH_ALL__\");\n+            if (forceFlushRequest != null)\n+            {\n+                // For force flush, we just complete the request - the act of processing this batch\n+                // immediately flushes all pending requests which is the desired behavior\n+                forceFlushRequest.SetCompleted();\n+                requests.Remove(forceFlushRequest);\n+                \n+                // Continue processing other requests in this batch\n+                if (requests.Count == 0)\n+                    return;\n+            }\n             // Group by unique file paths to avoid duplicate flushes\n             var uniqueRequests = requests\n                 .GroupBy(r => r.FilePath)\n                 .Select(g => g.First()) // Take first request for each unique file\n                 .ToList();\n@@ -284,38 +446,177 @@ public class BatchFlushCoordinator : IDisposable\n     }\n \n     /// <summary>\n     /// Performs the actual flush operation for a group of files\n     /// This is where the real I/O optimization happens\n+    /// Includes circuit breaker pattern for continuous failure handling\n     /// </summary>\n     private async Task PerformFlushOperationAsync(List<FlushRequest> requests, CancellationToken cancellationToken)\n     {\n+        // CRITICAL FIX: Check circuit breaker before attempting flush operations\n+        if (ShouldBypassCircuitBreaker())\n+        {\n+            throw new InvalidOperationException($\"Circuit breaker is open due to {_consecutiveFailures} consecutive failures. \" +\n+                $\"Operations are temporarily disabled until {_lastFailureTime.Add(CircuitBreakerTimeout)}\");\n+        }\n+\n         foreach (var request in requests)"
}