{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/JsonFormatAdapter.cs:0",
  "vector": [
    -0.008526224,
    0.029429231,
    -0.019641077,
    0.036892701,
    -0.008860962,
    -0.033454925,
    0.050399158,
    0.002199027,
    0.028500812,
    0.040915091,
    0.013714678,
    0.005108237,
    0.034649931,
    0.000419953,
    -0.086009517,
    -0.069334894,
    0.057318214,
    0.016675679,
    -0.028869864,
    0.038067743,
    -0.006497996,
    -0.028412892,
    -0.011618685,
    0.038822211,
    -0.043987792,
    0.012901232,
    0.020954598,
    0.033944294,
    0.035468176,
    0.069038175,
    -0.070810057,
    -0.052504789,
    0.00697153,
    0.044820569,
    0.034600466,
    -0.012329573,
    -0.040260684,
    -0.007309105,
    -0.00697879,
    0.027013298,
    0.028164482,
    -0.009662827,
    0.019304551,
    -0.051351063,
    0.010411455,
    -0.053792875,
    0.072336704,
    0.045678534,
    -0.012807493,
    -0.001680107,
    -0.040678613,
    -0.006124209,
    0.015321484,
    0.005525717,
    0.019977421,
    -0.031084336,
    0.055040054,
    0.030143103,
    -0.066502154,
    0.022218442,
    -0.025542744,
    0.006491033,
    -0.009042061,
    -0.024291866,
    -0.009226292,
    -0.041340265,
    -0.027845588,
    0.038205173,
    -0.03822862,
    -0.040476944,
    0.020764118,
    0.041121624,
    -0.009984586,
    0.033485249,
    0.011875705,
    0.011731533,
    0.034418795,
    0.023021277,
    0.020604847,
    -0.01937438,
    0.002343312,
    -0.052214537,
    -0.024037095,
    0.029503541,
    0.041264653,
    0.007617557,
    0.045311268,
    -0.080476195,
    0.004258861,
    -0.013490431,
    -0.034099873,
    -0.003939669,
    0.078272969,
    0.004312214,
    -0.001041372,
    -0.027169686,
    0.003572063,
    -0.00059462,
    0.046601534,
    -0.020325206,
    0.007383783,
    -0.008574666,
    -0.040439874,
    -0.01362795,
    -0.126893654,
    0.012828242,
    -0.033276152,
    -0.021940786,
    0.019709233,
    0.001649406,
    0.022427946,
    0.004974508,
    0.022434054,
    0.013851581,
    0.011545007,
    0.041706957,
    -0.051861852,
    -0.013634719,
    -0.00852414,
    0.040127799,
    -0.055754319,
    0.030150488,
    -0.019864039,
    0.015746912,
    -0.023976307,
    0.024531567,
    -0.02521654,
    0.036633838,
    0.029690268,
    -0.015069668,
    0.007546418,
    -0.011490403,
    0.02137162,
    -0.021549024,
    -0.016867621,
    0.030415509,
    -0.007188647,
    0.010354552,
    -0.005614113,
    -0.04679393,
    0.017945584,
    0.030827049,
    -0.018429017,
    0.015941178,
    0.0336731,
    0.056615844,
    0.084304944,
    0.021449795,
    -0.001142063,
    -0.059102327,
    -0.008330586,
    0.074258469,
    -0.006209937,
    0.009738248,
    -0.017197214,
    0.059444852,
    -0.036715556,
    -0.02465453,
    -0.001507197,
    0.003216052,
    -0.085227542,
    0.032545924,
    -0.001266628,
    0.016885305,
    -0.017814176,
    0.048713978,
    0.010330258,
    0.024798283,
    -0.003791003,
    0.002067678,
    -0.040257338,
    0.004085462,
    -0.076512061,
    -0.024988962,
    -0.016722038,
    -0.004716464,
    0.034397602,
    0.022361083,
    -0.037528388,
    -0.032816067,
    0.053222425,
    0.001066394,
    -0.00756906,
    -0.015756356,
    -0.023054928,
    -0.047425363,
    0.051305905,
    0.011018217,
    0.041135497,
    0.025475582,
    -0.017410133,
    0.002542238,
    -0.036186863,
    -0.040853772,
    -0.017647853,
    -0.059661571,
    -0.005370826,
    -0.001583492,
    0.06667573,
    -0.025842041,
    -0.022676978,
    0.021839866,
    -0.030169932,
    -0.000198802,
    0.007996798,
    0.030972829,
    -0.034253359,
    -0.030189572,
    0.051609565,
    -0.016664216,
    -0.008569385,
    -0.003364709,
    0.026301041,
    0.013692948,
    0.030265331,
    -0.02218158,
    -0.025608189,
    -0.018338459,
    0.019756224,
    0.032265037,
    0.018151976,
    -0.00031258,
    0.085643433,
    0.010278312,
    -0.009174458,
    -0.034893438,
    -0.0246168,
    -0.036269806,
    -0.036165558,
    0.006711463,
    0.024543608,
    0.000918153,
    0.005925194,
    0.001731195,
    -0.041456062,
    0.041429799,
    0.027686028,
    -0.003991778,
    0.012614386,
    0.004840042,
    0.0056985,
    0.056708589,
    -0.047755025,
    -0.025619321,
    -0.037367567,
    0.050878823,
    0.050086081,
    0.027916387,
    -0.065494493,
    0.033941064,
    0.005729287,
    0.071582757,
    -0.035164513,
    0.033670608,
    0.078595579,
    0.013145166,
    -0.008333799,
    0.015883405,
    -0.001422366,
    -0.015371398,
    -0.018094733,
    0.026744084,
    -0.037545249,
    0.003354946,
    0.008361808,
    0.059638415,
    -0.023071421,
    -0.052919324,
    0.005463789,
    0.0431876,
    0.040906362,
    -0.035155788,
    0.028308524,
    -0.001571985,
    -0.007447959,
    -0.012632148,
    0.028399874,
    -0.005794607,
    0.062912077,
    -0.00710866,
    -0.071219996,
    0.028746469,
    0.018517345,
    -0.046217371,
    -0.035177987,
    -0.016068576,
    0.000744183,
    -0.003691269,
    0.052500319,
    0.039932717,
    0.008374438,
    0.024015645,
    -0.033343989,
    0.02465474,
    0.044398859,
    0.00272204,
    -0.001032146,
    -0.017032545,
    0.016411223,
    -0.003842949,
    0.022056231,
    -0.018692179,
    0.033987533,
    0.006071485,
    -0.017149597,
    -0.000797201,
    0.048868924,
    -0.046266519,
    -0.004660449,
    -0.045661617,
    -0.04734689,
    -0.005644565,
    0.026533121,
    0.019034529,
    0.058005847,
    -0.064187877,
    -0.038619399,
    0.009236903,
    0.003135652,
    0.018539747,
    0.00998427,
    -0.037968252,
    0.016700363,
    -0.026299128,
    -0.028724959,
    -0.00743168,
    -0.056654476,
    0.026624035,
    0.010685956,
    -0.084313229,
    0.016946983,
    0.019058032,
    0.01311678,
    0.032124538,
    -0.019913828,
    0.028780386,
    -0.039634582,
    0.010697431,
    -0.049838908,
    0.044253901,
    0.01980276,
    -0.022421446,
    0.027562799,
    -0.016531607,
    0.072061107,
    -0.01764716,
    -0.006996938,
    -0.020614797,
    0.001237099,
    0.050350882,
    -0.0023547,
    -0.080276139,
    -0.02861564,
    0.043213211,
    -0.083668098,
    0.047669727,
    -0.020706052,
    0.038322434,
    0.009153778,
    0.034741949,
    0.005087987,
    0.000768839,
    -0.0388074,
    -0.035195541,
    -0.023973303,
    0.009253767,
    -0.040600277,
    0.047642145,
    -0.023942206,
    -0.009892631,
    -0.028921602,
    -0.01551128,
    -0.050627779,
    0.051378995,
    -0.059780777,
    -0.006559689,
    0.030311402,
    -0.007341793,
    -0.026884221,
    -0.025616501,
    -0.026740445,
    0.018164266,
    0.019327076,
    -0.013169565,
    -0.010178053,
    -0.028884705,
    -0.000340752,
    0.006752683,
    -0.006045154,
    0.049089465,
    -0.014097509,
    0.05440088,
    -0.020351596,
    0.017998928,
    -0.041739084,
    -0.001854656,
    -0.018924585,
    0.005533401,
    -0.010689123,
    0.008208876,
    -0.024489442,
    -0.004596399,
    0.03539405,
    -0.032889605,
    0.026982045,
    0.019604962,
    0.023012938,
    -0.007145979,
    -0.025204498,
    0.038157571,
    -0.003202342,
    0.057649042,
    -0.010212556,
    0.013941842,
    -0.031072389,
    0.037226353,
    -0.003912407,
    -0.017056448,
    -0.011238799,
    -0.033545531,
    -0.025343766,
    -0.016999517,
    0.049245697,
    0.023894619,
    -0.000361494,
    0.019461697,
    0.022157408,
    -0.084259324,
    -0.005665703,
    0.033340845,
    -0.027011935,
    -0.007703436,
    -0.04973352,
    0.029020593,
    0.005790599,
    -0.047646996,
    -0.003211413,
    0.015268859,
    -0.021163747,
    0.006777883,
    0.002453083,
    -0.039596483,
    0.025294717,
    -0.016615488,
    -0.002814161,
    -0.018099096,
    -0.008051668,
    0.013030435,
    -0.065737784,
    -0.027912214,
    -0.04343874,
    -0.006159626,
    -0.019193443,
    -0.021797933,
    0.037522126,
    0.013352025,
    -0.015449671,
    0.016156951,
    -0.027014496,
    0.013723377,
    0.005850732,
    -0.057067942,
    0.014239823,
    0.011366566,
    -0.020091595,
    0.023081113,
    0.024807379,
    -0.024885338,
    -0.029488383,
    0.009779844,
    0.044384979,
    -0.021176677,
    0.030843833,
    0.007151884,
    0.043433044,
    0.057968166,
    0.028383005,
    0.014643863,
    0.007620741,
    -0.055362061,
    -0.021586718,
    -0.039991856,
    -0.032690845,
    -0.016766354,
    -0.012467833,
    0.019236961,
    0.00608281,
    0.030987583,
    0.047470998,
    -0.043528639,
    -0.016659845,
    0.060801033,
    -0.009535957,
    -0.003861472,
    0.019480998,
    0.022524511,
    -0.021988571,
    -0.028010815,
    -0.048261743,
    0.026147064,
    0.062207509,
    -0.062448844,
    0.009358737,
    0.007561448,
    -0.039461263,
    0.044794358,
    0.003007608,
    0.011543643,
    -0.096853003,
    0.028452627,
    -0.005637535,
    0.023135837,
    0.000740787,
    -0.018797766,
    0.021126654,
    -0.054733057,
    -0.0290861,
    0.015560828,
    -0.004411614,
    0.009309136,
    -0.006697301,
    0.040581349,
    0.006886883,
    -0.059759155,
    0.012381384,
    0.004551833,
    0.018856047,
    0.009795095,
    -0.036954515,
    0.01334742,
    -0.016299913,
    -0.017839793,
    -0.038254853,
    -0.047884148,
    -0.010491783,
    -0.011587177,
    0.0475775,
    -0.012876269,
    -0.025397785,
    0.001944379,
    -0.021406002,
    0.039449759,
    0.003833518,
    -0.057054147,
    -0.001244368,
    -0.007712556,
    0.029650696,
    0.013098477,
    0.032984287,
    0.010780313,
    -0.028750787,
    0.013347378,
    0.019601976,
    0.03514728,
    -0.051312231,
    0.025402807,
    0.0107734,
    0.003972457,
    0.050918363,
    0.001568854,
    0.064280666,
    0.047997218,
    0.022026051,
    0.010250663,
    -0.012009844,
    0.000452532,
    0.005689667,
    0.017849147,
    -0.038634203,
    0.017912349,
    -0.011777304,
    -0.012601466,
    0.010694114,
    0.028751519,
    -0.005368937,
    0.029219832,
    0.038041674,
    -0.0224512,
    -0.011297081,
    0.016455796,
    0.003897065,
    0.036290452,
    0.01725555,
    0.002231756,
    0.03372068,
    -0.041496173,
    0.007586195,
    0.015177979,
    -0.018809533,
    -0.018734522,
    0.040823236,
    0.00630506,
    0.005814151,
    -0.067927636,
    0.061559293,
    0.013598665,
    0.010830882,
    -0.0509976,
    -0.027224652,
    -0.026242396,
    0.019505996,
    0.059264891,
    0.025607388,
    0.005330219,
    0.014255272,
    -0.034335729,
    -0.006223134,
    -0.027112212,
    0.033507541,
    0.0529611,
    -0.003129659,
    0.027661946,
    0.046760149,
    -0.02853993,
    -0.007436757,
    0.002491917,
    0.047050886,
    -0.02869088,
    -0.013492458,
    0.003532822,
    -0.030541034,
    -0.047025837,
    -0.026505891,
    -0.01395337,
    -0.003569296,
    -0.026712,
    0.021195697,
    0.014864308,
    0.030381981,
    0.018482665,
    -0.0205536,
    0.031733062,
    -0.058812186,
    0.03263694,
    0.012104927,
    0.044005826,
    0.009736385,
    0.032894287,
    0.03023627,
    0.00985945,
    -0.046599381,
    -0.015202569,
    -0.005885527,
    0.00840938,
    0.032809019,
    0.013986753,
    0.038597371,
    -0.014016653,
    0.012857565,
    0.019358171,
    0.047674142,
    0.009716155,
    0.104082055,
    0.026248908,
    0.023590909,
    0.02758221,
    -0.005992166,
    -0.021748364,
    -0.001468142,
    -0.01050948,
    0.027058398,
    -0.03259841,
    -0.047377609,
    0.015706608,
    0.031620648,
    -0.009569132,
    -0.002181599,
    0.04755193,
    -0.005801097,
    -0.028286882,
    -0.029794373,
    0.029870275,
    -0.050818905,
    -0.013777503,
    -0.029605677,
    -0.001678343,
    0.029778851,
    0.004207611,
    0.003331183,
    -0.011140345,
    0.009000138,
    0.053463686,
    -0.038214013,
    0.036077049,
    -0.085419856,
    -0.025752924,
    -0.027813818,
    0.00274947,
    -0.010132281,
    -0.009906682,
    -0.007564651,
    -0.008691829,
    0.083496079,
    -0.074191801,
    0.003715721,
    -0.019963214,
    0.006376899,
    -0.001583053,
    -0.017882952,
    -0.063710764,
    0.019159371,
    0.019499648,
    -0.000449732,
    0.0294245,
    0.027434524,
    -0.019805335,
    -0.008818708,
    0.002207456,
    0.03025924,
    -0.00428654,
    -0.00330591,
    -0.03343391,
    -0.015468779,
    0.010689076,
    -0.016082175,
    -0.01905068,
    -0.043141339,
    0.0073218,
    0.038893916,
    -0.017932359,
    -0.01319641,
    -0.029209843,
    -0.02913109,
    -0.005972825,
    -0.027281169,
    0.011028076,
    -0.013221455,
    -0.011736357,
    0.011354386,
    -0.039414968,
    -0.053712841,
    0.021433596,
    0.004462527,
    0.001751936,
    -0.065177545,
    0.02301468,
    -0.040116586,
    -0.023820482,
    -0.020368779,
    0.02113495,
    0.011364718,
    0.037621289,
    -0.000236266,
    4.9739e-05,
    0.012014802,
    0.013498676,
    -0.031745452,
    0.016109662,
    -0.032053489,
    -0.034999728,
    0.009017018,
    0.012105324,
    0.002408086,
    -0.030773204,
    0.042803086,
    -0.020440232,
    -0.02243142,
    0.025394807,
    -0.016178425,
    0.050319649,
    -0.05171141,
    0.011685966,
    -0.027570641,
    0.011775914,
    -0.040243778,
    -0.053219922,
    0.048166703,
    -0.018630337,
    -0.053405538,
    -0.004043484,
    -0.007845785,
    -0.035557736,
    -0.013022003,
    0.017890252,
    -0.019551216,
    -0.051062789,
    0.005248434,
    0.031452592,
    0.02241819,
    -0.045644116,
    -0.000402316,
    0.025335046,
    0.011390626,
    -0.053133234,
    -0.029804952,
    0.009147372,
    0.01876854,
    0.027867764,
    -0.003266551,
    -0.04203881,
    0.008537189,
    -0.005457523,
    -0.009988624,
    0.034083709,
    0.009421944,
    -0.000289311,
    -0.030892983,
    -0.019863497,
    0.02015047,
    0.014678983,
    -0.054243557,
    0.025975894,
    0.039075948,
    -6.148e-05,
    0.005827221,
    -0.0134812,
    0.063580371,
    -0.006750259,
    0.00789531,
    0.011091311,
    0.01971782,
    -0.00150335,
    -0.031631317,
    -0.080859274,
    0.033779517,
    -0.019080235,
    -0.031934414,
    0.017596444,
    -0.016685123,
    -0.005802329,
    0.02774537,
    -0.031838734,
    0.005822749,
    0.021343494,
    0.017743861,
    -0.009658526,
    -0.003815104,
    0.015778013,
    -0.007556942,
    0.024384636,
    -0.031892493,
    0.000703847,
    -0.031370319,
    -0.015690917,
    0.048152242,
    0.012970641,
    0.017183416,
    0.0652918,
    0.004582957,
    0.00156364,
    -0.005008796,
    0.030891037,
    0.013394586,
    -0.028858567,
    -0.071890429,
    -0.028768515,
    0.001919348,
    -0.001344516,
    -0.041541412,
    0.0474457,
    0.0138904,
    -0.041358866,
    0.007149045,
    -0.033187255,
    0.021691887,
    0.047176972,
    0.000567817,
    0.056390379,
    -0.059257131,
    0.002045684,
    0.029680904,
    -5.1283e-05,
    -0.006904364,
    -0.022333242,
    -0.013592792,
    -0.02194844,
    -0.008951959,
    -0.035391066,
    -0.01753426,
    -0.008610615,
    -0.016384635,
    0.051610652,
    -0.049464684,
    -0.002079253,
    0.037356403,
    0.000833406,
    0.002681435,
    -0.026321014,
    -0.02305223,
    -0.012889343,
    -0.001454098,
    0.002530725,
    0.017183077,
    0.025446663,
    -0.018707559,
    -0.028309371,
    -0.025847716,
    -0.024901776,
    -0.007607527,
    0.050571132,
    -0.072684415,
    -0.01713948,
    0.010761616,
    0.073217377,
    0.004751466,
    0.002944252,
    -0.02125288,
    -0.030997781,
    -0.022348857,
    0.036064271,
    0.020931287,
    -0.006899019,
    -0.045229882,
    0.011287641,
    0.037834764,
    0.04575447,
    0.004598838,
    0.032053351,
    0.013321475,
    -0.01877358,
    0.029722184,
    -0.015939308,
    -0.015951725,
    -0.033447448,
    -0.04281877,
    -0.026063677,
    0.044109315,
    0.019271484,
    -0.017935285,
    -0.019793544,
    -0.000919706,
    -0.032734919,
    -0.030288858,
    0.021214809,
    0.01479967,
    -0.013864477,
    -0.060572535,
    -0.018505948,
    -0.015224759,
    0.008188883,
    -0.030208034,
    0.028230995,
    -0.004631528,
    -0.002531913,
    -0.00197267,
    -0.019110875,
    -0.004545267,
    0.052874316,
    0.008171646,
    -0.052257326,
    0.024820261,
    -0.014048603,
    -0.034856267,
    -0.044814017,
    -0.060248822,
    0.025337363,
    0.01669606,
    0.056161381,
    0.004283283,
    -0.027286107,
    0.002103034,
    -0.003937487,
    0.024907436,
    0.015412121,
    0.01227309,
    0.025672819,
    -0.044913132,
    -0.028640129,
    -0.062699646,
    0.018789964,
    0.005535433,
    0.003587282,
    0.004810108,
    0.041466784,
    0.021805905,
    -0.058896985,
    0.040386923,
    0.000683457,
    0.018046033,
    0.052270427,
    0.001026245,
    -0.007546908,
    -0.006663461,
    0.035878334,
    -0.018301664,
    0.018404674,
    0.053485185,
    0.026049757,
    -0.044236008,
    0.029986486,
    0.028054604,
    0.032513581,
    0.026309609,
    -0.005104792,
    -0.014192559,
    -0.075576156,
    -0.059554376,
    0.020535769,
    -0.025695311,
    -0.009887485,
    -0.007961771,
    0.028270071,
    0.045870595,
    -0.029891402,
    -0.033952363,
    0.010861097,
    -0.016069653,
    -0.025452541,
    -0.005433319,
    0.004697924,
    0.025544345,
    0.049675975,
    0.040542014,
    -0.000196021,
    -0.008033196,
    -0.008044017,
    0.022764739,
    -0.005968581,
    0.046289679,
    0.060340066,
    0.013962238,
    0.009925131,
    0.014118849,
    0.012073874,
    -0.017801732,
    0.011924899,
    0.015715426,
    -0.006970061,
    0.027514691,
    -0.00311638,
    -0.008434888,
    -0.01893004,
    0.006817616,
    -0.035629563
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/JsonFormatAdapter.cs",
    "chunk_index": 0,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "@@ -1,6 +1,8 @@\n+using System.Dynamic;\n using Newtonsoft.Json;\n+using Newtonsoft.Json.Linq;\n using TxtDb.Storage.Interfaces;\n \n namespace TxtDb.Storage.Services;\n \n public class JsonFormatAdapter : IFormatAdapter\n@@ -15,11 +17,12 @@ public class JsonFormatAdapter : IFormatAdapter\n         {\n             Formatting = Formatting.Indented, // Pretty-print for git diff readability\n             NullValueHandling = NullValueHandling.Include,\n             DateFormatHandling = DateFormatHandling.IsoDateFormat,\n             DateTimeZoneHandling = DateTimeZoneHandling.Utc,\n-            ReferenceLoopHandling = ReferenceLoopHandling.Error // Detect circular references\n+            ReferenceLoopHandling = ReferenceLoopHandling.Error, // Detect circular references\n+            TypeNameHandling = TypeNameHandling.Auto // Preserve type information for complex objects\n         };\n     }\n \n     public string Serialize<T>(T obj)\n     {\n@@ -52,16 +55,28 @@ public class JsonFormatAdapter : IFormatAdapter\n         {\n             var arrayType = elementType.MakeArrayType();\n             var result = JsonConvert.DeserializeObject(content, arrayType, _settings);\n             \n             if (result is object[] array)\n+            {\n+                // Unwrap JValue/JObject types to proper primitives\n+                for (int i = 0; i < array.Length; i++)\n+                {\n+                    array[i] = UnwrapJTokens(array[i]);\n+                }\n                 return array;\n+            }\n                 \n             if (result is Array genericArray)\n             {\n                 var objects = new object[genericArray.Length];\n                 Array.Copy(genericArray, objects, genericArray.Length);\n+                // Unwrap JValue/JObject types to proper primitives\n+                for (int i = 0; i < objects.Length; i++)\n+                {\n+                    objects[i] = UnwrapJTokens(objects[i]);\n+                }\n                 return objects;\n             }\n             \n             throw new InvalidOperationException($\"Deserialization did not return an array for element type {elementType.Name}\");\n         }\n@@ -80,6 +95,44 @@ public class JsonFormatAdapter : IFormatAdapter\n         catch (JsonException ex)\n         {\n             throw new InvalidOperationException($\"Failed to serialize object array: {ex.Message}\", ex);\n         }\n     }\n+\n+    /// <summary>\n+    /// Unwraps JValue, JObject, and JArray tokens to their underlying .NET primitive types.\n+    /// When TypeNameHandling is enabled, JObject instances with type information are preserved\n+    /// as-is to maintain proper deserialization. Otherwise, they are converted to ExpandoObject.\n+    /// </summary>\n+    /// <param name=\"obj\">The object to unwrap</param>\n+    /// <returns>The unwrapped object with proper .NET types</returns>\n+    private static object UnwrapJTokens(object obj)\n+    {\n+        if (obj is JObject jObject)\n+        {\n+            // If the JObject has type information ($type property), leave it as JObject\n+            // so the calling code can deserialize it properly to the original type\n+            if (jObject.Property(\"$type\") != null)\n+            {\n+                return jObject;\n+            }\n+            \n+            // Otherwise, convert to ExpandoObject for dynamic access\n+            var expando = new ExpandoObject();\n+            var dict = (IDictionary<string, object?>)expando;\n+            foreach (var property in jObject.Properties())\n+            {\n+                dict[property.Name] = UnwrapJTokens(property.Value);\n+            }\n+            return expando;\n+        }\n+        if (obj is JValue jValue)\n+        {\n+            return jValue.Value ?? obj;\n+        }\n+        if (obj is JArray jArray)\n+        {\n+            return jArray.Select(UnwrapJTokens).ToArray();\n+        }\n+        return obj;\n+    }\n }\n\\ No newline at end of file"
}