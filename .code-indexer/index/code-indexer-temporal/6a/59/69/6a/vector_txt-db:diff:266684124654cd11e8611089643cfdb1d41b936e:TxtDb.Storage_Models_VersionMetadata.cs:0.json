{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Models/VersionMetadata.cs:0",
  "vector": [
    0.009269437,
    0.012720385,
    0.025183666,
    0.036856648,
    -0.002138939,
    -0.013723319,
    0.00181036,
    -0.032664396,
    0.037947316,
    0.023175498,
    0.016822558,
    0.019646987,
    0.066092178,
    0.006343446,
    -0.082573153,
    -0.041960899,
    0.017968852,
    0.011527622,
    -0.049834248,
    0.013394458,
    -0.037267897,
    -0.062786333,
    -0.049148239,
    0.035550002,
    -0.057238959,
    0.011801658,
    0.031591471,
    0.064723343,
    0.02202175,
    0.057107307,
    -0.037835453,
    -0.041407403,
    -0.000210163,
    0.034070499,
    0.024411518,
    0.002593401,
    -0.037421852,
    0.01306025,
    -0.011854616,
    0.0175821,
    0.052004125,
    -0.029456571,
    0.055279605,
    -0.017958278,
    0.018033128,
    -0.026446482,
    0.041054253,
    0.017139411,
    -0.015346868,
    0.005174376,
    0.004003435,
    0.01233042,
    -0.00700245,
    0.03212487,
    0.010644586,
    -0.033690505,
    0.063736193,
    0.01861739,
    -0.027316423,
    0.042899013,
    -0.01907018,
    0.012314652,
    0.005516554,
    0.009059771,
    -0.014581527,
    -0.044886108,
    -0.063760892,
    0.030877363,
    0.011762356,
    -0.080630615,
    0.015940716,
    0.034780059,
    0.018469274,
    0.038909372,
    0.035389613,
    0.024421463,
    0.014535659,
    0.002626528,
    0.04581134,
    -0.021858498,
    -0.051151246,
    -0.057584327,
    -0.003494908,
    -0.023926092,
    0.038285043,
    0.003878213,
    0.046440054,
    -0.074387044,
    -0.009251213,
    0.000867411,
    -0.014906981,
    0.042261787,
    0.025033237,
    0.004616225,
    0.027312333,
    0.021914434,
    0.038748838,
    0.007234692,
    0.028013369,
    -0.004566578,
    0.001731087,
    0.00279025,
    -0.026999084,
    0.011374577,
    -0.066237725,
    0.015093605,
    -0.006610491,
    0.010754006,
    0.006286215,
    0.013695129,
    0.061200675,
    0.030573843,
    0.010590847,
    -0.017725253,
    0.017434308,
    0.026365293,
    -0.027685208,
    -0.005698971,
    0.008363435,
    0.043448463,
    -0.036196906,
    0.009566455,
    -0.047845561,
    0.059872076,
    -0.019525027,
    0.040212568,
    0.028447311,
    0.02509371,
    -0.010972655,
    -0.027019246,
    -0.008251151,
    -0.014082239,
    -0.003798766,
    -0.014755278,
    0.010349084,
    0.025879338,
    0.018773785,
    0.024866575,
    0.016203677,
    -0.048080776,
    0.030247459,
    -0.00934473,
    -0.01061207,
    0.009897964,
    -0.012345959,
    0.009293754,
    0.051785085,
    0.012919007,
    0.013901781,
    -0.068222173,
    0.01822786,
    0.055962417,
    -0.009703276,
    0.004013918,
    0.021716468,
    0.036486957,
    -0.027231472,
    -0.027862711,
    0.01293431,
    -0.00792679,
    -0.050597027,
    0.041268948,
    0.007091477,
    0.017778262,
    -0.027348019,
    0.047069889,
    0.012015423,
    0.023891065,
    -0.021837022,
    -0.000137464,
    -0.048532344,
    0.00261216,
    -0.058318976,
    -0.01537651,
    -0.023310563,
    -0.008891796,
    0.024527464,
    0.011042363,
    -0.083987929,
    -0.053696983,
    0.014972394,
    -0.030094313,
    -0.029445261,
    -0.007045354,
    0.019498494,
    -0.007848916,
    0.033007126,
    0.000670354,
    0.016059324,
    -0.011803946,
    -0.03379342,
    -0.021329787,
    -0.029056109,
    -0.029194091,
    -0.003089185,
    -0.039474629,
    -0.003761693,
    -0.006776928,
    0.067854501,
    -0.018467806,
    -0.047413837,
    0.009270826,
    -0.067145668,
    -0.003969608,
    0.011357769,
    0.003729467,
    -0.030764103,
    -0.019874256,
    0.009065103,
    0.031723667,
    -0.000777892,
    -0.006434441,
    0.01289275,
    -8.492e-06,
    -0.002005147,
    -0.00483794,
    -0.041881148,
    -0.002112759,
    0.031276591,
    0.011400262,
    0.013762337,
    -0.024735602,
    0.085000359,
    0.026745694,
    -0.014196094,
    -0.028969582,
    -0.07890483,
    -0.041184291,
    -0.03303821,
    -0.03036347,
    0.017004939,
    -0.047836892,
    0.027043153,
    -0.028802155,
    -0.037712071,
    0.067547612,
    -0.014424897,
    -0.011889063,
    0.025739379,
    -0.020739472,
    -0.035905838,
    0.040463775,
    -0.029262582,
    0.005999508,
    -0.037517831,
    0.01744445,
    0.049012914,
    0.040064089,
    -0.030028535,
    0.025739478,
    -0.045463648,
    0.071570151,
    0.007940529,
    0.118357703,
    0.049489878,
    0.017254045,
    -0.0034912,
    0.032711092,
    -0.009624081,
    -0.004855573,
    -0.000713212,
    0.013213791,
    -0.068358168,
    0.029905822,
    -0.00689194,
    0.024575522,
    -0.02798024,
    -0.02941886,
    -0.011057117,
    0.053819306,
    0.040010042,
    -0.004579019,
    0.061470266,
    0.034942925,
    -0.008439729,
    -0.023995938,
    0.015652733,
    0.008015272,
    0.019849023,
    0.031797595,
    -0.037529584,
    -0.010414335,
    0.024132669,
    -0.036163159,
    -0.041432176,
    -0.040762663,
    -0.008425846,
    -0.018645903,
    0.0455085,
    0.030532684,
    0.020667521,
    -0.00266818,
    -5.1866e-05,
    -0.02786346,
    0.034627166,
    0.021406585,
    0.005038005,
    -0.015578023,
    0.025342762,
    -0.027367573,
    0.059822544,
    0.011054482,
    0.071512356,
    0.041059826,
    0.001338955,
    0.02758049,
    0.061610386,
    -0.033267252,
    0.030966101,
    -0.014335326,
    -0.031417482,
    -0.020391917,
    0.022547185,
    0.007340101,
    0.025730845,
    -0.075527541,
    -0.017496407,
    -0.00354557,
    -0.017353365,
    -0.015220537,
    0.020165173,
    0.000327108,
    -2.7391e-05,
    -0.039159853,
    -0.005342685,
    0.016653277,
    -0.051764168,
    -0.020786561,
    0.055610482,
    -0.042844053,
    -0.01385532,
    0.00284512,
    0.006166011,
    0.049236856,
    -0.021445645,
    0.003176484,
    -0.040292826,
    0.005645874,
    -0.06142747,
    0.038398962,
    0.030972626,
    -0.039786842,
    0.018847838,
    -0.024215259,
    0.038411789,
    -0.020593895,
    0.000350443,
    0.00493801,
    -0.039753921,
    0.046019342,
    0.015844375,
    -0.068025105,
    -0.033589773,
    0.025744982,
    -0.074606031,
    0.059249543,
    -0.002703561,
    0.00119865,
    0.007365018,
    0.030200312,
    0.011587336,
    0.007737581,
    -0.055575307,
    -0.012907831,
    -0.006875706,
    0.011429855,
    -0.056639086,
    0.066162482,
    -0.020769985,
    0.052552093,
    -0.056267668,
    -0.038978647,
    -0.051522575,
    0.015986618,
    -0.029528948,
    0.01323026,
    0.025619993,
    -0.023374457,
    -0.051051829,
    -0.011437504,
    -0.010324623,
    0.021738965,
    0.040199853,
    -0.014562146,
    -0.022547865,
    -0.004589077,
    0.00233264,
    0.002247622,
    -0.023184218,
    0.046962854,
    0.013409244,
    -0.001079339,
    0.012987254,
    0.010823226,
    -0.025902255,
    -0.035588954,
    0.002523663,
    0.031509902,
    0.015835393,
    -0.054905508,
    -0.002160636,
    -0.004275144,
    0.055523559,
    -0.046248775,
    0.032615438,
    0.024608787,
    0.022488054,
    0.027432408,
    -0.030387435,
    0.026537359,
    -0.006456828,
    0.036966112,
    0.006226754,
    0.017590685,
    -0.016476713,
    0.022947239,
    0.005103474,
    -0.008266571,
    -0.006696395,
    -0.008858764,
    -0.010710772,
    -0.015058291,
    -0.005767901,
    0.010163422,
    -0.050012585,
    0.017771414,
    -3.0391e-05,
    -0.050848432,
    -0.012921259,
    0.003424385,
    -0.016376322,
    -0.012698224,
    -0.082815289,
    0.009024657,
    0.033393305,
    -0.067496933,
    0.004099977,
    2.237e-05,
    -0.028500125,
    -0.006617476,
    -0.008681812,
    -0.045562513,
    0.040546581,
    -0.028495371,
    -0.009526563,
    -0.002096717,
    0.027921412,
    0.026949266,
    -0.045149028,
    -0.042390525,
    -0.03445207,
    -0.01511049,
    -0.029663146,
    -0.025610192,
    0.072453976,
    -0.0114373,
    -0.01093446,
    -0.006226743,
    -0.010355084,
    -0.018296029,
    -0.029977735,
    -0.023521809,
    0.004423999,
    0.016117584,
    -0.042176783,
    0.010587675,
    0.018653715,
    -0.053515151,
    -0.023120729,
    -0.005020602,
    0.060346901,
    -0.038698573,
    0.011689741,
    0.023764353,
    0.01735029,
    0.008276368,
    0.029035568,
    0.047701642,
    -0.017462287,
    -0.028567802,
    -0.000575594,
    -0.020865643,
    -0.002050094,
    -0.057058282,
    -0.009904993,
    0.052161258,
    -0.008820218,
    0.019384973,
    0.031634301,
    -0.03579757,
    -0.004150928,
    -0.041176531,
    -0.000301908,
    -0.026596323,
    0.015992213,
    0.015499461,
    -0.022725312,
    -0.049053423,
    -0.017949661,
    0.025276069,
    0.037755169,
    -0.083922826,
    0.016566532,
    -0.032377485,
    -0.023750352,
    0.043139111,
    0.023223901,
    -0.027218733,
    -0.103294514,
    0.047148868,
    0.006192886,
    -0.019486992,
    0.001126303,
    0.020836568,
    0.008525967,
    -0.051884182,
    -0.016821895,
    0.026859414,
    -0.00434625,
    -0.024030419,
    -0.027391581,
    0.025893822,
    -0.015573653,
    -0.036517248,
    0.010539717,
    0.009605923,
    0.02858383,
    0.012352169,
    -0.00632077,
    -0.045703314,
    -0.008780511,
    -0.011514449,
    -0.036537882,
    -0.054551858,
    0.034673113,
    -0.025784623,
    0.0242755,
    -0.015946154,
    0.002083004,
    0.005798031,
    -0.011257397,
    0.031447999,
    0.015384744,
    -0.048320591,
    0.026378069,
    0.012407306,
    -0.009136805,
    0.004135304,
    0.027467145,
    0.022027394,
    0.011726461,
    0.055059619,
    0.027000114,
    0.039752834,
    -0.035669334,
    0.04613721,
    0.041471735,
    -0.017670581,
    0.045186777,
    -0.025657715,
    0.062007274,
    0.019057628,
    0.037409008,
    0.023417402,
    -0.024411017,
    0.034876596,
    0.032954119,
    0.01469476,
    -0.024871079,
    0.016596625,
    0.010124212,
    -0.02969221,
    0.037300415,
    0.002326397,
    -0.004466749,
    0.048283063,
    0.039302669,
    -0.037614141,
    -0.015572374,
    -0.000304301,
    0.007676073,
    -0.016541565,
    0.012318124,
    0.018063758,
    0.019212745,
    -0.028016962,
    0.007804728,
    -0.016826542,
    -0.023737706,
    -0.010751064,
    0.036751799,
    -0.019390516,
    -0.008462273,
    -0.032099593,
    0.043403976,
    0.008372849,
    -0.027648062,
    -0.019835398,
    -0.028431885,
    -0.048311468,
    -0.007250658,
    0.023870017,
    0.024312312,
    0.004122802,
    0.023858927,
    -0.01478909,
    0.027240932,
    -0.027741365,
    0.061359718,
    0.042199749,
    0.020223465,
    0.022276778,
    0.07894785,
    -0.026033126,
    0.011555114,
    0.030769508,
    0.046954416,
    -0.081811637,
    -0.0090471,
    0.032309134,
    0.009105949,
    -0.058973476,
    -0.018578472,
    -0.009910942,
    -0.012720776,
    -0.017195266,
    0.009870533,
    -0.019018656,
    0.01332501,
    0.017510418,
    -0.032850321,
    0.041189358,
    -0.035003256,
    0.018262774,
    0.026403585,
    0.00268733,
    -0.010041779,
    0.004509672,
    -0.00481433,
    -0.025490154,
    0.02716933,
    -0.021551423,
    0.01801697,
    0.011077097,
    0.037605707,
    0.018750807,
    0.050470766,
    -0.034299415,
    -0.030109715,
    0.050712194,
    0.021018358,
    0.027385969,
    0.077744298,
    0.049238086,
    0.055271342,
    0.040497161,
    0.037714742,
    -0.017117668,
    -0.013922586,
    -0.003770414,
    -0.013503683,
    -0.034719136,
    -0.030357078,
    0.02423867,
    0.041604027,
    -0.04109402,
    0.011280581,
    0.061746489,
    -0.04289883,
    -0.039179005,
    -0.023838433,
    0.029245857,
    -0.06580855,
    -0.034939922,
    -0.022960989,
    0.003327339,
    0.011103626,
    0.005351729,
    -0.023995085,
    -0.031859521,
    0.027881505,
    0.07962203,
    -0.022223037,
    0.023637038,
    -0.070690595,
    -0.030005738,
    -0.024277626,
    0.003020408,
    -0.018305279,
    0.013813329,
    -0.005794607,
    -0.006027449,
    0.076092109,
    -0.0495448,
    0.013548992,
    -0.012024068,
    -0.002623661,
    0.000307087,
    -0.044918753,
    -0.044247586,
    0.015334518,
    0.035493545,
    -0.002372369,
    0.035529912,
    0.001295016,
    -0.026393821,
    -0.031403273,
    -0.033624571,
    0.058690306,
    0.02092381,
    -0.002660778,
    0.002159158,
    0.001877763,
    0.022155425,
    -0.018316429,
    -0.00701461,
    -0.046457652,
    -0.014580603,
    -0.014616319,
    -0.002080362,
    0.000172053,
    -0.017254502,
    -0.036966879,
    0.004771863,
    -0.011007326,
    0.018374946,
    0.011356508,
    0.02760436,
    0.056606311,
    -0.006458249,
    -0.030751713,
    0.00981419,
    0.006718763,
    0.025413994,
    -0.05451104,
    0.028875811,
    -0.008950452,
    -0.00890913,
    -0.020566545,
    0.000634992,
    -0.000714736,
    0.042678196,
    -0.030825244,
    -0.002180639,
    0.013044496,
    -0.018048603,
    -0.005925023,
    0.032585636,
    -0.004422543,
    -0.066175647,
    -0.00203436,
    -0.000827834,
    -0.010989088,
    -0.043973248,
    0.017073568,
    -0.025286879,
    -0.0506281,
    0.041191846,
    0.027638901,
    0.023961499,
    -0.022335105,
    -0.000356151,
    -0.002466277,
    -0.032634515,
    -0.028886653,
    -0.040562049,
    0.020787852,
    -0.025142668,
    -0.069378115,
    0.005500275,
    -0.012433065,
    -0.014529943,
    -0.026051164,
    0.015248396,
    -0.014018545,
    -0.029040391,
    0.029177127,
    0.003906934,
    -0.033007253,
    -0.021334667,
    -0.012635293,
    0.023187507,
    -0.008600003,
    -0.009441214,
    -0.038829725,
    0.003978497,
    0.019979058,
    0.030913003,
    0.010507382,
    -0.077671841,
    0.021034388,
    0.003404054,
    -0.022766661,
    0.02221025,
    0.046451483,
    0.00793187,
    -0.037152179,
    -0.00567685,
    0.013193112,
    -0.012082797,
    -0.033393078,
    0.038294852,
    0.020027922,
    0.034437899,
    0.008943284,
    0.001824188,
    0.041525919,
    -0.017149944,
    0.051185276,
    0.016776262,
    -0.006897373,
    -0.007186886,
    -0.061185569,
    -0.020614192,
    0.039145183,
    -0.0394914,
    -0.066781394,
    0.026034471,
    0.002028012,
    -0.015886085,
    0.009663527,
    0.014443815,
    0.034227643,
    0.043713897,
    -0.015591782,
    -0.005901943,
    -0.019342963,
    -0.013429,
    -0.004215578,
    0.032671254,
    -0.03019302,
    0.008962538,
    0.013057678,
    -0.021542652,
    0.004891942,
    0.005237378,
    -0.013358762,
    0.050865736,
    0.016113836,
    -0.017519897,
    0.007401447,
    -0.008783337,
    -0.003321433,
    0.018309252,
    -0.036529612,
    -0.077670187,
    -0.010286292,
    0.017882299,
    -0.0139928,
    0.049826961,
    -0.014785161,
    -0.011357339,
    -0.008872991,
    -0.023610301,
    -0.017447833,
    0.052860077,
    0.031712469,
    0.063786939,
    -0.042552978,
    -0.043318942,
    0.08331883,
    -0.025431307,
    -0.00121517,
    -0.010507981,
    -0.046365701,
    -0.049016979,
    0.016057368,
    0.010310945,
    -0.036984645,
    0.002522467,
    0.001515663,
    0.027634077,
    -0.04937109,
    -0.016783185,
    0.023043504,
    -0.00014605,
    0.019588934,
    -0.016186053,
    -0.03234341,
    -0.005245082,
    -0.010685929,
    0.007880945,
    0.018540055,
    0.01811368,
    0.023571195,
    -0.059540384,
    -0.01230774,
    -0.035207726,
    -0.021728842,
    0.041696049,
    -0.04391237,
    0.001335816,
    -0.022700913,
    0.050525453,
    0.049770702,
    -0.000770502,
    -0.009495602,
    -0.025962833,
    -0.022218946,
    0.024032779,
    0.017164588,
    0.044556227,
    -0.052538741,
    0.041801229,
    0.035610195,
    0.028030412,
    0.004392001,
    0.00288471,
    0.014529176,
    0.028875306,
    -0.002821305,
    -0.045452699,
    -0.020403277,
    -0.015134815,
    -0.00260129,
    -0.017608861,
    0.035417788,
    0.024227977,
    -0.00334698,
    0.002357276,
    0.007092367,
    -0.035399713,
    -0.017335027,
    0.00888455,
    0.035774816,
    0.025536442,
    -0.072694212,
    -0.001205048,
    -0.042885058,
    0.014932351,
    -0.012718172,
    -0.023341667,
    -0.027543753,
    0.031131798,
    0.023284122,
    -0.015126826,
    -0.00148309,
    0.039340645,
    0.051084843,
    -0.052966487,
    0.030779555,
    -0.044278357,
    -0.07210137,
    -0.001106895,
    -0.045226507,
    0.042052504,
    0.028628949,
    0.019319516,
    0.012102492,
    -0.015039926,
    -0.000770874,
    -0.003550825,
    0.020012261,
    0.007650602,
    0.035003029,
    0.026776189,
    -0.034733817,
    -0.033971556,
    -0.064106718,
    -0.022289636,
    -0.036871653,
    -0.015649479,
    0.027214911,
    -0.009572512,
    0.022574041,
    0.005460725,
    0.046429459,
    0.017231146,
    0.011121547,
    0.041666158,
    0.033097476,
    -0.006214294,
    -0.047072574,
    0.003427586,
    -0.059978835,
    -0.005432485,
    0.031406339,
    0.000197063,
    -0.048493061,
    0.010864886,
    0.030511208,
    0.004960102,
    0.033595789,
    -0.015410075,
    0.002755953,
    -0.043541647,
    -0.040584095,
    0.017314715,
    -0.028234538,
    -0.013304264,
    -0.020222573,
    0.004476228,
    0.044011205,
    0.005168173,
    0.004234465,
    0.000722701,
    0.002005706,
    -0.019538274,
    0.014761628,
    -0.009106282,
    0.03012947,
    -0.013914681,
    0.013472226,
    0.00466468,
    -0.015355447,
    -0.021594822,
    0.026558468,
    0.02127683,
    0.067187659,
    0.066915952,
    0.042893417,
    0.026797658,
    0.00879729,
    0.00264973,
    -0.034963556,
    0.012385633,
    0.05708731,
    0.003816868,
    0.017985929,
    0.001651349,
    0.019553093,
    -0.000459323,
    -0.006607623,
    -0.025727194
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Models/VersionMetadata.cs",
    "chunk_index": 0,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "@@ -1,16 +1,85 @@\n using System.Collections.Concurrent;\n \n namespace TxtDb.Storage.Models;\n \n+/// <summary>\n+/// Version metadata with thread-safe collections to prevent concurrent modification exceptions during serialization.\n+/// CRITICAL FIX: All collections must be thread-safe to prevent \"Collection was modified; enumeration operation may not execute\"\n+/// exceptions when serializing metadata while other threads are modifying the collections.\n+/// </summary>\n public class VersionMetadata\n {\n     public long CurrentTSN { get; set; }\n-    public HashSet<long> ActiveTransactions { get; set; } = new();\n-    public Dictionary<string, PageVersionInfo> PageVersions { get; set; } = new();\n-    public Dictionary<string, int> NamespaceOperations { get; set; } = new();\n+    \n+    // Thread-safe collections to prevent concurrent modification exceptions during JSON serialization\n+    public ConcurrentDictionary<long, byte> ActiveTransactions { get; set; } = new();\n+    public ConcurrentDictionary<string, PageVersionInfo> PageVersions { get; set; } = new();\n+    public ConcurrentDictionary<string, int> NamespaceOperations { get; set; } = new();\n+    \n+    /// <summary>\n+    /// Track deleted namespaces to prevent operations on them\n+    /// CRITICAL: Operations on deleted namespaces must throw ArgumentException\n+    /// </summary>\n+    public ConcurrentDictionary<string, DateTime> DeletedNamespaces { get; set; } = new();\n+    \n     public DateTime LastUpdated { get; set; } = DateTime.UtcNow;\n+    \n+    /// <summary>\n+    /// Creates a serialization-safe snapshot of this metadata.\n+    /// Used to prevent concurrent modification exceptions during JSON serialization.\n+    /// </summary>\n+    public VersionMetadataSnapshot CreateSnapshot()\n+    {\n+        return new VersionMetadataSnapshot\n+        {\n+            CurrentTSN = this.CurrentTSN,\n+            ActiveTransactions = new HashSet<long>(this.ActiveTransactions.Keys),\n+            PageVersions = new Dictionary<string, PageVersionInfo>(this.PageVersions.ToDictionary(kvp => kvp.Key, kvp => kvp.Value.Clone())),\n+            NamespaceOperations = new Dictionary<string, int>(this.NamespaceOperations),\n+            DeletedNamespaces = new Dictionary<string, DateTime>(this.DeletedNamespaces),\n+            LastUpdated = this.LastUpdated\n+        };\n+    }\n+    \n+    /// <summary>\n+    /// Helper methods for HashSet-like operations on ActiveTransactions\n+    /// </summary>\n+    public bool AddActiveTransaction(long transactionId) => ActiveTransactions.TryAdd(transactionId, 0);\n+    public bool RemoveActiveTransaction(long transactionId) => ActiveTransactions.TryRemove(transactionId, out _);\n+    public bool ContainsActiveTransaction(long transactionId) => ActiveTransactions.ContainsKey(transactionId);\n+    public void ClearActiveTransactions() => ActiveTransactions.Clear();\n+    \n+    /// <summary>\n+    /// Restores metadata from a snapshot (used during loading from disk)\n+    /// </summary>\n+    public static VersionMetadata FromSnapshot(VersionMetadataSnapshot snapshot)\n+    {\n+        var metadata = new VersionMetadata\n+        {\n+            CurrentTSN = snapshot.CurrentTSN,\n+            LastUpdated = snapshot.LastUpdated\n+        };\n+        \n+        // Convert snapshot collections back to thread-safe collections\n+        foreach (var transactionId in snapshot.ActiveTransactions)\n+        {\n+            metadata.AddActiveTransaction(transactionId);\n+        }\n+        \n+        foreach (var kvp in snapshot.PageVersions)\n+        {\n+            metadata.PageVersions[kvp.Key] = kvp.Value;\n+        }\n+        \n+        foreach (var kvp in snapshot.NamespaceOperations)\n+        {\n+            metadata.NamespaceOperations[kvp.Key] = kvp.Value;\n+        }\n+        \n+        return metadata;\n+    }\n }\n \n public class PageVersionInfo\n {\n     private readonly object _lock = new object();\n@@ -85,8 +154,31 @@ public class MVCCTransaction\n     public long TransactionId { get; set; }\n     public long SnapshotTSN { get; set; }\n     public DateTime StartTime { get; set; }\n     public Dictionary<"
}