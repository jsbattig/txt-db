{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs:7",
  "vector": [
    0.019568391,
    0.000577453,
    0.004836821,
    0.07068494,
    -0.009166761,
    -0.014331225,
    -0.018703731,
    -0.015717616,
    0.042942632,
    0.013155372,
    0.048228104,
    -0.010894734,
    0.082315505,
    -0.025052322,
    -0.061877172,
    -0.054729644,
    0.013512329,
    0.013310874,
    -0.040246472,
    0.025715286,
    -0.041024171,
    -0.039571475,
    -0.06537991,
    0.035844516,
    -0.065994605,
    0.004209024,
    0.012996622,
    0.022909664,
    -0.018103348,
    0.03388131,
    -0.023498669,
    -0.062408552,
    0.012465427,
    0.035119239,
    0.037087914,
    -0.013513035,
    -0.040326711,
    -0.013590936,
    0.003994146,
    0.024310946,
    0.047332104,
    -0.009751321,
    0.035685655,
    -0.016795909,
    0.004413222,
    -0.059063327,
    -0.014809132,
    0.001610042,
    -0.017761299,
    0.029152922,
    -0.016458467,
    -0.008142541,
    -0.035267852,
    0.063376985,
    0.007649078,
    -0.026085855,
    0.082198068,
    0.026490306,
    -0.036479969,
    0.042380508,
    0.001163096,
    0.00315276,
    -0.022291161,
    0.01306029,
    -0.030586386,
    -0.048477776,
    -0.058142561,
    0.067002751,
    0.009982972,
    -0.056250997,
    0.034830809,
    0.029479358,
    -0.001029922,
    0.052572805,
    0.040899273,
    0.025199953,
    0.036154229,
    0.02524999,
    0.06634701,
    -0.003449801,
    -0.042586334,
    -0.07100334,
    0.01558585,
    -0.036896415,
    0.032914329,
    -0.033880115,
    0.027371651,
    -0.036539376,
    0.004398167,
    0.006511762,
    -0.016145466,
    0.053884842,
    0.046809711,
    0.023465803,
    -0.004761846,
    0.034868371,
    0.008445681,
    -0.000501818,
    0.036059294,
    -0.025644768,
    -0.004744903,
    0.002409051,
    -0.030362848,
    0.071324699,
    -0.063337043,
    -0.015150662,
    -3.1887e-05,
    -0.027903337,
    -0.020231612,
    0.039479099,
    0.03403369,
    0.02217225,
    0.008384221,
    0.008210116,
    0.009391061,
    0.003516521,
    -0.002156482,
    -0.02088988,
    0.017585292,
    0.044128757,
    -0.029225402,
    0.033213373,
    -0.065931089,
    0.042046495,
    -0.017982058,
    0.056635886,
    0.013095177,
    0.036546011,
    0.024271721,
    -0.036553066,
    -0.018336203,
    -0.041910812,
    -0.010847936,
    0.014335375,
    -0.00992617,
    0.032204039,
    0.015371093,
    0.013582654,
    0.010093381,
    -0.027493408,
    0.043339621,
    0.001794248,
    -0.002311342,
    0.021649776,
    -0.002229113,
    0.037147582,
    0.002476258,
    -0.018659974,
    0.013859695,
    -0.067227051,
    0.016718697,
    0.035383668,
    -0.051133472,
    0.008483303,
    -0.008385273,
    0.011315206,
    -0.023899082,
    -0.034387536,
    -0.01677586,
    -0.036737889,
    -0.050631925,
    0.034776706,
    0.01484178,
    0.009771327,
    0.00072572,
    0.043132205,
    0.0152494,
    0.002109527,
    0.025606753,
    -0.022118902,
    -0.040566292,
    0.055260409,
    -0.06849467,
    -0.017448395,
    -0.011827924,
    0.028468093,
    0.008781389,
    0.018113529,
    -0.057974111,
    -0.052544795,
    0.013358856,
    -0.005029679,
    -0.002408736,
    -0.015167023,
    -0.011999579,
    -0.00999296,
    0.060997825,
    0.02057573,
    0.011964175,
    0.030040074,
    -0.025038548,
    0.012854847,
    -0.021630807,
    -0.012956898,
    -0.010706052,
    -0.033704817,
    -0.034943949,
    0.005081596,
    0.021161115,
    0.01373436,
    -0.062660955,
    0.030894855,
    -0.08248166,
    -0.005180561,
    0.02783322,
    -0.000471702,
    -0.029289441,
    -0.023463257,
    0.002627582,
    0.007491162,
    -0.011117572,
    0.005651412,
    0.002465968,
    -0.02097844,
    0.026046347,
    -0.031341642,
    -0.03680801,
    0.007701864,
    0.059788726,
    0.00607278,
    0.003557757,
    -0.00106258,
    0.051788356,
    0.018124036,
    -0.041330796,
    -0.037203275,
    -0.054489866,
    -0.065376773,
    0.009155987,
    -0.027501706,
    0.015693367,
    -0.057366319,
    0.032809,
    -0.03229377,
    -0.079570234,
    0.036816884,
    -0.01938053,
    -0.026602013,
    0.00691712,
    -0.030837124,
    -0.011588363,
    0.065354943,
    -0.004194161,
    0.015044498,
    -0.006622193,
    0.025855239,
    0.058786847,
    0.018976485,
    -0.008001223,
    0.007145749,
    -0.052361272,
    0.039083194,
    -0.026446955,
    0.109116606,
    0.044942625,
    -0.006078416,
    -0.019342279,
    0.003670093,
    -0.015577819,
    -0.011310651,
    -0.004627482,
    0.006556466,
    -0.017652771,
    0.036529295,
    0.000185883,
    0.030751437,
    -0.040054325,
    -0.024990452,
    -0.012537747,
    0.024335545,
    0.032457296,
    0.015745115,
    0.048243869,
    0.023441207,
    -0.016966732,
    -0.032477897,
    0.021278316,
    0.044540189,
    0.004955879,
    0.03303479,
    -0.037820227,
    -0.01192912,
    0.016500203,
    -0.03142317,
    -0.013633262,
    -0.027292768,
    0.021475291,
    -0.025060903,
    0.01500045,
    0.029975263,
    0.029887145,
    -0.019698927,
    -0.019993292,
    -0.03595205,
    0.03779481,
    0.022183917,
    0.020735672,
    -0.007147219,
    0.009095619,
    -0.02342947,
    -0.032056991,
    -0.005507511,
    0.073542692,
    0.018461365,
    -0.011096388,
    0.014975677,
    0.033771634,
    -0.029398303,
    0.013234274,
    -0.032362495,
    -0.043299705,
    -0.002808459,
    0.016757753,
    -0.002359981,
    0.020161619,
    -0.025830807,
    -0.033150803,
    -0.009162326,
    -0.019767134,
    0.006971021,
    0.000979712,
    -0.03057863,
    0.037701115,
    -0.081533112,
    0.019725205,
    0.00459411,
    -0.0606055,
    -0.05080932,
    0.052496854,
    -0.038508173,
    -0.008383492,
    0.025294278,
    -0.019061007,
    0.064924061,
    -0.010194496,
    0.012775701,
    -0.023264313,
    0.005961413,
    -0.046258286,
    0.004828058,
    0.015515979,
    -0.027711801,
    0.032481182,
    -0.044926964,
    0.050434127,
    -0.006088892,
    -0.021892201,
    -0.005963481,
    -0.026631918,
    0.05376957,
    0.006548319,
    -0.049238246,
    -0.016924277,
    -0.001105003,
    -0.047032323,
    0.059754904,
    -0.019284129,
    0.00737279,
    -0.009505088,
    0.004842704,
    0.022593781,
    0.036591496,
    -0.060038369,
    -0.012132292,
    -0.021825651,
    0.004187214,
    -0.055653457,
    0.057542793,
    -0.023536289,
    0.022265691,
    -0.062386952,
    -0.059001602,
    -0.029160466,
    -0.014459078,
    -0.011460127,
    0.026317131,
    0.033444837,
    -0.012901356,
    -0.03451563,
    -0.03716157,
    0.005240801,
    0.018710809,
    0.003666462,
    0.023203662,
    -0.020704288,
    -0.025274351,
    0.018347675,
    0.026464855,
    -0.012966412,
    0.032017689,
    0.002999214,
    0.036973476,
    0.008012769,
    0.023002394,
    0.002802116,
    -0.014567347,
    -0.006042479,
    0.059616163,
    0.015650375,
    -0.019569084,
    0.004626347,
    -0.005535256,
    0.030919267,
    -0.093017347,
    0.02789896,
    0.006151365,
    0.02782277,
    0.033792682,
    0.016127927,
    0.04918883,
    -0.008759934,
    0.044203967,
    0.006009971,
    0.00949007,
    -0.024052752,
    0.030341133,
    -0.014167329,
    -0.011940024,
    0.011110681,
    0.014019318,
    -0.001263229,
    -0.025878796,
    0.024031015,
    0.001153789,
    -0.023349816,
    0.01038334,
    0.025799686,
    -0.100025937,
    -0.044880267,
    -0.007616269,
    -0.00645931,
    0.001803017,
    -0.03932742,
    0.015849983,
    0.034690071,
    -0.05553636,
    0.00267492,
    -0.008715579,
    -0.043787878,
    -0.054764122,
    0.029610962,
    -0.017130094,
    0.029632896,
    -0.020726791,
    -0.006964837,
    -0.020612635,
    0.022612225,
    0.0475315,
    -0.030448359,
    -0.020177422,
    -0.058907215,
    0.004786918,
    -0.053586051,
    0.005631449,
    0.058166917,
    -0.017609157,
    -0.004643609,
    0.032035463,
    -0.005208237,
    -0.018814228,
    -0.006459359,
    -0.018983938,
    -0.005872068,
    0.01567615,
    -0.017277651,
    0.020920733,
    0.046031855,
    -0.055212419,
    -0.008658893,
    0.00963725,
    0.032255687,
    -0.026486,
    0.002163737,
    0.007487585,
    0.036479183,
    0.050518062,
    0.007607942,
    0.065595619,
    -0.02670273,
    -0.022908477,
    -0.020223882,
    -0.08111389,
    -0.039189953,
    -0.028133461,
    -0.021659885,
    0.0219981,
    -0.034078151,
    0.016023282,
    0.018801253,
    -0.03527157,
    -0.02188408,
    -0.016442837,
    0.002247088,
    -0.00886181,
    0.016540481,
    -0.016510714,
    -0.015576791,
    -0.020776268,
    -0.0379926,
    0.047648098,
    0.027861863,
    -0.087044269,
    0.008508776,
    -0.001815489,
    -0.021651082,
    0.022577118,
    0.029489007,
    -0.023323441,
    -0.06745027,
    0.025273778,
    -0.005702947,
    -0.010677235,
    -0.0168985,
    0.015966069,
    0.038263865,
    -0.023216572,
    -0.040625341,
    0.008455601,
    -0.000536889,
    -0.01802714,
    0.022317227,
    -0.004121466,
    -0.032204069,
    -0.075963341,
    -0.000750622,
    0.00396905,
    0.028886385,
    0.016391225,
    0.010698201,
    -0.029547825,
    0.006866106,
    0.022215312,
    -0.012869165,
    -0.052037328,
    0.014755799,
    -0.001118161,
    0.016840393,
    -0.013123393,
    0.008155428,
    -0.023163144,
    -0.044230033,
    0.012886724,
    -0.025074264,
    -0.037372813,
    0.011980202,
    0.003156458,
    -0.006578903,
    0.012717665,
    -0.000229008,
    -0.012435895,
    -0.020665605,
    0.032199707,
    0.021960311,
    0.075862184,
    -0.036454111,
    0.05795978,
    0.019487495,
    -0.013777992,
    0.036071323,
    -0.026191412,
    0.026062045,
    0.011427135,
    -0.009152495,
    0.015902063,
    -0.030900357,
    0.035598386,
    0.030513115,
    0.001106281,
    -0.014514827,
    -0.012072149,
    0.013100373,
    -0.015659397,
    0.014117159,
    -0.010704683,
    -0.015814571,
    0.034309339,
    0.049110677,
    -0.059912942,
    -0.010368379,
    -0.024721889,
    0.008267731,
    -0.006996179,
    0.005649954,
    0.050033651,
    -0.017292874,
    -0.043691985,
    0.023086276,
    -0.015605622,
    -0.049516506,
    -0.018394245,
    0.027169719,
    -0.040093765,
    0.019373044,
    -0.040205881,
    0.060695048,
    0.018077865,
    -0.045496028,
    -0.043414649,
    0.016042043,
    -0.039653938,
    0.007860048,
    0.016777098,
    0.031869181,
    0.021093111,
    -0.010683768,
    -0.028198645,
    0.019588666,
    -0.019593919,
    0.047511503,
    0.04265625,
    0.016861405,
    0.000120266,
    0.07556057,
    0.00273312,
    0.033132959,
    0.052655037,
    0.027764432,
    -0.083600774,
    0.009324417,
    0.017516393,
    0.01353548,
    -0.040123004,
    -0.005996259,
    0.005210981,
    -0.009298336,
    0.007894988,
    0.022099631,
    0.009335957,
    -0.010215508,
    0.000499042,
    0.006105215,
    0.032333497,
    -0.042588424,
    0.012644634,
    0.004448043,
    0.010073138,
    0.024417151,
    0.012189183,
    -0.004667562,
    -0.000998493,
    -0.01416473,
    -0.024536241,
    0.00573859,
    0.018525921,
    0.053113215,
    0.024076926,
    0.036631744,
    -0.035698913,
    -0.021134144,
    0.038656492,
    0.021078954,
    0.014322344,
    0.087500468,
    0.036001872,
    0.033931803,
    0.012648613,
    0.019845542,
    -0.012542915,
    -0.026454905,
    -0.005517873,
    -0.024408581,
    -0.031783801,
    -0.019527979,
    0.039649632,
    0.032734912,
    -0.018384945,
    -0.00776624,
    0.041694693,
    -0.013210943,
    -0.036801625,
    -0.039401352,
    0.010155926,
    -0.046244711,
    -0.029108871,
    -0.003066033,
    0.001560035,
    0.00489446,
    0.003443683,
    -0.00099395,
    -0.001221696,
    0.032693684,
    0.082751177,
    -0.012896637,
    -0.002741184,
    -0.069138356,
    -0.002463197,
    -0.012927648,
    0.00776019,
    -0.007065221,
    -0.003490415,
    -0.028489679,
    -0.024848469,
    0.110770687,
    -0.038464397,
    0.004326879,
    -0.012190663,
    0.020870926,
    -0.014220349,
    -0.06535013,
    -0.051616967,
    -0.004710717,
    0.058881268,
    -0.003743251,
    0.003151127,
    0.014525498,
    -0.022996742,
    -0.002780641,
    0.005956129,
    0.065734304,
    0.002717751,
    0.011102254,
    -0.012614225,
    -0.000376024,
    0.019811021,
    0.00286372,
    0.020227687,
    -0.030100884,
    -0.051245578,
    -0.013835615,
    0.026634986,
    0.020336652,
    -0.015608856,
    -0.037052725,
    0.018711045,
    0.008863523,
    0.015051366,
    -0.025146704,
    0.002188241,
    0.073338851,
    -0.016440436,
    -0.028909802,
    0.00328804,
    0.053073488,
    0.0399554,
    -0.070186101,
    0.000672313,
    -0.052363649,
    0.020377502,
    -0.032680456,
    -0.002271632,
    0.026432261,
    0.014570272,
    -0.021118436,
    -0.017250737,
    -0.0179991,
    -0.004582804,
    -0.024868168,
    0.022936285,
    -0.023137882,
    -0.046682052,
    -0.033135068,
    0.008152069,
    0.006491673,
    -0.008570072,
    0.029869942,
    -0.03278812,
    -0.046123751,
    0.057915006,
    -0.017903823,
    0.039298899,
    -0.030446477,
    0.019785792,
    -0.005284884,
    -0.058053289,
    -0.036292721,
    -0.017203275,
    0.016682275,
    0.003874697,
    -0.059002545,
    0.000209311,
    -0.03566809,
    -0.000534342,
    -0.006968313,
    0.025308862,
    -0.030175593,
    -0.061002854,
    0.021768348,
    -0.010441739,
    -0.033588555,
    -0.006296339,
    0.007404797,
    0.002033087,
    0.009159907,
    -0.012269677,
    -0.027141698,
    0.005880249,
    0.030815048,
    0.048791174,
    -0.033010159,
    -0.035765532,
    0.047359616,
    -0.00124575,
    -0.0332045,
    0.0213628,
    0.012306893,
    -0.006217801,
    -0.038539685,
    -0.0298713,
    0.023667356,
    0.024303783,
    -0.034866266,
    0.036921218,
    0.007138738,
    0.030527091,
    -0.019213857,
    -0.011505955,
    0.054042857,
    -0.000896645,
    0.015493295,
    0.012490201,
    0.024835886,
    -0.018239258,
    -0.037554007,
    0.001839189,
    0.019748561,
    -0.000941215,
    -0.066567361,
    0.030533098,
    0.009964644,
    0.008536849,
    0.012205841,
    0.043370336,
    0.013157921,
    0.019029252,
    -0.020583101,
    -0.003125282,
    -0.016690066,
    0.002537851,
    -0.012176201,
    0.007967404,
    -0.063250408,
    0.02933559,
    0.002700349,
    -0.046235103,
    0.021469088,
    0.023047086,
    -0.018240999,
    0.025745891,
    0.001900759,
    -0.024877895,
    0.015673367,
    0.022879202,
    0.026126418,
    0.032341979,
    -0.037432663,
    -0.059158299,
    -0.000105834,
    0.025068706,
    -0.021201927,
    0.005730628,
    0.01745682,
    -0.031790812,
    -0.014684406,
    -0.007918234,
    0.002238509,
    0.061003391,
    -0.010628058,
    0.018737499,
    -0.057364061,
    -0.00579293,
    0.053280272,
    0.020121403,
    -0.020430688,
    -0.003059152,
    -0.035942081,
    -0.026198091,
    0.011566754,
    0.01327658,
    -0.042760894,
    -0.012034245,
    0.011691484,
    0.026137473,
    -0.053430911,
    -0.009730381,
    0.034831703,
    0.015820444,
    0.063548647,
    -0.008554796,
    -0.032768633,
    0.000909323,
    0.002317778,
    0.021343969,
    0.015705585,
    0.026330275,
    -0.001136513,
    -0.014671874,
    -0.03402501,
    -0.013248283,
    -0.01162112,
    0.015874142,
    -0.033213258,
    -0.015754722,
    -0.001123744,
    0.041764677,
    0.032450791,
    0.031064257,
    0.007596679,
    -0.046837468,
    0.009188158,
    0.02548431,
    0.008895966,
    0.027779298,
    -0.03827507,
    0.033920251,
    0.052038107,
    0.009181278,
    -0.021198578,
    0.000968861,
    -0.025470009,
    0.053167168,
    0.024382668,
    -0.031147374,
    -0.033426668,
    -0.032223485,
    -0.007497162,
    -0.001088794,
    0.009517419,
    0.041725423,
    0.020311857,
    -0.03761002,
    0.006147111,
    -0.048231021,
    -0.015140514,
    0.025030619,
    0.022084936,
    -0.001419021,
    -0.083698973,
    -0.011138299,
    -0.051357467,
    0.030795682,
    -0.028753212,
    -0.006652707,
    -0.023038561,
    0.008194564,
    0.002135072,
    -0.021238247,
    -0.00663637,
    0.045670159,
    0.047281057,
    -0.06314788,
    0.027554467,
    -0.038589135,
    -0.055225268,
    -0.007296031,
    -0.03473131,
    0.018024206,
    0.00631369,
    0.032389008,
    0.002258641,
    -0.036848389,
    -0.00458552,
    -0.003752714,
    0.029515276,
    0.034999371,
    0.045205899,
    0.002581554,
    -0.036469005,
    -0.007568963,
    -0.030843856,
    -0.018117838,
    0.013377052,
    -0.011288724,
    0.033589732,
    0.008580444,
    0.05117676,
    0.002311517,
    0.061830189,
    0.058517855,
    0.014872947,
    0.052634094,
    0.014645981,
    -0.008175244,
    -0.041205421,
    0.00069852,
    -0.038004331,
    -0.022590023,
    0.041771371,
    0.009255251,
    -0.0528723,
    0.032896712,
    0.049592093,
    -0.012913153,
    0.03807288,
    -0.011754006,
    0.001660741,
    -0.048426811,
    -0.035223205,
    0.030433515,
    -0.045993105,
    -0.033941176,
    0.00682767,
    0.015733292,
    -0.006904472,
    0.008138929,
    -0.002865705,
    -0.008576232,
    -0.045038819,
    -0.007122153,
    0.008307972,
    -0.014754132,
    0.025572814,
    0.003020457,
    0.027517091,
    0.003294152,
    0.002938812,
    -0.034701344,
    0.021674009,
    0.01398748,
    0.052871399,
    0.036086168,
    0.040541865,
    0.054090079,
    0.02133345,
    0.010469968,
    -0.0201007,
    0.012509412,
    0.037542358,
    -0.025399994,
    0.05501673,
    0.00315229,
    0.009185231,
    -0.037936259,
    0.005334537,
    -0.025679443
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs",
    "chunk_index": 7,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "  await File.WriteAllTextAsync(markerFile, markerContent, cancellationToken).ConfigureAwait(false);\n             \n+            // CRITICAL SECURITY FIX: Track namespace marker file in transaction for isolation-safe critical flushing\n+            if (_activeTransactions.TryGetValue(transactionId, out var transaction))\n+            {\n+                transaction.WrittenFilePaths.Add(markerFile);\n+            }\n+            \n             if (_config.EnableBatchFlushing && _batchFlushCoordinator != null)\n             {\n                 await _batchFlushCoordinator.QueueFlushAsync(markerFile, FlushPriority.Normal).ConfigureAwait(false);\n             }\n             else\n@@ -498,20 +661,39 @@ public class AsyncStorageSubsystem : StorageSubsystem, IAsyncStorageSubsystem\n                     .Where(k => k.StartsWith($\"{namespaceName}:\"))\n                     .ToList();\n                     \n                 foreach (var key in keysToRemove)\n                 {\n-                    _metadata.PageVersions.Remove(key);\n+                    _metadata.PageVersions.TryRemove(key, out _);\n                 }\n                 \n-                _metadata.NamespaceOperations.Remove(namespaceName);\n+                _metadata.NamespaceOperations.TryRemove(namespaceName, out _);\n+                \n+                // Mark namespace as deleted to prevent future operations\n+                _metadata.DeletedNamespaces[namespaceName] = DateTime.UtcNow;\n             }\n         }, cancellationToken).ConfigureAwait(false);\n         \n         await PersistMetadataAsync(cancellationToken).ConfigureAwait(false);\n     }\n \n+    /// <summary>\n+    /// Override base ValidateNamespace to check for deleted namespaces\n+    /// CRITICAL: Operations on deleted namespaces must throw ArgumentException\n+    /// </summary>\n+    protected new void ValidateNamespace(string namespaceName)\n+    {\n+        // Call base validation first (null/empty/invalid chars)\n+        base.ValidateNamespace(namespaceName);\n+        \n+        // Check if namespace has been deleted\n+        if (_metadata.DeletedNamespaces.ContainsKey(namespaceName))\n+        {\n+            throw new ArgumentException($\"Namespace '{namespaceName}' has been deleted and is no longer available\");\n+        }\n+    }\n+\n     public async Task RenameNamespaceAsync(long transactionId, string oldName, string newName, CancellationToken cancellationToken = default)\n     {\n         cancellationToken.ThrowIfCancellationRequested();\n         \n         ValidateTransaction(transactionId);\n@@ -546,18 +728,22 @@ public class AsyncStorageSubsystem : StorageSubsystem, IAsyncStorageSubsystem\n                     \n                 foreach (var oldKey in keysToUpdate)\n                 {\n                     var newKey = oldKey.Replace($\"{oldName}:\", $\"{newName}:\");\n                     _metadata.PageVersions[newKey] = _metadata.PageVersions[oldKey];\n-                    _metadata.PageVersions.Remove(oldKey);\n+                    _metadata.PageVersions.TryRemove(oldKey, out _);\n                 }\n                 \n                 if (_metadata.NamespaceOperations.TryGetValue(oldName, out var operations))\n                 {\n                     _metadata.NamespaceOperations[newName] = operations;\n-                    _metadata.NamespaceOperations.Remove(oldName);\n+                    _metadata.NamespaceOperations.TryRemove(oldName, out _);\n                 }\n+                \n+                // CRITICAL: Mark old namespace as deleted to prevent future operations\n+                // After rename, the old namespace should be considered deleted\n+                _metadata.DeletedNamespaces[oldName] = DateTime.UtcNow;\n             }\n         }, cancellationToken).ConfigureAwait(false);\n         \n         await PersistMetadataAsync(cancellationToken).ConfigureAwait(false);\n     }\n@@ -629,91 +815,168 @@ public class AsyncStorageSubsystem : StorageSubsystem, IAsyncStorageSubsystem\n \n     // Private async helper methods\n     \n     private async Task<object[]> ReadPageInternalAsync(long transactionId, string namespaceName, string pageId, C"
}