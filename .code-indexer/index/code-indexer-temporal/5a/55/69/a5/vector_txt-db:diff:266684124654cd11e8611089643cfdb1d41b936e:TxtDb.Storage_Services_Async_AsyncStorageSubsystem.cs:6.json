{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs:6",
  "vector": [
    -0.003778765,
    0.003743937,
    0.010058035,
    0.037283305,
    -0.014112408,
    0.000154948,
    -0.023818888,
    -0.00658609,
    0.044814348,
    -0.00496689,
    0.036817148,
    -0.007723426,
    0.082165517,
    0.003420277,
    -0.07893914,
    -0.026849248,
    0.021534381,
    -0.002760473,
    -0.033961017,
    0.010687234,
    -0.027469909,
    -0.039253585,
    -0.043721523,
    0.046301454,
    -0.05428604,
    0.00427455,
    0.019045012,
    0.032068729,
    -0.021891126,
    0.041790992,
    -0.023560038,
    -0.062877253,
    0.015082449,
    0.041978184,
    0.032077223,
    -0.038501929,
    -0.035726152,
    -0.005486109,
    -0.013765878,
    0.022383232,
    0.020853054,
    -0.018719474,
    0.048881326,
    -0.033362143,
    0.002843851,
    -0.050806947,
    -0.003581707,
    0.008888155,
    -0.006996981,
    0.017574813,
    -0.027342256,
    -0.016199065,
    -0.019249769,
    0.069765337,
    0.003384224,
    -0.042067613,
    0.061358683,
    0.025508367,
    -0.037382681,
    0.056242369,
    -0.02255825,
    -0.026599227,
    -0.006645772,
    0.019103793,
    -0.010483813,
    -0.035329562,
    -0.057074856,
    0.063720591,
    0.035750922,
    -0.071571529,
    -0.004981268,
    -0.002420701,
    0.004462285,
    0.043170299,
    0.037676457,
    0.02873119,
    0.064837977,
    0.020357097,
    0.037382014,
    -0.00106192,
    -0.037261784,
    -0.040093195,
    0.006177113,
    -0.067145385,
    0.018698769,
    -0.01694526,
    0.009961185,
    -0.052418463,
    -0.009430196,
    -0.006745956,
    0.002220056,
    0.038615093,
    0.029194245,
    0.015613709,
    0.0270034,
    0.035791416,
    0.004744507,
    -0.009522091,
    0.035022661,
    -0.012942874,
    -0.018135263,
    0.001538014,
    -0.038936783,
    0.060145732,
    -0.04956305,
    -0.01057943,
    0.015226698,
    -0.030499546,
    0.009660481,
    0.042123489,
    0.05630995,
    0.014178094,
    0.011944896,
    -0.009264084,
    0.008301572,
    -0.010259549,
    -0.02581545,
    -0.042697869,
    0.020013168,
    0.048250485,
    -0.034038942,
    0.010576595,
    -0.046400204,
    0.052353561,
    -0.043560527,
    0.058453042,
    0.0059688,
    0.050542813,
    0.004062581,
    -0.048065748,
    -0.005211681,
    -0.042810977,
    0.013970207,
    0.005083034,
    -0.006274582,
    0.046210308,
    0.026686968,
    0.04121387,
    -0.003898206,
    -0.030037628,
    0.031684007,
    -0.003950265,
    -0.002623173,
    0.020767156,
    -0.011499288,
    0.016289752,
    0.041493669,
    -0.016286561,
    0.003014858,
    -0.07683187,
    0.018367682,
    0.041321684,
    -0.022568798,
    0.0195259,
    0.00028209,
    0.021916544,
    -0.002290823,
    -0.022784809,
    0.000118243,
    -0.030470466,
    -0.039359879,
    0.018506899,
    0.044702932,
    -0.000101717,
    -0.030752556,
    0.071341947,
    -0.029515486,
    0.002989485,
    0.020095207,
    -0.03284936,
    -0.063605323,
    0.026236208,
    -0.046683945,
    -0.012862151,
    -0.067250922,
    0.005450387,
    0.048375264,
    0.013352966,
    -0.080466725,
    -0.064331025,
    0.020239795,
    0.026000902,
    -0.004421986,
    0.018341476,
    -0.025499394,
    -0.014908375,
    0.034982316,
    0.021662669,
    0.025536884,
    0.00716431,
    -0.02667647,
    0.014510656,
    -0.03942392,
    -0.01296849,
    -0.013924291,
    -0.017006041,
    -0.000191699,
    -0.005611133,
    0.042783037,
    0.026999924,
    -0.046361513,
    0.033394057,
    -0.060811795,
    -0.001101348,
    0.009453001,
    0.004289174,
    -0.029787194,
    -0.047229189,
    0.012256203,
    0.030118961,
    -0.004367542,
    -0.016545035,
    0.006469842,
    -0.017726216,
    0.032611664,
    -0.014180984,
    -0.053879824,
    -0.004899219,
    0.061686523,
    -0.006982759,
    0.001718878,
    -0.018124836,
    0.048107792,
    0.008802654,
    -0.032652456,
    -0.021318756,
    -0.043538969,
    -0.067541897,
    -0.016001519,
    -0.033364862,
    0.015052664,
    -0.059215147,
    0.018335715,
    -0.047437582,
    -0.080024108,
    0.049268823,
    -0.003631159,
    -0.015181983,
    0.0013357,
    -0.008396593,
    0.000521395,
    0.037561819,
    0.016952539,
    0.017101917,
    -0.034888875,
    0.030531766,
    0.06457746,
    0.007976755,
    0.004593745,
    -0.007344001,
    -0.035249382,
    0.043897711,
    -0.043338977,
    0.095667012,
    0.045283224,
    0.012311243,
    -0.03768627,
    -0.007999036,
    0.02557146,
    -0.010872412,
    -0.001391444,
    -0.015947269,
    -0.019246962,
    0.038543444,
    -0.001259266,
    0.015128694,
    -0.029774111,
    -0.03450853,
    -0.002379081,
    0.058572438,
    0.026642675,
    0.025649073,
    0.037477504,
    0.029505087,
    -0.013224045,
    -0.017260147,
    0.026381291,
    0.043141443,
    0.003738959,
    0.022940179,
    -0.052366804,
    -0.023249818,
    -0.004323089,
    -0.032610927,
    -0.011929882,
    -0.01870456,
    0.056602154,
    -0.031775955,
    0.053303014,
    0.020245243,
    0.023801522,
    -0.017324351,
    -0.015366206,
    -0.035267048,
    0.0482122,
    0.027894007,
    0.02303854,
    0.003329923,
    0.002482374,
    -0.044377893,
    -0.047048703,
    0.00022083,
    0.050240722,
    0.017402656,
    0.021342773,
    0.024346953,
    0.034143291,
    -0.03820568,
    0.003675807,
    -0.026002498,
    -0.068832949,
    0.002120706,
    0.036213785,
    -0.012805196,
    0.059129599,
    -0.045461249,
    -0.021616379,
    -0.02025055,
    -0.023086576,
    0.020920921,
    0.010085833,
    -0.014934801,
    0.028281424,
    -0.065523036,
    0.009180604,
    -0.000909933,
    -0.068336375,
    -0.022076994,
    0.042379785,
    -0.048882861,
    -0.02210854,
    0.046920925,
    -0.020762499,
    0.057692632,
    -0.014510091,
    0.022431534,
    -0.025081282,
    0.036488414,
    -0.032119215,
    -0.005218579,
    -0.005410343,
    -0.030822663,
    0.023637298,
    -0.038797613,
    0.078469262,
    -0.032970302,
    -0.008330496,
    -0.012661785,
    -0.012807158,
    0.039562982,
    -0.013920601,
    -0.050101917,
    0.005930717,
    -0.017189011,
    -0.029432286,
    0.043151606,
    -0.009610625,
    0.023656862,
    -0.016861113,
    0.031240487,
    0.024503279,
    0.048447151,
    -0.047637433,
    -0.013673274,
    -0.0178256,
    -0.013409378,
    -0.021501811,
    0.049964108,
    -0.008032502,
    0.002776061,
    -0.073564075,
    -0.032852132,
    -0.032240096,
    0.006015405,
    -0.009664965,
    0.014621915,
    0.033575151,
    0.003185735,
    -0.017967923,
    -0.017363681,
    -0.000340713,
    0.005443321,
    0.014492805,
    0.018042944,
    -0.009161368,
    -0.025670111,
    0.005975209,
    0.033891685,
    -0.018863237,
    0.051919308,
    -0.022498224,
    0.051248595,
    0.024877064,
    0.021446282,
    -0.025905643,
    -0.024377882,
    0.003806172,
    0.043800227,
    0.010111113,
    -0.037140932,
    0.022112446,
    0.003051376,
    0.025588527,
    -0.08584214,
    0.018799582,
    0.021956384,
    0.015584134,
    0.039195675,
    0.001671573,
    0.034618437,
    -0.01540247,
    0.042353895,
    -0.020269835,
    0.014419419,
    -0.051905178,
    0.052666992,
    -0.035496611,
    -0.004692146,
    0.027347719,
    -0.012100101,
    -0.019732701,
    -0.02512159,
    0.006650577,
    -0.004893195,
    -0.03781046,
    0.022477115,
    0.011715152,
    -0.081725299,
    -0.038169965,
    0.00190342,
    0.007581276,
    0.01216659,
    -0.035364684,
    0.007342455,
    0.031536918,
    -0.045687985,
    0.033866648,
    -0.00427726,
    -0.048759528,
    -0.012902937,
    0.03092772,
    -0.013027901,
    0.022329142,
    -0.02640119,
    -0.008808752,
    -0.027366329,
    0.012634527,
    0.040931027,
    -0.061665211,
    -0.039490037,
    -0.071769044,
    -0.021322602,
    -0.032438748,
    0.014155122,
    0.067730978,
    -0.032253861,
    -0.008120246,
    0.02654714,
    0.007176396,
    -0.030082218,
    -0.049646817,
    -0.032353308,
    0.002173844,
    0.003805406,
    -0.001158549,
    0.043247133,
    0.040563624,
    -0.045234334,
    -0.014125903,
    0.010828586,
    0.035533007,
    -0.050257217,
    0.014119064,
    0.000459801,
    0.045153245,
    0.033452302,
    0.017782731,
    0.046956081,
    -0.011938644,
    -0.041720986,
    -0.014696619,
    -0.061896563,
    -0.025490418,
    -0.053517535,
    0.010824738,
    -0.0117651,
    -0.032291632,
    0.039874356,
    0.010664995,
    -0.022786522,
    -0.011455981,
    -0.02184801,
    -0.006517023,
    0.008045388,
    0.030101683,
    0.011052356,
    0.00013892,
    -0.045307931,
    -0.021046624,
    0.042028587,
    0.025482047,
    -0.063923441,
    0.002011225,
    -0.030592762,
    -0.032335564,
    0.050550804,
    0.015816366,
    -0.013149424,
    -0.07854782,
    0.027390338,
    -0.006613466,
    -0.000698005,
    -0.01123467,
    0.021027161,
    0.043771803,
    -0.053184282,
    -0.026677459,
    0.047113609,
    -0.00316845,
    -0.018712273,
    0.031853408,
    -0.002475355,
    -0.039802764,
    -0.04263977,
    0.001011882,
    -0.002876904,
    0.01144023,
    0.011890301,
    0.010117516,
    -0.011640281,
    -0.00082386,
    0.034288637,
    -0.015638176,
    -0.032013804,
    0.030969793,
    -0.012843775,
    0.00238965,
    0.004631246,
    0.009456626,
    -0.014677484,
    -0.037336424,
    -0.009597513,
    -0.007494004,
    -0.07198786,
    0.038933549,
    0.017549526,
    0.00230521,
    0.021525891,
    -0.003838798,
    -0.001361358,
    -0.010293287,
    0.043540232,
    0.045247477,
    0.093159579,
    -0.041064594,
    0.073032536,
    0.025312154,
    -0.016532095,
    0.038392626,
    -0.021498615,
    0.017231775,
    -0.000934462,
    -0.002485048,
    0.020924615,
    -0.0448457,
    0.015837533,
    0.040454872,
    0.005799263,
    -0.0108967,
    -0.020683225,
    -0.005064453,
    -0.029105859,
    0.004089315,
    0.007513149,
    -0.037161246,
    0.030419366,
    0.021113453,
    -0.05137321,
    0.007307213,
    0.021227442,
    0.003557219,
    -0.016783491,
    0.016309386,
    0.004497844,
    0.000717365,
    -0.070726819,
    0.002263469,
    -0.0114419,
    -0.036442399,
    -0.008796429,
    0.043629944,
    -0.018847909,
    0.026717475,
    -0.024443852,
    0.053884119,
    0.003880217,
    -0.013134711,
    -0.012629244,
    -0.009275245,
    -0.041304436,
    -0.001923465,
    0.023342166,
    0.038026311,
    0.00475539,
    -0.005199093,
    -0.019208286,
    0.031063925,
    -0.013848895,
    0.071516372,
    0.049826048,
    -0.000342396,
    0.015724596,
    0.06583555,
    -0.00014392,
    0.026971042,
    0.034696206,
    -0.013003758,
    -0.059219141,
    0.019086927,
    0.016232075,
    0.024351228,
    -0.044895768,
    -0.017540937,
    -0.00689656,
    0.00030388,
    -0.033406224,
    0.045456748,
    -0.013429692,
    0.019357283,
    0.004979048,
    -0.008780778,
    0.032940753,
    -0.061022453,
    0.01320734,
    0.016962947,
    0.008386821,
    0.027325615,
    0.00370755,
    -0.008507784,
    0.014020965,
    -0.011810656,
    -0.010315474,
    0.015814343,
    0.008881188,
    0.070125781,
    0.042326331,
    0.049833599,
    -0.061170731,
    -0.000567474,
    0.015181486,
    0.018740477,
    0.01383851,
    0.103675082,
    0.040769063,
    0.022563137,
    -0.005362494,
    -0.000113673,
    -0.013412073,
    -0.017678604,
    -0.005331205,
    -0.005070086,
    -0.014798279,
    -0.011680727,
    0.018725563,
    0.040167339,
    -0.010972831,
    -0.012281992,
    0.01626757,
    -0.019387031,
    -0.030605217,
    -0.027798489,
    0.001699683,
    -0.051410425,
    -0.013950149,
    0.005238159,
    0.001822602,
    -0.005404324,
    0.011175235,
    -0.001307231,
    0.013836491,
    0.008014171,
    0.081064992,
    -0.008225752,
    -0.019288272,
    -0.058419157,
    0.000464896,
    -0.014839511,
    0.015667185,
    0.003690722,
    0.000137291,
    -0.009174952,
    -0.030902863,
    0.07991983,
    -0.013397912,
    0.013976167,
    0.019426184,
    0.03495482,
    -0.015625682,
    -0.035882689,
    -0.031867042,
    -0.021183565,
    0.060545284,
    -0.004063416,
    0.000814451,
    0.004516126,
    -0.033355314,
    0.00357067,
    -0.023893805,
    0.067100815,
    -0.011484621,
    0.000155767,
    -0.02213251,
    0.007085454,
    0.003363725,
    0.00303328,
    -0.009358145,
    -0.026649687,
    -0.058475986,
    -0.010378254,
    0.026381467,
    0.042110123,
    -0.023239302,
    -0.059868682,
    0.000933492,
    0.011386794,
    0.000437322,
    -0.002603561,
    -0.001780085,
    0.049347881,
    -0.008628544,
    -0.031542338,
    0.014911657,
    0.029293787,
    0.023454016,
    -0.07708548,
    0.007271217,
    -0.048650298,
    0.022433307,
    -0.043463405,
    -0.015847782,
    0.030757137,
    0.018338261,
    -0.017452514,
    0.013282496,
    0.002989026,
    -0.008066607,
    -0.014111682,
    0.017586598,
    -0.007713031,
    -0.057108797,
    -0.042087484,
    0.024074698,
    0.00730723,
    -0.002745345,
    0.032018129,
    -0.015995078,
    -0.037780564,
    0.051014017,
    -0.012195944,
    0.026114004,
    -0.038505636,
    0.037841558,
    0.006313714,
    -0.075913377,
    -0.037212223,
    -0.037864693,
    -0.004756839,
    0.006485176,
    -0.057108846,
    -0.005339275,
    -0.050892834,
    -0.013567226,
    -0.015383211,
    0.033652335,
    -0.019580213,
    -0.046827283,
    0.037821434,
    0.003403712,
    -0.044914261,
    -0.013990097,
    -0.012730097,
    -0.012692091,
    0.029749447,
    -0.033302929,
    -0.039103482,
    -0.000618092,
    0.018415729,
    0.044168036,
    -0.044332109,
    -0.03306035,
    0.050208978,
    -0.004189762,
    -0.003607192,
    0.030277709,
    0.014141128,
    -0.001954515,
    -0.049902886,
    -0.020397445,
    0.016560296,
    0.004354997,
    -0.05438447,
    0.027623141,
    0.008494617,
    0.043526534,
    -0.032927278,
    -0.01088274,
    0.046290871,
    0.014657007,
    0.025528815,
    0.016012203,
    0.010359745,
    -0.005059236,
    -0.056726087,
    -0.008809077,
    0.024726316,
    0.006969363,
    -0.054624584,
    0.022303918,
    -0.003137668,
    -0.007467758,
    0.029278498,
    0.029116569,
    0.02073781,
    0.022215229,
    -0.01333108,
    -0.016417526,
    -0.026725706,
    0.007118724,
    0.00148448,
    -0.01072002,
    -0.052434266,
    0.029158119,
    -0.007232467,
    -0.009317243,
    0.063414529,
    -0.001794335,
    -0.019062018,
    0.039306093,
    0.015200429,
    -0.032605916,
    -0.021335736,
    0.002179008,
    0.030769955,
    0.003140321,
    -0.020984085,
    -0.073834732,
    -0.009642828,
    0.005900187,
    -0.038986981,
    0.031650301,
    -0.015287532,
    -0.025438013,
    -0.01904765,
    0.002959238,
    -0.001102148,
    0.058036953,
    -0.00412424,
    0.017021792,
    -0.053797696,
    -0.017585723,
    0.064317867,
    0.050571121,
    0.012902688,
    -0.010886465,
    -0.030801756,
    -0.042381007,
    -0.007049396,
    -0.002155446,
    -0.028677085,
    -0.024275159,
    -0.019621441,
    0.038369354,
    -0.051838469,
    -0.013590901,
    0.030427655,
    0.022913003,
    0.038222045,
    -0.014705209,
    -0.027977489,
    0.035842586,
    0.004182228,
    0.012013569,
    0.018671196,
    0.0087484,
    0.021866148,
    -0.031099867,
    -0.034749493,
    -0.013399558,
    -0.034823593,
    0.011072867,
    -0.045814633,
    -0.013877065,
    -0.009356985,
    0.048580267,
    0.01232291,
    0.0546543,
    0.014527845,
    0.0107262,
    -0.00344314,
    0.008438823,
    -0.00700074,
    0.043418098,
    -0.033674296,
    0.048946999,
    0.041488435,
    0.0138683,
    -0.019412268,
    0.029066868,
    0.011632665,
    0.049540468,
    0.004000141,
    -0.025364324,
    -0.012961225,
    -0.031252231,
    -0.004443458,
    -0.016823104,
    0.04630797,
    0.040762659,
    0.000246622,
    -0.028440664,
    -0.008637103,
    -0.014521264,
    -0.004707878,
    0.023415403,
    0.025461353,
    -0.006659845,
    -0.050580494,
    -0.00726755,
    -0.042813327,
    0.011575745,
    -0.027350321,
    -0.006939767,
    -0.021270519,
    0.006517719,
    0.013109895,
    -0.018664744,
    -0.006509068,
    0.041544504,
    0.023003465,
    -0.032261577,
    0.010565802,
    -0.022618083,
    -0.021071097,
    0.003116331,
    -0.055740841,
    -0.021711739,
    -0.021902265,
    0.030311797,
    0.016502533,
    -0.041254167,
    -0.006029337,
    -0.011640855,
    0.016674679,
    0.037474833,
    0.026019664,
    0.007259335,
    -0.028841177,
    -0.013642176,
    -0.030102815,
    -0.019304845,
    0.003150857,
    0.003573313,
    0.031376731,
    0.020654906,
    0.040612154,
    0.008501867,
    0.043234348,
    0.052180938,
    0.028309997,
    0.020707719,
    0.015625618,
    -0.038369305,
    -0.045378208,
    -0.023532731,
    -0.018855691,
    -0.011107144,
    0.029485822,
    0.004787006,
    -0.022607939,
    -0.003154087,
    0.080284804,
    0.013360013,
    0.042855967,
    -0.015045762,
    0.011705512,
    -0.035631705,
    -0.053510059,
    0.028831653,
    -0.037214268,
    -0.005378796,
    -0.001809144,
    0.020501293,
    0.014081956,
    0.014502336,
    -0.012194295,
    0.013629668,
    -0.041331701,
    -0.040763013,
    0.004271013,
    -0.007255054,
    0.010770914,
    0.005482388,
    0.016453773,
    -0.021368671,
    0.00405945,
    -0.048956174,
    0.029979605,
    0.002816545,
    0.035921432,
    0.03446766,
    0.020220593,
    0.042002432,
    0.038132768,
    0.030151386,
    -0.006527028,
    0.03292748,
    0.040657766,
    -0.02454358,
    0.035848275,
    0.025279006,
    0.01634427,
    -0.032910954,
    0.031238345,
    -0.04669635
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs",
    "chunk_index": 6,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "ionToken).ConfigureAwait(false);\n                 }\n                 \n+                // Check cancellation before processing large data\n+                cancellationToken.ThrowIfCancellationRequested();\n+                \n                 var newContent = currentContent.Concat(new[] { obj }).ToArray();\n                 \n-                // Write new version asynchronously\n+                // Write new version asynchronously with cancellation support\n                 await WritePageVersionAsync(transactionId, namespaceName, pageId, newContent, cancellationToken).ConfigureAwait(false);\n                 \n                 // Track in transaction\n                 transaction.WrittenPages[fullPageId] = transactionId;\n                 \n                 return pageId;\n             }, cancellationToken).ConfigureAwait(false);\n         }\n+        catch (TaskCanceledException ex) when (ex.CancellationToken == cancellationToken)\n+        {\n+            // Convert TaskCanceledException to OperationCanceledException for consistent exception handling\n+            throw new OperationCanceledException(\"Operation was cancelled during large data processing in InsertObjectAsync\", ex, cancellationToken);\n+        }\n         finally\n         {\n             DecrementNamespaceOperations(namespaceName);\n         }\n     }\n@@ -406,16 +552,27 @@ public class AsyncStorageSubsystem : StorageSubsystem, IAsyncStorageSubsystem\n         ValidateNamespace(namespaceName);\n         \n         var transaction = _activeTransactions[transactionId];\n         var fullPageId = $\"{namespaceName}:{pageId}\";\n         \n-        // CRITICAL: Enforce read-before-write rule for ACID isolation\n+        // CRITICAL MVCC FIX: Enforce read-before-write for ACID isolation compliance\n+        // This is a fundamental MVCC requirement to prevent lost updates and ensure proper transaction isolation.\n+        // The test MVCCIsolationTests.UpdatePage_WithoutPriorRead_ShouldThrowReadBeforeWriteViolation expects this.\n+        // \n+        // However, we need to allow legitimate cases where a page was read in the same transaction.\n+        // If the transaction has already recorded reading this page, allow the update.\n+        // This supports both:\n+        // 1. MVCC isolation requirements (direct UpdatePage calls must have prior reads)  \n+        // 2. Table layer operations (which read pages internally before updates)\n+        \n         if (!transaction.ReadVersions.ContainsKey(fullPageId))\n         {\n             throw new InvalidOperationException(\n-                $\"Cannot update page '{pageId}' in namespace '{namespaceName}' without reading it first \" +\n-                $\"in transaction {transactionId}. ACID isolation requires read-before-write for updates.\");\n+                $\"MVCC ACID isolation violation: Cannot update page '{pageId}' in namespace '{namespaceName}' \" +\n+                $\"without a prior read-before-write in the same transaction. \" +\n+                $\"This violates ACID isolation guarantees and could lead to lost updates. \" +\n+                $\"Read the page first using ReadPageAsync() or GetMatchingObjectsAsync() before updating.\");\n         }\n         \n         await Task.Run(() =>\n         {\n             cancellationToken.ThrowIfCancellationRequested();\n@@ -458,10 +615,16 @@ public class AsyncStorageSubsystem : StorageSubsystem, IAsyncStorageSubsystem\n                 CreatedByTransaction = transactionId \n             });\n             \n             await File.WriteAllTextAsync(markerFile, markerContent, cancellationToken).ConfigureAwait(false);\n             \n+            // CRITICAL SECURITY FIX: Track namespace marker file in transaction for isolation-safe critical flushing\n+            if (_activeTransactions.TryGetValue(transactionId, out var transaction))\n+            {\n+                transaction.WrittenFilePaths.Add(markerFile);\n+            }\n+            \n             if (_config.EnableBatchFlushing && _batchFlushCoordinator != null)\n             {\n                 await _batchFlushCoordinator.QueueFlushAsync(markerFile, FlushPriority.Norma"
}