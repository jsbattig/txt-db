{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs:2",
  "vector": [
    0.021930587,
    -0.007082181,
    0.006174767,
    0.010867157,
    -0.015509087,
    -0.006765184,
    -0.017236831,
    -0.043016136,
    0.040646762,
    0.01212167,
    0.043233845,
    -0.005447926,
    0.073481396,
    -0.003147947,
    -0.055915914,
    -0.03184234,
    0.028265681,
    -0.010763985,
    -0.032722015,
    0.018327827,
    -0.034678787,
    -0.03074521,
    -0.057475664,
    0.075259134,
    -0.040487371,
    0.021424411,
    0.035183635,
    0.043958828,
    0.018409381,
    0.055523086,
    -0.014564676,
    -0.070588864,
    0.003685043,
    0.019592656,
    0.03147481,
    -0.012050034,
    -0.029937148,
    -0.001595372,
    0.00040123,
    0.000168868,
    0.037558656,
    -0.021311466,
    0.055035233,
    -0.013478739,
    0.012401358,
    -0.065978184,
    0.009724763,
    0.006744153,
    0.008174038,
    -0.01086591,
    -0.010916675,
    -0.011456244,
    -0.016947092,
    0.044393163,
    0.001803444,
    -0.049565345,
    0.081966564,
    0.007417114,
    -0.053769492,
    0.068864018,
    -0.020645,
    0.013961109,
    0.020289725,
    0.049659193,
    -0.024174031,
    -0.027144607,
    -0.060325399,
    0.05644976,
    0.005688944,
    -0.07902582,
    0.017421992,
    0.016176846,
    0.018097822,
    0.022249708,
    0.006449517,
    0.013838065,
    0.027541246,
    0.004223078,
    0.047204386,
    0.013264042,
    -0.046942346,
    -0.062790439,
    -0.012462173,
    -0.020096501,
    0.022364007,
    -0.05018295,
    0.025146084,
    -0.068174422,
    0.013912183,
    0.010705762,
    -0.028236058,
    0.034052726,
    0.035022531,
    0.006762085,
    0.01975156,
    0.034237489,
    0.034022685,
    0.020312766,
    0.029164052,
    -0.010334043,
    -0.012174724,
    0.001544674,
    -0.019147029,
    0.067171387,
    -0.050294936,
    0.004422719,
    0.013144949,
    -0.04782863,
    0.018582659,
    0.023584027,
    0.038265709,
    0.007800319,
    0.01772598,
    -0.003981291,
    0.031144273,
    -0.006255625,
    -0.019853203,
    -0.026372084,
    0.003709116,
    0.035209458,
    -0.017856278,
    0.031942327,
    -0.071916811,
    0.055783473,
    -0.033976767,
    0.039123315,
    0.030068282,
    0.008593667,
    0.002882054,
    -0.029889064,
    -0.000992032,
    -0.043408621,
    -0.008814529,
    0.011403204,
    -0.002314596,
    0.028897332,
    0.036849506,
    0.017920107,
    -0.002441955,
    -0.038461845,
    0.010240422,
    0.000631818,
    -0.008923451,
    0.014832751,
    -0.007155816,
    -0.004768169,
    0.031726427,
    0.009614933,
    0.026288349,
    -0.060456783,
    -0.006469041,
    0.059994586,
    -0.04657764,
    0.013073304,
    0.014649321,
    0.03293854,
    -0.031461559,
    -0.041067909,
    -0.004275692,
    -0.017281678,
    -0.039705954,
    0.026808929,
    -0.008025817,
    0.033031266,
    -0.031278584,
    0.020071484,
    0.010314913,
    0.012024333,
    0.032425966,
    -0.021576621,
    -0.063423872,
    0.020640844,
    -0.034170222,
    -0.025368981,
    -0.048829973,
    0.018510705,
    0.017125709,
    0.007439832,
    -0.069109179,
    -0.04054426,
    -0.005933524,
    -0.009912189,
    -0.007213094,
    -0.011654509,
    -0.001948908,
    -0.000252714,
    0.050699823,
    0.013861489,
    0.023249784,
    0.015431056,
    -0.033395968,
    -0.016550383,
    -0.017456738,
    -0.010270035,
    0.007846485,
    -0.017795589,
    -0.020241249,
    0.012011275,
    0.01114192,
    0.050369218,
    -0.046387441,
    0.036347434,
    -0.093018442,
    -0.023080993,
    0.01596217,
    -0.01389665,
    -0.020580757,
    -0.007429881,
    0.009515576,
    0.001994778,
    -0.014840359,
    0.000527804,
    0.019108854,
    -0.018475018,
    0.013793666,
    -0.009643376,
    -0.035745844,
    -0.003765241,
    0.052110095,
    -0.006405546,
    -0.002258629,
    -0.023353383,
    0.080446571,
    0.046272997,
    -0.020036997,
    -0.027643811,
    -0.032499287,
    -0.062610209,
    -0.036994103,
    -0.01639908,
    -0.001875537,
    -0.07111524,
    0.027570071,
    -0.03911645,
    -0.039761331,
    0.074298993,
    -0.003450882,
    -0.023737816,
    0.005573094,
    -0.021576161,
    -0.020299179,
    0.046838522,
    -0.002540189,
    0.03186933,
    -0.004924561,
    0.006964784,
    0.074985303,
    0.017931061,
    0.00501446,
    -0.001497704,
    -0.030403387,
    0.039974924,
    -0.014940775,
    0.112689801,
    0.058852162,
    0.012754252,
    -0.009795983,
    0.029907433,
    0.007378872,
    0.020533832,
    0.026859296,
    -0.005885905,
    -0.007905248,
    0.03519183,
    -0.009524412,
    0.029548893,
    -0.029565951,
    -0.044375632,
    0.004356334,
    0.038882021,
    0.023804158,
    0.020090634,
    0.066004053,
    0.026659828,
    -0.009817461,
    -0.03797004,
    0.015079027,
    0.035431378,
    -0.001643655,
    0.028066618,
    -0.043171078,
    -0.016775055,
    0.013250206,
    -0.00674856,
    -0.020126505,
    -0.047651909,
    0.011942498,
    -0.009415749,
    0.027017411,
    0.003026716,
    0.019459436,
    -0.018098662,
    -0.008454186,
    -0.036284372,
    0.037677668,
    0.033511605,
    0.029129498,
    -0.023906153,
    0.020819157,
    -0.033253465,
    -0.025970869,
    0.009414142,
    0.053911414,
    0.032791391,
    -0.009348424,
    -0.001857537,
    0.01795437,
    0.007002012,
    0.025772117,
    -0.014710295,
    -0.070025206,
    -0.010483299,
    0.003201465,
    -0.002608937,
    0.031529073,
    -0.071660943,
    -0.026883837,
    0.017053146,
    -0.022767302,
    -0.003104122,
    0.012877339,
    -0.02155243,
    0.025235474,
    -0.031682096,
    0.009768735,
    0.015061501,
    -0.060490403,
    -0.033317115,
    0.047044352,
    -0.018967271,
    -0.024814595,
    0.033133339,
    0.010988003,
    0.048270524,
    -0.005171024,
    0.02540026,
    -0.03443772,
    -0.00530191,
    -0.059510678,
    0.019482993,
    -0.01052521,
    -0.025596954,
    0.041121691,
    -0.038588289,
    0.061858766,
    -0.021567862,
    -0.008388542,
    -0.009687187,
    -0.000279889,
    0.043705557,
    0.012458231,
    -0.041186545,
    -0.002105134,
    -0.008700295,
    -0.037940189,
    0.044645663,
    -0.027539808,
    0.012783519,
    -0.038397122,
    0.030085079,
    0.031499188,
    0.032548934,
    -0.07276962,
    -0.035461109,
    -0.003545054,
    0.005968138,
    -0.023816196,
    0.07950177,
    -0.040761221,
    0.03839127,
    -0.075807825,
    -0.049267065,
    -0.029327746,
    0.016138135,
    0.010647005,
    0.024058597,
    0.018889697,
    -0.012977443,
    -0.033738889,
    -0.02277129,
    0.023944942,
    0.01566215,
    0.009718775,
    -0.013241651,
    -0.022766769,
    -0.005163983,
    0.035876624,
    0.035834558,
    -0.018546119,
    0.03867434,
    0.004037579,
    0.031565726,
    0.024087342,
    -0.008151442,
    -0.019870469,
    -0.048325863,
    -0.018434778,
    0.048119627,
    0.028753679,
    -0.039034747,
    0.012189883,
    -0.003478855,
    0.033151299,
    -0.046807695,
    0.042267151,
    0.008561632,
    0.024612356,
    0.039115421,
    -0.009279389,
    0.040117059,
    -0.003261765,
    0.02916448,
    -0.01444766,
    0.032137126,
    -0.039807554,
    0.042619973,
    -0.010952795,
    -0.02314247,
    0.025888696,
    -0.007635937,
    -0.019748656,
    -0.014874464,
    0.010847452,
    -0.006617558,
    -0.0200259,
    0.030727956,
    0.007491003,
    -0.086731434,
    -0.018200343,
    -0.001772634,
    -0.000553775,
    -0.017801141,
    -0.05740032,
    -0.009378945,
    0.045644619,
    -0.057950921,
    0.028628431,
    -0.044028971,
    -0.052409366,
    -0.021934813,
    -0.005035956,
    -0.026184332,
    0.042036012,
    -0.026838699,
    0.004157352,
    -0.031753145,
    0.014269087,
    0.055682547,
    -0.025329027,
    -0.023521915,
    -0.052261602,
    0.006356193,
    -0.022810651,
    0.001522427,
    0.057937596,
    -0.045786731,
    -0.021573192,
    0.047061514,
    -0.014227191,
    -0.039238703,
    -0.042939745,
    -0.014565702,
    -0.016893506,
    0.024191434,
    -0.014389439,
    0.031907197,
    0.046055481,
    -0.067078352,
    -0.029769385,
    0.020993531,
    0.036839169,
    -0.016311137,
    0.00875853,
    0.011261462,
    0.030801168,
    0.025610344,
    -0.032120761,
    0.054834116,
    -0.054152392,
    -0.04138064,
    -0.02529956,
    -0.03971171,
    -0.021556577,
    -0.033467691,
    -0.008923666,
    0.028153611,
    -0.032678947,
    0.030663323,
    0.023813091,
    -0.031756584,
    0.000916961,
    -0.003928836,
    -0.001525644,
    -0.011933232,
    0.01539667,
    -0.003874939,
    -0.017173335,
    -0.021590777,
    -0.031295616,
    0.035216443,
    0.042695597,
    -0.089099303,
    0.014605678,
    -0.028946282,
    -0.00595679,
    0.027422702,
    0.015271243,
    -0.019578528,
    -0.080571532,
    0.038730264,
    -0.019165261,
    -0.018661667,
    0.009000533,
    0.042749856,
    0.028766813,
    -0.038069896,
    -0.014190096,
    0.018405309,
    0.007235706,
    0.024989845,
    0.015687941,
    0.028334292,
    -0.021800123,
    -0.048949521,
    -0.018955937,
    0.00315652,
    0.002437682,
    0.007925002,
    0.014615695,
    -0.033209071,
    -0.017552283,
    0.016017741,
    -0.022336941,
    -0.031955075,
    0.023053449,
    -0.010916929,
    0.034501113,
    -0.001179157,
    0.01821832,
    -0.033068061,
    -0.036817249,
    -0.004588088,
    -0.049290914,
    -0.036254477,
    0.038281851,
    -0.004629883,
    -0.004595899,
    -0.008505057,
    -0.005314502,
    -0.005312716,
    -0.003240837,
    0.034715213,
    0.030665001,
    0.07548105,
    -0.026915051,
    0.04935614,
    0.029774573,
    -0.018238468,
    0.044946536,
    -0.014879356,
    0.025316311,
    0.037372071,
    0.011849138,
    0.050086539,
    -0.01572266,
    0.030037576,
    0.05407932,
    0.006734521,
    -0.026114477,
    -0.038068611,
    -0.009647853,
    -0.010136226,
    -0.006298258,
    0.015715241,
    -0.006721522,
    0.042855907,
    0.046664376,
    -0.050367087,
    -0.028530484,
    -0.00849943,
    -0.008661121,
    -0.007512252,
    6.4407e-05,
    0.019464064,
    -0.01444907,
    -0.053898297,
    0.021099027,
    -0.018716663,
    -0.052710842,
    -0.023627158,
    0.010229245,
    -0.023282845,
    0.015979948,
    -0.026199942,
    0.040542435,
    -0.012080133,
    -0.014619964,
    -0.010756141,
    -0.018929562,
    -0.024478441,
    -0.005071852,
    0.01201266,
    0.037629288,
    0.009173053,
    0.006921542,
    -0.025005501,
    0.027358953,
    -0.005045878,
    0.067038201,
    0.048825361,
    0.002083293,
    0.001303975,
    0.071074955,
    -0.023055172,
    0.01500978,
    0.054130819,
    0.019691223,
    -0.079396226,
    0.010286141,
    0.033672448,
    0.019919902,
    -0.03004095,
    -0.036776587,
    0.008935797,
    0.005988606,
    -0.018012654,
    0.018225012,
    -0.041468509,
    0.00309365,
    0.010868241,
    -0.004152173,
    0.055962469,
    -0.047732484,
    0.029181199,
    0.026258148,
    0.026174622,
    0.026365362,
    -0.008060763,
    0.004372159,
    0.01912754,
    -0.006479943,
    -0.01716285,
    0.029917572,
    0.053192038,
    0.025645278,
    0.042046212,
    0.021766363,
    -0.056025553,
    -0.039520867,
    0.045611404,
    0.003142657,
    0.029708978,
    0.077082373,
    0.053715359,
    0.051374655,
    0.030366043,
    0.025325399,
    -0.014164419,
    -0.02427613,
    0.003262008,
    -0.003102032,
    -0.028710134,
    -0.031363122,
    0.049123377,
    0.036620148,
    -0.046184588,
    -0.013944007,
    0.046204451,
    -0.025786655,
    -0.018518882,
    -0.029998938,
    0.029397814,
    -0.026387976,
    -0.017798916,
    -0.003172159,
    5.8629e-05,
    -0.013322851,
    0.004565774,
    -0.004700277,
    -0.003877517,
    0.014475379,
    0.070524774,
    -0.001733881,
    -0.004894079,
    -0.078591868,
    0.012569586,
    -0.022406828,
    0.029150041,
    -0.018449424,
    0.01736496,
    -0.006032005,
    -0.00879292,
    0.087763533,
    -0.025907295,
    -0.005854511,
    0.00623637,
    0.017236887,
    -0.006261684,
    -0.051023379,
    -0.05156745,
    -0.007079255,
    0.04986861,
    -0.003834935,
    0.013649527,
    -0.002717659,
    -0.035366155,
    -0.006269823,
    -0.011566631,
    0.054933488,
    0.015412193,
    0.008255156,
    -0.023276553,
    0.007136589,
    0.033279922,
    -0.001245602,
    0.011085854,
    -0.018309895,
    -0.041948203,
    -0.007796725,
    0.029642364,
    0.038915988,
    -0.036771685,
    -0.041401118,
    -0.012423124,
    -0.017866334,
    0.002287351,
    -0.011997991,
    0.012507071,
    0.077993311,
    -0.024915401,
    -0.026556944,
    0.007307001,
    0.022693293,
    0.048124995,
    -0.066940419,
    -0.003804793,
    -0.045945752,
    0.037280772,
    -0.028304502,
    -0.01851722,
    0.013003284,
    0.005327391,
    -0.044326033,
    0.000131264,
    0.003332604,
    0.00140777,
    -0.007912559,
    0.016780477,
    -0.001695601,
    -0.070908807,
    -0.014444576,
    -0.003377885,
    0.012825401,
    0.016078351,
    0.026337586,
    -0.026775926,
    -0.045276236,
    0.04865342,
    -0.019246571,
    0.023668977,
    -0.028845826,
    0.024079507,
    0.00435657,
    -0.044121847,
    -0.026808862,
    -0.029462546,
    -0.008795443,
    0.011857539,
    -0.085536078,
    -0.001608338,
    -0.025745237,
    0.017057195,
    -0.035732396,
    0.019811286,
    -0.040558055,
    -0.035935372,
    0.037324019,
    0.008379683,
    -0.031141117,
    0.018376151,
    0.007157859,
    0.013486919,
    0.014019253,
    -0.024699278,
    -0.037359267,
    -0.018536581,
    0.033427034,
    0.035719506,
    -0.025016515,
    -0.061709002,
    0.03187111,
    -0.009352724,
    -0.031156503,
    0.033186864,
    0.034755014,
    0.006895195,
    -0.041623902,
    -0.012448496,
    0.007252346,
    -0.018662635,
    -0.05446256,
    0.059203766,
    0.03820736,
    0.036798801,
    -0.024021633,
    0.000623534,
    0.05109046,
    0.005184618,
    0.029578989,
    0.031957414,
    0.003674462,
    -0.026473846,
    -0.023020335,
    -0.005480626,
    0.050368607,
    -0.016670387,
    -0.084220879,
    0.029563185,
    0.007072282,
    -0.01606825,
    0.036994983,
    0.036252651,
    0.000158551,
    0.024862144,
    -0.010433719,
    -0.006361854,
    -0.001346159,
    -0.006314091,
    -0.012247428,
    0.002851749,
    -0.03361607,
    0.047295038,
    -0.002017954,
    -0.024711896,
    0.019529795,
    0.008267296,
    -0.018884523,
    0.048722919,
    -0.012727791,
    -0.033775806,
    0.013616355,
    0.005456805,
    0.005608308,
    0.024775643,
    -0.037734538,
    -0.070650265,
    -0.012694998,
    0.008018157,
    -0.036711164,
    0.009135586,
    0.008201017,
    -0.023718743,
    -0.001966365,
    0.000714864,
    -0.012257628,
    0.065597832,
    -0.006024585,
    0.033038024,
    -0.057451993,
    -0.031348635,
    0.070737042,
    -0.003440146,
    -0.010986249,
    -0.007514029,
    -0.024447249,
    -0.0256116,
    0.004645253,
    0.003085167,
    -0.056784142,
    -0.019961774,
    -0.008530005,
    0.023036458,
    -0.045594361,
    -0.024079595,
    0.038248066,
    -0.007527116,
    0.016205285,
    -0.002427635,
    -0.03379336,
    0.009337009,
    -0.009538403,
    -0.007449462,
    0.037468798,
    0.012525615,
    0.017770002,
    -0.0255877,
    -0.034433246,
    -0.029731035,
    -0.009104788,
    0.038858134,
    -0.042661045,
    -0.007181204,
    -0.019782975,
    0.046624094,
    0.023018626,
    0.021880958,
    0.004682129,
    -0.015683321,
    0.002739595,
    0.010928734,
    0.013853473,
    0.043144438,
    -0.02759918,
    0.05407897,
    0.036093049,
    0.006519742,
    -0.028258413,
    0.027054636,
    0.012195914,
    0.050367601,
    -0.000921232,
    -0.048864327,
    -0.008390951,
    -0.034480382,
    -0.037054628,
    0.008964547,
    0.026978888,
    0.060472094,
    0.029418226,
    -0.012847229,
    0.001697988,
    -0.019802844,
    -0.018951362,
    0.042680573,
    0.019267313,
    0.017880533,
    -0.065237306,
    -0.016096763,
    -0.045157053,
    0.018689301,
    -0.032607451,
    0.001512002,
    -0.031407855,
    0.012830501,
    0.00314103,
    -0.005361109,
    -0.008577483,
    0.055628903,
    0.02792941,
    -0.024585163,
    0.012846706,
    -0.016158946,
    -0.059238225,
    -0.007869323,
    -0.043892719,
    0.025699897,
    0.009787641,
    0.037783746,
    -0.01443588,
    -0.032695923,
    0.005643169,
    -0.005124089,
    0.023160102,
    0.019101968,
    0.021584185,
    0.019496299,
    -0.040455386,
    -0.023144817,
    -0.050347615,
    -0.040897805,
    0.004917134,
    0.000507736,
    0.030544262,
    0.016647549,
    0.017854957,
    0.006409472,
    0.055538721,
    0.05291938,
    0.012830627,
    0.045774866,
    0.007201453,
    -0.018534828,
    -0.025946105,
    -0.006358729,
    -0.021986201,
    -0.017480696,
    0.021103848,
    0.005864166,
    -0.033844236,
    0.016716551,
    0.041754089,
    -0.006034824,
    0.038094766,
    -0.018465972,
    0.00446579,
    -0.053517949,
    -0.027472517,
    0.031420894,
    -0.04360529,
    -0.028231775,
    -0.018282855,
    -0.005156748,
    0.003699586,
    0.019188279,
    -0.018005842,
    -0.002843906,
    -0.017587807,
    -0.035565015,
    0.00922576,
    -0.015419551,
    0.015661072,
    -0.024582028,
    0.017810717,
    0.003334079,
    0.00721831,
    -0.007924463,
    0.006209633,
    -0.006907403,
    0.056981105,
    0.036040027,
    0.002930855,
    0.03193913,
    0.023719955,
    0.030009769,
    -0.028048312,
    0.022549992,
    0.053701829,
    -0.027612822,
    0.023311429,
    -0.019396389,
    0.02695195,
    -0.049465299,
    0.030777909,
    -0.021147365
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/AsyncStorageSubsystem.cs",
    "chunk_index": 2,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "rement direct flush counter to track critical bypass usage\n+            lock (_flushCountLock)\n             {\n-                await PersistMetadataAsync(cancellationToken).ConfigureAwait(false);\n+                _flushOperationCount++;\n             }\n-        }, cancellationToken).ConfigureAwait(false);\n+        }\n+        else\n+        {\n+            // For normal operations, use Task.Run to avoid blocking calling thread\n+            await Task.Run(async () =>\n+            {\n+                cancellationToken.ThrowIfCancellationRequested();\n+                \n+                lock (_metadataLock)\n+                {\n+                    cancellationToken.ThrowIfCancellationRequested();\n+                    \n+                    // CRITICAL: Only check for conflicts if transaction wrote something\n+                    if (transaction.WrittenPages.Count > 0)\n+                    {\n+                        foreach (var (pageId, readVersion) in transaction.ReadVersions)\n+                        {\n+                            if (_metadata.PageVersions.TryGetValue(pageId, out var pageInfo))\n+                            {\n+                                if (pageInfo.CurrentVersion > readVersion)\n+                                {\n+                                    throw new InvalidOperationException(\n+                                        $\"Optimistic concurrency conflict: Page {pageId} was modified by another transaction. \" +\n+                                        $\"Read version: {readVersion}, Current version: {pageInfo.CurrentVersion}\");\n+                                }\n+                            }\n+                        }\n+                    }\n+\n+                    // Update current versions for written pages\n+                    foreach (var (pageId, version) in transaction.WrittenPages)\n+                    {\n+                        if (_metadata.PageVersions.TryGetValue(pageId, out var pageInfo))\n+                        {\n+                            pageInfo.CurrentVersion = version;\n+                        }\n+                    }\n+\n+                    // CRITICAL MVCC FIX: Advance CurrentTSN to this transaction's ID upon commit\n+                    // This makes the committed data visible to future transactions\n+                    _metadata.CurrentTSN = Math.Max(_metadata.CurrentTSN, transactionId);\n+\n+                    transaction.IsCommitted = true;\n+                    _metadata.RemoveActiveTransaction(transactionId);\n+                    _activeTransactions.TryRemove(transactionId, out _);\n+                }\n+                \n+                if (_config.EnableBatchFlushing && _batchFlushCoordinator != null)\n+                {\n+                    // Normal priority operations use batching for efficiency\n+                    var metadataFile = Path.Combine(_rootPath, $\".versions{_formatAdapter.FileExtension}\");\n+                    await _batchFlushCoordinator.QueueFlushAsync(metadataFile, flushPriority).ConfigureAwait(false);\n+                }\n+                else\n+                {\n+                    // Batching disabled - use direct flush for all operations\n+                    await PersistMetadataAsync(cancellationToken).ConfigureAwait(false);\n+                }\n+            }, cancellationToken).ConfigureAwait(false);\n+        }\n     }\n \n     public async Task RollbackTransactionAsync(long transactionId, CancellationToken cancellationToken = default)\n     {\n         cancellationToken.ThrowIfCancellationRequested();\n@@ -153,16 +240,19 @@ public class AsyncStorageSubsystem : StorageSubsystem, IAsyncStorageSubsystem\n                         pageInfo.RemoveVersion(version);\n                     }\n                     \n                     // Collect version files for deletion\n                     var namespacePath = GetNamespacePathFromPageId(pageId);\n-                    var versionFile = Path.Combine(namespacePath, $\"{GetPageFileNameFromPageId(pageId)}.v{transactionId}\");\n+                    var versionFile = Path.Combine(namespacePath, $\"{GetPageFileNameFromPageId(pageId)}{_formatAd"
}