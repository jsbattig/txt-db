{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage.Tests/Async/AsyncLockManagerTests.cs:2",
  "vector": [
    0.044889491,
    0.007278358,
    -0.012533346,
    0.032428075,
    -0.032284763,
    -0.013649143,
    -0.015544862,
    -0.009045225,
    0.040861409,
    0.007885824,
    -0.020552212,
    0.002393697,
    0.075593509,
    -0.035052381,
    -0.029320652,
    -0.042969033,
    0.074343152,
    0.048278432,
    -0.069137983,
    -0.002561025,
    -0.058634929,
    -0.004936897,
    -0.057823107,
    0.076098256,
    -0.036473326,
    0.003086693,
    0.020096349,
    0.030573988,
    -0.022807261,
    0.075756222,
    0.008317001,
    -0.03757618,
    0.000839231,
    0.026348976,
    0.05193717,
    -0.016397996,
    -0.038877461,
    -0.004834599,
    -0.01452009,
    -0.014929823,
    0.048352063,
    -0.00792453,
    0.071046978,
    -0.044637971,
    0.025594953,
    -0.05255568,
    0.036304213,
    0.031638138,
    0.025746496,
    0.007414361,
    -0.009891508,
    -0.017118478,
    -0.016106801,
    0.030130673,
    -0.010817167,
    -0.007164329,
    0.086329781,
    0.037440207,
    -0.076665714,
    0.017004063,
    -0.021013482,
    0.014757673,
    0.021915566,
    0.014263636,
    -0.026802255,
    -0.054160617,
    -0.023522433,
    0.062037185,
    -0.019874886,
    -0.04098304,
    0.0280731,
    0.027600551,
    0.009453041,
    0.026905615,
    -0.002096587,
    0.058774453,
    0.054415595,
    0.031524468,
    0.015666774,
    0.008841866,
    -0.044730961,
    -0.03153374,
    0.02746118,
    0.027226901,
    0.073806942,
    -0.035144769,
    0.022225017,
    -0.032348812,
    -0.001125047,
    0.017580634,
    -0.024268672,
    -0.013536423,
    0.009758215,
    0.031505629,
    0.006981102,
    0.001437524,
    0.01944023,
    0.028024124,
    0.010186968,
    -0.055293769,
    0.021370895,
    0.005204405,
    -0.039688379,
    0.02357571,
    -0.056795981,
    0.015545378,
    -0.025640465,
    -0.023252884,
    0.021079203,
    0.016764723,
    0.027513148,
    0.047249347,
    -0.001631391,
    0.043921169,
    0.01922996,
    -0.010937196,
    0.004418036,
    -0.03738679,
    0.001384475,
    0.020778034,
    0.00286351,
    0.033835266,
    -0.036692731,
    0.057955228,
    -0.038298924,
    0.061886113,
    0.023329211,
    0.029307481,
    -0.001011024,
    -0.006162588,
    0.047992311,
    -0.023673574,
    -0.008818864,
    0.014809923,
    0.007347887,
    0.043502148,
    0.047507431,
    0.04170173,
    0.012190404,
    -0.031138388,
    0.020695984,
    -0.023452258,
    0.01106522,
    0.002724043,
    -0.014714651,
    0.016292939,
    0.025375675,
    -0.001106863,
    0.011230593,
    -0.03919955,
    -0.00552328,
    0.046717022,
    -0.026002234,
    0.024252409,
    0.038354829,
    0.020851675,
    -0.047691084,
    -0.049204793,
    -0.028864728,
    -0.007139208,
    -0.043552633,
    0.029680075,
    0.024391579,
    0.01477586,
    -0.029680675,
    0.064641997,
    -0.000342375,
    -0.005526738,
    0.007686797,
    -0.037194304,
    -0.022831442,
    0.035176795,
    -0.034552544,
    -0.009545119,
    -0.007510003,
    0.038991071,
    5.1479e-05,
    0.016989304,
    -0.063294597,
    0.004252508,
    0.027320636,
    -0.020161916,
    -0.022537608,
    -0.039949477,
    -0.004572411,
    -0.010130103,
    0.022646155,
    0.017383052,
    -0.026459355,
    -0.024008103,
    -0.01573828,
    -0.010546752,
    -0.047293317,
    -0.011897675,
    0.000783816,
    -0.010380096,
    -0.027845914,
    0.018094311,
    0.028341999,
    0.008675733,
    -0.005461001,
    -0.007061885,
    -0.070806824,
    -0.031395331,
    -0.02083822,
    0.016805464,
    -0.039696515,
    -0.019534493,
    0.015100675,
    -0.039713819,
    0.008581121,
    0.002707581,
    0.005415543,
    -0.014440116,
    -0.01431838,
    -0.002112569,
    -0.016513938,
    -0.004972049,
    0.024900347,
    0.013448807,
    0.003102812,
    -0.005798987,
    0.047491927,
    0.04769481,
    -0.001699514,
    -0.058160689,
    -0.038034052,
    -0.034092188,
    -0.007397447,
    -0.031905435,
    -0.017380066,
    -0.049541786,
    0.030410849,
    -0.057093184,
    -0.041103311,
    0.01581475,
    0.003908056,
    -0.012662838,
    0.025737152,
    0.010011014,
    -0.034454495,
    0.001656826,
    0.07295163,
    -0.004301222,
    -0.016402263,
    -0.022005882,
    0.053332418,
    -0.031396352,
    0.045160815,
    -0.006237334,
    -0.049980994,
    0.023214232,
    -0.013106881,
    0.024318397,
    0.02566166,
    0.015286988,
    0.01628465,
    -0.041567735,
    -0.004074114,
    0.011130818,
    0.02518207,
    0.031245664,
    -0.053528298,
    -0.000711044,
    -0.007052875,
    0.040908657,
    -0.031248285,
    0.010993546,
    -0.023997957,
    0.044848502,
    0.018111942,
    0.006530361,
    0.024578875,
    -0.00577837,
    -0.003597263,
    -0.042536732,
    0.008356829,
    -0.007633734,
    0.032569822,
    -0.017416699,
    -0.058233295,
    -0.027597405,
    0.015809646,
    -0.032936361,
    -0.061679069,
    -0.01485464,
    0.015512968,
    0.004154678,
    0.008708449,
    0.038750108,
    0.034213435,
    -0.014250927,
    -0.029606219,
    -0.01636322,
    0.027903117,
    0.0275784,
    0.042740028,
    0.01004109,
    0.030103622,
    -0.051750246,
    -0.005526207,
    0.000893056,
    0.040242784,
    0.047421593,
    0.014231495,
    -0.015539097,
    0.03502794,
    -0.038122278,
    0.011116972,
    0.017876348,
    -0.043682158,
    0.01236488,
    -0.007385088,
    0.015313255,
    0.014378078,
    -0.077800751,
    -0.022850163,
    0.012587804,
    -0.037911501,
    0.036063794,
    0.042016298,
    -0.025040181,
    0.030310206,
    -0.030744158,
    0.021442542,
    -0.008268643,
    -0.048811696,
    -0.059181772,
    0.059604168,
    -0.054024834,
    -0.026719918,
    0.025152737,
    -0.019569436,
    0.010741467,
    0.003141713,
    -0.014898933,
    -0.01704336,
    -0.011816475,
    -0.01767651,
    0.02383801,
    0.007672054,
    -0.020005027,
    0.051170371,
    0.003564483,
    0.078070804,
    -0.003404368,
    0.013796731,
    -0.008920619,
    -0.018314494,
    0.057776071,
    -0.000945013,
    -0.036871571,
    -0.016401792,
    -0.00430731,
    -0.042913087,
    0.032780726,
    -0.036693618,
    -0.041718367,
    -0.011828816,
    0.049012739,
    0.019230882,
    -0.004537203,
    -0.036519144,
    -0.013057313,
    -0.00852944,
    -0.011819677,
    -0.040349111,
    0.078814156,
    -0.024223467,
    0.024805875,
    -0.027379368,
    -0.061201036,
    -0.043464247,
    0.016853683,
    -0.001608852,
    0.01929667,
    0.044659093,
    0.00225427,
    -0.002260908,
    -0.014017555,
    -0.029044315,
    0.027729556,
    0.017521791,
    -0.003758863,
    0.003684313,
    0.016890267,
    -0.017379377,
    -0.004190549,
    -0.017513296,
    0.04321681,
    0.029075151,
    -0.011163721,
    -0.015577954,
    0.007952307,
    -0.046281669,
    -0.032241579,
    0.017716881,
    0.023738693,
    0.012506217,
    0.020561809,
    0.044005338,
    0.001869336,
    0.037400898,
    -0.079025805,
    0.043386634,
    -0.006474494,
    -0.026914472,
    0.033674445,
    -0.022483677,
    -0.002029792,
    -0.021915779,
    0.095381662,
    -0.009999203,
    0.02952696,
    -0.049201068,
    0.063014254,
    0.005749287,
    0.00488309,
    -0.015723435,
    -0.004409734,
    0.016707065,
    -0.028743148,
    -0.029970491,
    -0.029966986,
    -0.030017585,
    -0.009990131,
    0.033501562,
    -0.078416541,
    -0.008976873,
    0.007729008,
    0.007486071,
    -0.013488217,
    -0.075918131,
    0.023320163,
    0.030282225,
    -0.03010655,
    0.001015768,
    0.010614724,
    -0.013281685,
    0.002747898,
    -0.023785537,
    -0.008214561,
    0.092854515,
    -0.044539787,
    0.001077937,
    -0.019413218,
    0.011949306,
    0.016615884,
    -0.008957984,
    -0.033582553,
    -0.052936029,
    0.029089332,
    -0.057219386,
    -0.002711066,
    0.032414321,
    -0.020169765,
    -0.041743234,
    0.043966033,
    -0.002830434,
    -0.023638779,
    0.003803286,
    -0.007499202,
    0.014679961,
    0.023413356,
    -0.037297048,
    0.029035697,
    0.030451091,
    -0.027996102,
    -0.046556793,
    -0.003738874,
    0.047912832,
    -0.005166003,
    -0.01585399,
    0.016987933,
    0.025984753,
    0.020592986,
    0.00364082,
    0.097556189,
    -0.017053036,
    -0.042150162,
    -0.059878267,
    -0.026571136,
    -0.008875867,
    -0.02613109,
    0.001768906,
    0.044962127,
    0.012545129,
    0.007302567,
    0.097883925,
    -0.007371566,
    -0.032364041,
    -0.00917459,
    -0.012144819,
    -0.006607995,
    0.018486165,
    0.021492405,
    0.035173066,
    -0.03196837,
    -0.016985387,
    0.042263031,
    0.029651793,
    -0.052769348,
    0.003744151,
    0.011466251,
    -0.050435744,
    0.029193677,
    0.013995512,
    -0.047650579,
    -0.070442818,
    0.029053176,
    -0.041363414,
    -0.022392496,
    0.001459446,
    0.009221674,
    0.015586394,
    -0.060150471,
    -0.054562643,
    0.031849757,
    0.009590522,
    -0.009417722,
    0.002395925,
    0.021147599,
    -0.006116263,
    -0.047315486,
    0.037056752,
    0.000696249,
    0.009257085,
    -0.003027359,
    -0.00696405,
    -0.081652589,
    0.018751627,
    0.035305079,
    -0.049972635,
    -0.035919756,
    -0.029103413,
    -0.013132355,
    0.025812624,
    0.02778287,
    -0.005551166,
    0.000941574,
    -0.011914909,
    0.022951154,
    8.0656e-05,
    -0.079344451,
    0.045654524,
    0.021967219,
    0.001344937,
    0.009973768,
    -0.0238824,
    -0.036236681,
    -0.015826022,
    0.034561198,
    0.071018286,
    0.04165433,
    -0.010731112,
    0.070481129,
    0.046897247,
    0.011071932,
    0.063942902,
    -0.010582943,
    -0.016010944,
    0.030897252,
    -0.005761215,
    0.009570913,
    -0.013438435,
    0.027112328,
    0.013301075,
    0.036243461,
    -0.041239604,
    -0.017490398,
    -0.003469475,
    -0.007511083,
    0.013200575,
    0.002829869,
    0.003398091,
    0.04370258,
    0.028460653,
    -0.048441634,
    -0.035854157,
    -0.022291828,
    -0.01387703,
    -0.046485435,
    0.03530496,
    0.013704269,
    -0.023083469,
    -0.019793296,
    0.016410178,
    -0.034463551,
    -0.00819033,
    -0.00401356,
    0.047571272,
    0.017644085,
    -0.008997628,
    -0.054828528,
    0.051180333,
    0.017269114,
    0.018159764,
    -0.0040549,
    0.024258306,
    -0.023047365,
    0.007565726,
    0.004640422,
    0.063223273,
    -0.0137999,
    0.018902201,
    -0.019806756,
    0.026446266,
    -0.003660869,
    0.034145061,
    0.036527161,
    0.015825951,
    0.035465539,
    0.053559314,
    -0.040448792,
    -0.001292409,
    0.020586979,
    0.042667583,
    -0.034018535,
    -0.03073102,
    0.069737479,
    0.014443393,
    -0.053147871,
    -0.012513918,
    -0.029236672,
    0.014316786,
    -0.036364052,
    0.047460809,
    -0.018767072,
    0.041809898,
    -0.003405923,
    -0.023546629,
    0.028530121,
    -0.065813094,
    -0.001193127,
    0.006304926,
    -0.015457211,
    0.02836163,
    -0.025350986,
    0.007602761,
    0.001763926,
    -0.010606806,
    -0.009643065,
    -0.017468549,
    0.011933679,
    0.020030651,
    0.001666092,
    0.027267396,
    -0.010161899,
    -0.024188174,
    0.038665064,
    0.028000245,
    0.038202796,
    0.088544458,
    0.024202181,
    0.066487245,
    -0.003832021,
    0.025486568,
    0.017082829,
    0.011213895,
    -0.004843854,
    0.006434663,
    -0.039702263,
    -0.022725586,
    0.016653778,
    0.05414753,
    -0.006424591,
    -0.035888799,
    0.031353656,
    -0.005813975,
    -0.00110609,
    -0.017303189,
    0.029305635,
    0.007335413,
    -0.00060931,
    -0.031840466,
    0.008885697,
    -0.015270704,
    0.01109615,
    0.003908608,
    -0.007233915,
    0.008878018,
    0.056071777,
    -0.008832048,
    0.015298466,
    -0.045952555,
    -0.023150528,
    -0.04511293,
    0.001915398,
    -0.009662966,
    -0.018799638,
    -0.009793571,
    -0.00085476,
    0.083908327,
    -0.051602483,
    -0.019778777,
    0.007314226,
    0.017491095,
    0.002053668,
    0.001889012,
    -0.039414257,
    0.012931018,
    0.013509925,
    -0.004277126,
    0.007714175,
    0.02033297,
    -0.029585633,
    0.016655849,
    -0.004951452,
    0.06052934,
    0.044127733,
    -0.024478175,
    -0.070395797,
    -0.002573764,
    0.028318405,
    -0.002835889,
    0.023110848,
    -0.02576087,
    -0.024340102,
    -0.001905511,
    0.012891034,
    -0.014042277,
    0.015754882,
    -0.05462769,
    0.011271192,
    -0.015974365,
    0.011021875,
    -0.030054582,
    0.017229741,
    0.06767723,
    -0.002327048,
    -0.028544363,
    0.019289078,
    0.032415476,
    -0.02024365,
    -0.021129677,
    0.037499342,
    -0.028685793,
    0.016455773,
    -0.012835732,
    0.033470713,
    0.03070014,
    0.021325257,
    0.000128122,
    0.024247607,
    -0.005168279,
    0.003713881,
    -0.009541933,
    -0.000281236,
    -0.013633693,
    -0.03801411,
    -0.003167453,
    -0.017741969,
    -0.000808748,
    -0.038834956,
    0.02484758,
    -0.02127224,
    -0.0417463,
    0.033830877,
    0.023456354,
    0.053943407,
    0.012530977,
    -0.005949453,
    0.011189164,
    -0.022271458,
    -0.019989062,
    -0.037298966,
    -0.043895364,
    0.020985266,
    -0.097451165,
    0.018596046,
    0.015372275,
    -0.002027499,
    -0.033060547,
    0.025549853,
    0.007500477,
    -0.006504617,
    0.027149379,
    -0.018914446,
    -0.013232454,
    0.025850881,
    0.005598844,
    0.019043166,
    -0.001411698,
    -0.036441293,
    -0.042909231,
    -0.000566954,
    -0.004466741,
    0.062276438,
    -0.000689961,
    -0.06797599,
    0.035974219,
    0.015492212,
    -0.037716061,
    0.015156908,
    0.004389343,
    0.021205261,
    -0.038484637,
    -0.074544102,
    0.006820051,
    -0.0108622,
    -0.039988957,
    0.015835375,
    0.030845676,
    0.024073698,
    -0.015732218,
    -0.001891038,
    0.072320566,
    -0.014705677,
    0.058405705,
    0.007454611,
    0.009595137,
    0.015527187,
    -0.084588669,
    -0.030083168,
    0.022932837,
    -0.032759979,
    -0.068562053,
    0.029493434,
    -0.012073567,
    0.001600539,
    -0.00433194,
    -0.000538526,
    0.034642082,
    0.0427128,
    -0.004780182,
    -0.006832442,
    0.000635068,
    -0.019512558,
    -0.002865744,
    -0.023120247,
    -0.031139409,
    0.020650627,
    0.017096283,
    0.021639494,
    0.039092753,
    0.006302973,
    0.003847685,
    0.045065161,
    0.015725175,
    -0.022436345,
    0.022959135,
    0.018591931,
    0.029450765,
    0.043019656,
    -0.014066832,
    -0.018971656,
    -0.010893303,
    -0.006113177,
    -0.029402502,
    0.056954946,
    -0.03895203,
    0.000857606,
    0.012941021,
    -0.012884885,
    -0.012416508,
    0.050442167,
    -0.000427456,
    0.030769253,
    -0.068393044,
    0.000448398,
    0.072485864,
    0.040056191,
    -0.020569628,
    -0.016978007,
    -0.01608354,
    -0.028773896,
    0.016444832,
    -0.040821526,
    -0.040491734,
    -0.00911562,
    -0.033979211,
    -0.000150393,
    -0.025073087,
    -0.036521215,
    -0.012611611,
    -0.00761417,
    0.060671024,
    -0.010363459,
    -0.017692899,
    0.017860658,
    -0.006471494,
    0.033562627,
    0.010545112,
    -0.000784649,
    0.028069409,
    0.004556771,
    -0.010157406,
    -0.066134967,
    -0.024529509,
    0.021504793,
    -0.067948356,
    -0.018742951,
    0.000946843,
    0.026792094,
    0.01079927,
    0.001894993,
    0.018062878,
    -0.004146019,
    -0.013093882,
    0.019498209,
    -0.049990665,
    0.004616653,
    -0.023444185,
    -0.001441232,
    0.022588089,
    -0.010991167,
    0.008070908,
    0.036711484,
    0.012000377,
    0.063205123,
    0.018139075,
    0.001850297,
    -0.008849115,
    -0.059088558,
    -0.017951626,
    0.049447633,
    0.019195704,
    -0.002349085,
    0.006178926,
    -0.052457061,
    -0.034062754,
    -0.028400114,
    0.013704629,
    0.067769513,
    -0.002999855,
    -0.00924896,
    -0.056723107,
    -0.000899569,
    -0.020405473,
    0.004980661,
    0.004724964,
    -0.005082426,
    -0.037600793,
    0.013650175,
    0.007263838,
    -0.004073939,
    -0.011102566,
    0.042130645,
    0.032706093,
    -0.029049015,
    0.014337693,
    -0.04206213,
    -0.022823006,
    -0.015903635,
    -0.022781156,
    0.00174953,
    -0.022563813,
    0.002331764,
    -0.007117102,
    -0.019328749,
    0.0313925,
    -0.02571384,
    0.001894338,
    0.019094648,
    0.038835149,
    -0.018688533,
    0.012782408,
    -0.070741862,
    -0.055187207,
    0.009270522,
    0.037437174,
    -0.02730171,
    0.036942337,
    -0.018021435,
    0.012485044,
    -0.018558685,
    0.05180712,
    0.021821637,
    0.003363525,
    0.048465032,
    0.002420642,
    0.023011081,
    -0.041727025,
    0.042059071,
    -0.03710128,
    0.001223831,
    -0.004116515,
    0.005221688,
    -0.034076255,
    0.048677292,
    0.017662233,
    0.011701139,
    0.061186522,
    -0.011880243,
    0.021898612,
    -0.053063661,
    -0.027032223,
    0.000581543,
    -0.026655281,
    -0.039925225,
    -0.007498738,
    0.018238105,
    0.04668276,
    0.003419369,
    -0.011647833,
    -0.010686025,
    0.002811735,
    0.006373842,
    -0.011518002,
    0.001538874,
    0.027262866,
    0.035098806,
    0.028466498,
    -0.020337515,
    -0.039837517,
    -0.04008235,
    0.0141174,
    -0.006744188,
    0.065036438,
    0.01405297,
    -0.002872472,
    0.022334045,
    0.00533151,
    0.020514665,
    0.028932802,
    -0.011231225,
    0.009389825,
    -0.057901792,
    0.001310392,
    0.012771308,
    0.001690404,
    -0.024209401,
    0.021325281,
    -0.045295231
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage.Tests/Async/AsyncLockManagerTests.cs",
    "chunk_index": 2,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "/summary>\n+    [Fact]\n+    public async Task SemaphoreDisposalRaceCondition_DisposeDuringWait_ShouldHandleCleanly()\n+    {\n+        // Arrange\n+        var tempLockManager = new AsyncLockManager();\n+        var lockKey = \"semaphore_disposal_race\";\n+        var exceptions = new ConcurrentBag<Exception>();\n+\n+        // Act - Acquire a lock, then start waiting threads, then dispose\n+        var firstLock = await tempLockManager.AcquireLockAsync(lockKey);\n+\n+        var waitingTasks = Enumerable.Range(0, 5).Select(i =>\n+            Task.Run(async () =>\n+            {\n+                try\n+                {\n+                    // These will wait on the semaphore\n+                    using var lockHandle = await tempLockManager.AcquireLockAsync(lockKey, TimeSpan.FromSeconds(1));\n+                }\n+                catch (ObjectDisposedException)\n+                {\n+                    // Expected after disposal\n+                }\n+                catch (TimeoutException)\n+                {\n+                    // Also acceptable\n+                }\n+                catch (Exception ex)\n+                {\n+                    exceptions.Add(ex);\n+                }\n+            })\n+        ).ToArray();\n+\n+        await Task.Delay(10); // Let waiting tasks start\n+\n+        // Dispose the manager while threads are waiting on semaphores\n+        tempLockManager.Dispose();\n+        \n+        // Release the first lock after disposal\n+        firstLock.Dispose();\n+\n+        await Task.WhenAll(waitingTasks);\n+\n+        // Assert - Should not have unexpected exceptions from semaphore disposal race\n+        Assert.Empty(exceptions.ToArray());\n+    }\n+\n+    /// <summary>\n+    /// FAILING TEST: High-stress concurrent operations to expose all race conditions\n+    /// This test runs many concurrent operations to increase probability of race conditions\n+    /// </summary>\n+    [Fact]\n+    public async Task HighStressConcurrencyTest_MassiveConcurrentOperations_ShouldBeThreadSafe()\n+    {\n+        // Arrange - Reduced scale for manageable testing\n+        var lockKeys = Enumerable.Range(0, 5).Select(i => $\"stress_test_{i}\").ToArray();\n+        var operationsPerKey = 10;\n+        var totalOperations = lockKeys.Length * operationsPerKey;\n+        var exceptions = new ConcurrentBag<Exception>();\n+        var completedOperations = 0;\n+\n+        // Act - Create concurrent load with timeouts to prevent indefinite blocking\n+        var allTasks = lockKeys.SelectMany(lockKey =>\n+            Enumerable.Range(0, operationsPerKey).Select(i =>\n+                Task.Run(async () =>\n+                {\n+                    try\n+                    {\n+                        using var lockHandle = await _lockManager.AcquireLockAsync(lockKey, TimeSpan.FromMilliseconds(200));\n+                        await Task.Delay(1); // Minimal work\n+                        Interlocked.Increment(ref completedOperations);\n+                    }\n+                    catch (TimeoutException)\n+                    {\n+                        // Acceptable under high concurrency\n+                    }\n+                    catch (Exception ex)\n+                    {\n+                        exceptions.Add(ex);\n+                    }\n+                })\n+            )\n+        ).ToArray();\n+\n+        await Task.WhenAll(allTasks);\n+\n+        // Assert - Should have no unexpected exceptions, allow some timeouts\n+        var allExceptions = exceptions.ToArray();\n+        Assert.Empty(allExceptions);\n+        \n+        // Most operations should complete (allow for some timeouts under stress)\n+        Assert.True(completedOperations >= totalOperations * 0.8, \n+            $\"Expected at least 80% operations to complete, got {completedOperations}/{totalOperations}\");\n+    }\n+\n     public void Dispose()\n     {\n         _lockManager?.Dispose();\n     }\n }\n\\ No newline at end of file"
}