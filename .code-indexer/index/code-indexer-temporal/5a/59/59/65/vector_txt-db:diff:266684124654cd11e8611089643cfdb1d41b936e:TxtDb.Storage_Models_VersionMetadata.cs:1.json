{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Models/VersionMetadata.cs:1",
  "vector": [
    0.018772501,
    0.024443081,
    0.012454745,
    -0.006123794,
    0.017076619,
    -0.01329879,
    -0.004560466,
    -0.037060875,
    0.035656091,
    0.007698461,
    0.022395579,
    0.021769607,
    0.07108669,
    0.025601236,
    -0.085422814,
    -0.044278666,
    -0.010568842,
    -0.006141271,
    -0.052760456,
    0.024052743,
    -0.03454468,
    -0.075419903,
    -0.042993736,
    0.039540969,
    -0.049387056,
    0.002785603,
    0.028668543,
    0.062675372,
    0.017863767,
    0.052835423,
    -0.041127805,
    -0.034446619,
    -0.01911089,
    0.035377782,
    0.022509404,
    0.000688075,
    -0.03932688,
    -0.009417914,
    -0.004192048,
    0.007702504,
    0.034794629,
    -0.023969881,
    0.064415023,
    -0.003843042,
    0.019446414,
    -0.035396446,
    0.029514406,
    0.007738114,
    -0.015880546,
    0.013010431,
    -0.019112706,
    0.01221463,
    -0.01918859,
    0.029641178,
    0.023956677,
    -0.053839847,
    0.063827157,
    0.005397059,
    -0.042286925,
    0.033356223,
    -0.022115478,
    0.020268779,
    -0.006410337,
    0.028169552,
    -0.009781447,
    -0.056429375,
    -0.080251209,
    0.030917769,
    0.021326801,
    -0.067404121,
    0.01708531,
    0.030227995,
    -0.010665043,
    0.026519859,
    0.041671053,
    0.012208201,
    0.040719185,
    7.3405e-05,
    0.044471707,
    -0.024073016,
    -0.070042051,
    -0.061051577,
    -0.018443469,
    -0.017745562,
    0.026564827,
    -0.040074412,
    0.043355152,
    -0.06745974,
    -0.012523796,
    -0.012919304,
    -0.019713057,
    0.056586638,
    0.028960902,
    -0.024108963,
    0.039945435,
    -0.007440652,
    0.024758784,
    -0.014636966,
    0.02061045,
    -0.014978984,
    0.000291113,
    -0.001226311,
    -0.010149701,
    0.032588877,
    -0.055331774,
    0.010195451,
    0.007088624,
    -0.00526767,
    0.007679852,
    0.019019935,
    0.08153972,
    0.00386473,
    0.010783835,
    -0.001940962,
    0.010715734,
    0.026303789,
    -0.011448154,
    -0.017283443,
    0.019765483,
    0.026361298,
    -0.054836605,
    0.020209529,
    -0.057426549,
    0.059260216,
    -0.023769118,
    0.030718824,
    0.05045386,
    0.019251429,
    -0.004127703,
    -0.035661507,
    -0.018851204,
    -0.034057751,
    0.011893229,
    -0.001635017,
    0.001412525,
    0.013004301,
    0.0168959,
    0.030131966,
    0.008341377,
    -0.046883289,
    -0.002372913,
    -0.017108046,
    -0.024372306,
    0.014321671,
    -0.003444563,
    0.004369203,
    0.03768127,
    0.004286383,
    0.010916883,
    -0.053629708,
    0.021978892,
    0.07762339,
    -0.013753265,
    0.003846077,
    0.023514558,
    0.037058149,
    -0.031188648,
    -0.018993536,
    0.01890992,
    -0.028759148,
    -0.041712064,
    0.032366723,
    0.020969979,
    0.013147702,
    -0.042185992,
    0.044967454,
    0.01178195,
    0.029267265,
    -0.000721867,
    -0.009731291,
    -0.061142568,
    0.006755594,
    -0.052027039,
    -0.023196401,
    -0.059598021,
    -0.010402512,
    0.007117273,
    0.007242755,
    -0.074589506,
    -0.061467316,
    0.003277133,
    -0.033700962,
    -0.02522959,
    -0.001029765,
    0.026144089,
    -0.011612924,
    0.023758808,
    0.023513986,
    0.009166558,
    -0.020828234,
    -0.035774328,
    -0.021507319,
    -0.034385834,
    -0.025043814,
    -0.009291487,
    -0.016204432,
    -0.016251788,
    0.010622918,
    0.056588411,
    -0.001447065,
    -0.060927644,
    0.025025714,
    -0.067010395,
    -0.023438182,
    0.013374693,
    0.002762623,
    -0.007492768,
    -0.029814059,
    0.008299213,
    0.026351605,
    0.005913099,
    -0.000645108,
    0.023816299,
    0.003330652,
    0.002647279,
    -0.007660658,
    -0.056016445,
    -0.00683128,
    0.053268336,
    0.000183327,
    0.002811412,
    -0.025210509,
    0.080256529,
    0.016052615,
    -0.000400891,
    -0.032236524,
    -0.047896765,
    -0.039701223,
    -0.033550143,
    -0.026216088,
    0.026474832,
    -0.044520654,
    0.023235211,
    -0.047978338,
    -0.000397377,
    0.071188405,
    -0.018282514,
    -0.015267018,
    0.011322905,
    -0.014720559,
    -0.028376026,
    0.032011729,
    -0.003696178,
    0.008534607,
    -0.044395484,
    0.005929594,
    0.043198019,
    0.050375987,
    -0.030202404,
    0.025926501,
    -0.020296665,
    0.063092463,
    0.002921819,
    0.120199464,
    0.060196832,
    0.034303997,
    0.00373036,
    0.044117976,
    -0.013827726,
    0.005855924,
    0.005148614,
    -0.006341618,
    -0.058947325,
    0.055425473,
    -0.004290555,
    0.022763936,
    -0.029497176,
    -0.036685493,
    0.001730887,
    0.041700028,
    0.025490247,
    -0.006931302,
    0.061204214,
    0.041838083,
    -0.013955864,
    -0.020147743,
    0.019593915,
    -0.010287175,
    0.007652523,
    0.036709037,
    -0.041380208,
    -0.017105537,
    0.022444936,
    -0.020884471,
    -0.036776692,
    -0.035897009,
    -0.008377168,
    -0.032949492,
    0.026101729,
    0.019212699,
    0.024082579,
    0.003641011,
    0.000796887,
    -0.04329608,
    0.031040424,
    0.022325687,
    0.043291885,
    -0.036620099,
    0.022273121,
    -0.022914721,
    0.045321174,
    -0.001608169,
    0.060608197,
    0.026809124,
    -0.012791077,
    0.033631545,
    0.032934055,
    -0.036620304,
    0.026242873,
    0.022029357,
    -0.050666444,
    -0.026428308,
    0.035042509,
    -0.003492618,
    0.0195265,
    -0.070769288,
    -0.005610132,
    0.001017871,
    -0.017630817,
    -0.016260287,
    0.01264018,
    -0.003810267,
    0.002500411,
    -0.024946585,
    -0.006902201,
    0.030773949,
    -0.036294654,
    -0.02553953,
    0.024614906,
    -0.017976031,
    -0.019441567,
    0.016289636,
    -0.014743963,
    0.068074085,
    -0.008766939,
    0.008869386,
    -0.049541038,
    0.006684964,
    -0.054496035,
    0.021487035,
    0.016135156,
    -0.036123775,
    0.025293522,
    -0.03565336,
    0.044383012,
    -0.019993627,
    0.006774223,
    0.015357358,
    -0.013886064,
    0.052876145,
    0.010748841,
    -0.046551958,
    -0.034057811,
    0.010496024,
    -0.060468126,
    0.047672525,
    -0.007914789,
    0.002178005,
    0.008103628,
    0.039421175,
    0.034407977,
    0.0100352,
    -0.071044669,
    -0.016497919,
    -0.007705821,
    0.019386539,
    -0.054954261,
    0.061223924,
    -0.029279038,
    0.056890275,
    -0.042637777,
    -0.039579295,
    -0.050926693,
    0.005684366,
    -0.010564091,
    0.016109237,
    0.028250642,
    -0.021219805,
    -0.040408082,
    0.005426256,
    0.012836681,
    0.016065512,
    0.030863414,
    -0.013409719,
    -0.034472562,
    -0.030556751,
    0.001592587,
    0.017168686,
    -0.023040617,
    0.052357841,
    0.013893453,
    0.018449267,
    0.0222733,
    0.011403654,
    -0.006041321,
    -0.039380111,
    -0.014858969,
    0.039430145,
    -0.001365038,
    -0.040745139,
    -0.004025114,
    0.013472339,
    0.04208979,
    -0.040463213,
    0.02705319,
    0.0219354,
    0.010744323,
    0.025412271,
    -0.0390555,
    0.03015299,
    -0.015566099,
    0.01847489,
    0.008478744,
    0.01619504,
    -0.028151833,
    0.013704653,
    -0.023508847,
    -0.020644384,
    -0.006061752,
    0.000989605,
    0.00625474,
    -0.029550487,
    -0.011634195,
    -0.000446997,
    -0.035351511,
    0.008485554,
    0.021135245,
    -0.044482682,
    -0.010589619,
    -0.007880885,
    -0.013872609,
    -0.006669931,
    -0.060859162,
    -0.010818612,
    0.049354758,
    -0.061389312,
    0.013775796,
    -0.013259103,
    -0.02563408,
    -0.004414536,
    0.002820557,
    -0.031184411,
    0.041185014,
    -0.035016004,
    -0.023682086,
    -0.021304244,
    0.010242988,
    0.053974573,
    -0.069595031,
    -0.065896235,
    -0.02337301,
    -0.029478865,
    -0.029234121,
    -0.006830519,
    0.069254175,
    -0.031145945,
    -0.001566448,
    0.009837467,
    0.014759778,
    -0.029556535,
    -0.02814723,
    -0.019978503,
    -0.018329913,
    0.018883754,
    -0.028362039,
    -0.003400458,
    0.020842288,
    -0.052748289,
    -0.022983091,
    0.000733247,
    0.05838364,
    -0.042015929,
    0.014191117,
    0.014014121,
    0.027118407,
    0.005587818,
    0.023524119,
    0.037680726,
    -0.032746017,
    -0.027287055,
    -0.002309061,
    -0.011428033,
    -0.0024915,
    -0.068163536,
    -0.008109085,
    0.037910085,
    -0.003682544,
    0.018926222,
    0.03177622,
    -0.035423059,
    -0.008788773,
    -0.028911479,
    -0.007089079,
    -0.008135711,
    0.019242488,
    -0.001716525,
    -0.024983857,
    -0.046739135,
    -0.027928999,
    0.014019935,
    0.053883582,
    -0.07911849,
    0.018882561,
    -0.034376092,
    -0.000714545,
    0.033194229,
    0.032142047,
    -0.017864792,
    -0.085983433,
    0.045422859,
    -0.027983837,
    -0.024628267,
    0.011535361,
    0.034883831,
    0.010748236,
    -0.04815669,
    -0.015228434,
    0.039612453,
    0.008402163,
    -0.009771476,
    -0.004537349,
    0.026033562,
    -0.028777327,
    -0.037887979,
    0.005452213,
    0.020758539,
    0.010734063,
    0.01950315,
    0.005762473,
    -0.036921702,
    0.007652614,
    0.007330979,
    -0.031344991,
    -0.036734037,
    0.04209137,
    -0.035098314,
    0.034995679,
    -0.003846374,
    -0.001054234,
    0.017442469,
    -0.022916537,
    0.021524861,
    0.011133377,
    -0.055844013,
    0.004714649,
    0.020051336,
    -0.026513323,
    -0.003118939,
    0.000443426,
    0.020045757,
    -0.000594785,
    0.059574708,
    0.018990355,
    0.032423526,
    -0.048411392,
    0.065255783,
    0.048033938,
    -0.032489043,
    0.041293822,
    -0.030938277,
    0.044589799,
    0.02378438,
    0.036199439,
    0.039214067,
    -0.031207955,
    0.02031781,
    0.024074227,
    0.024208775,
    -0.003002975,
    0.010516475,
    0.010406002,
    -0.012804335,
    0.037398748,
    0.007521201,
    -0.016895587,
    0.0430343,
    0.065725505,
    -0.036608811,
    -0.012127115,
    0.002486802,
    -0.015694333,
    0.004152207,
    0.002420324,
    0.022916203,
    0.024473684,
    -0.03921118,
    0.022886986,
    -0.011453907,
    -0.034803964,
    -0.01488822,
    0.024879353,
    0.00099709,
    0.004709707,
    -0.026290907,
    0.025648432,
    0.012867224,
    -0.01619751,
    -0.01115055,
    -0.021185502,
    -0.034601949,
    -0.003050707,
    0.027169576,
    0.023922445,
    0.005144377,
    0.013477257,
    -0.036843188,
    0.020100234,
    -0.030577907,
    0.065870196,
    0.021248663,
    0.003343903,
    0.015237735,
    0.098535322,
    -0.033738688,
    0.021709777,
    0.027850602,
    0.01220825,
    -0.07499259,
    0.015403279,
    0.029790485,
    0.00543487,
    -0.057285547,
    -0.015496986,
    -0.003493306,
    -0.007895687,
    -0.011659649,
    0.019681526,
    -0.022418421,
    0.008031461,
    0.012862248,
    -0.021447947,
    0.048589386,
    -0.039439108,
    0.024101019,
    0.026227593,
    0.000192888,
    -0.001575543,
    0.01162657,
    0.004500392,
    -0.027158009,
    0.027402263,
    -0.018995631,
    0.01172132,
    0.040662415,
    0.036320366,
    0.027289214,
    0.034247823,
    -0.049017385,
    -0.039688822,
    0.053815622,
    0.010262232,
    0.010427835,
    0.067705408,
    0.056844834,
    0.040418446,
    0.040676199,
    0.03660398,
    -0.014526536,
    -0.00567135,
    -0.009205311,
    -0.010388488,
    -0.031733952,
    -0.028354313,
    0.03373944,
    0.040738598,
    -0.048955083,
    -0.008927113,
    0.03814622,
    -0.042339649,
    -0.023122966,
    -0.015115009,
    0.0398301,
    -0.036293902,
    -0.028049329,
    -0.005601059,
    -0.007225449,
    0.003535511,
    -0.00420053,
    -0.012392729,
    -0.030469611,
    0.038134973,
    0.09447594,
    -0.023547802,
    0.010069167,
    -0.060474698,
    0.004843092,
    -0.030892415,
    0.01062317,
    -0.022076271,
    0.016093934,
    0.008662351,
    -0.009636926,
    0.072498299,
    -0.025443222,
    0.019321335,
    -0.002340312,
    0.017539753,
    -0.005399615,
    -0.048727591,
    -0.02398181,
    0.002639562,
    0.042285085,
    -0.012777431,
    0.022113437,
    0.008895424,
    0.016129989,
    -0.022134479,
    -0.033669136,
    0.069739267,
    0.016234867,
    0.013967161,
    0.013028027,
    -0.000260429,
    0.039059248,
    -0.015938854,
    -0.019059399,
    -0.028246854,
    -0.026614642,
    -0.012515092,
    0.014012924,
    0.020343754,
    -0.006190401,
    -0.04657504,
    0.006867223,
    -0.012862927,
    0.003829183,
    0.015695041,
    0.034144439,
    0.047364861,
    -0.0053106,
    -0.03307436,
    0.006598295,
    -0.013371685,
    0.043510899,
    -0.060786396,
    0.014965222,
    -0.008275144,
    0.024584342,
    -0.028297406,
    -0.002723583,
    0.000867777,
    0.03285934,
    -0.032826554,
    0.002485925,
    0.018802799,
    -0.03306552,
    -0.020672092,
    0.025422845,
    -0.015339904,
    -0.079001002,
    -0.025245201,
    0.022813614,
    0.001839581,
    -0.000970317,
    0.00433223,
    -0.02004648,
    -0.035188012,
    0.034816667,
    -0.000402973,
    0.018105233,
    -0.033586737,
    0.011185882,
    0.016704451,
    -0.020822452,
    -0.020735571,
    -0.029004989,
    0.020732027,
    0.002805704,
    -0.073058255,
    0.002358819,
    -0.023164636,
    -0.007433583,
    -0.037833631,
    0.026205029,
    -0.02543371,
    -0.043743458,
    0.004766246,
    0.009075742,
    -0.044692688,
    -0.002150158,
    -0.019006925,
    0.019908132,
    0.016135214,
    -0.006125072,
    -0.023909029,
    -0.004197996,
    0.037177972,
    0.036471285,
    0.008958977,
    -0.074086614,
    0.02176749,
    0.000943934,
    -0.022720063,
    0.020489363,
    0.029137364,
    0.005383507,
    -0.035337243,
    -0.00311344,
    0.010840987,
    -0.027275773,
    -0.031924732,
    0.043746687,
    0.024154652,
    0.045416046,
    0.009014152,
    -0.011141549,
    0.048600379,
    0.022377674,
    0.0333586,
    0.046879657,
    -0.008220815,
    -0.002627502,
    -0.054659735,
    -0.016880477,
    0.070253253,
    -0.012310158,
    -0.08072938,
    0.021866936,
    -0.0028258,
    -0.027962029,
    -0.009826467,
    0.023485117,
    0.019475127,
    0.015246704,
    -0.005989352,
    0.007617994,
    -0.004214008,
    0.004104799,
    -0.013493858,
    0.034914114,
    -0.024787236,
    0.018848473,
    0.022048574,
    -0.019388985,
    0.014230992,
    0.01295574,
    -0.038982905,
    0.070531696,
    0.014736031,
    -0.022145104,
    0.007902578,
    -0.011851781,
    0.01371365,
    0.016152596,
    -0.008927096,
    -0.077817366,
    -0.004694683,
    0.002952028,
    -0.002589884,
    0.03825634,
    -0.021248549,
    -0.019232655,
    -0.017607089,
    -0.007348296,
    -0.026548596,
    0.060868513,
    0.044101857,
    0.050541062,
    -0.052793175,
    -0.053511489,
    0.101027861,
    -0.039715968,
    -0.013729911,
    -0.009145664,
    -0.041847523,
    -0.039523195,
    0.001956825,
    0.017956316,
    -0.02246571,
    -0.019551329,
    0.008542621,
    -0.001777752,
    -0.049059156,
    -0.021815874,
    0.035061322,
    -0.013822451,
    0.009947373,
    -0.013038005,
    -0.038326778,
    -0.010772887,
    0.003652661,
    -0.00641026,
    0.037706021,
    0.022263059,
    0.018516256,
    -0.069298275,
    -0.022016257,
    -0.040390644,
    -0.020811023,
    0.043515719,
    -0.030266378,
    0.020650838,
    -0.016290188,
    0.048318516,
    0.033020288,
    0.013640716,
    0.006170634,
    -0.021513445,
    -0.020492671,
    0.022010347,
    0.018536977,
    0.054357495,
    -0.048512541,
    0.041501477,
    0.039067775,
    0.020893686,
    0.01015114,
    -0.009144844,
    0.012499577,
    0.0305323,
    0.000739147,
    -0.04848766,
    -0.01979279,
    0.000362666,
    -0.024865532,
    -0.014799442,
    0.049085896,
    0.03160746,
    -0.012648772,
    -0.003529551,
    0.014695782,
    -0.020813886,
    -0.01220212,
    0.006113567,
    0.041258879,
    0.025354331,
    -0.067775108,
    -0.014282631,
    -0.042143058,
    0.021720048,
    -0.00155226,
    -0.0266,
    -0.015868321,
    0.035347309,
    0.020522783,
    -0.005946838,
    -0.000973876,
    0.045861527,
    0.043753065,
    -0.054483417,
    0.002377272,
    -0.051142015,
    -0.07354819,
    0.007109749,
    -0.062423669,
    0.013300507,
    0.021411235,
    0.030694697,
    -0.001100223,
    -0.020723071,
    0.006223651,
    0.017278954,
    0.016079009,
    0.001819244,
    0.022589117,
    0.032750249,
    -0.016656827,
    -0.026805045,
    -0.04753295,
    -0.043801326,
    -0.041023377,
    -0.030703306,
    0.040928587,
    0.001525752,
    0.015657462,
    -0.003012686,
    0.04629704,
    0.025684472,
    0.005979312,
    0.034092728,
    0.047400761,
    -0.01466162,
    -0.048343275,
    -0.00695599,
    -0.050618008,
    -0.003179967,
    0.033861939,
    -0.00599426,
    -0.029640833,
    0.005121091,
    0.032966297,
    0.026874874,
    0.035494652,
    -0.019615114,
    -0.008674534,
    -0.022656517,
    -0.028656259,
    0.015170802,
    -0.014433765,
    -0.026260363,
    -0.022016462,
    0.01072404,
    0.007619848,
    -0.006276049,
    0.020156767,
    0.00592605,
    0.005671151,
    -0.035797965,
    0.004548069,
    -0.018298885,
    0.016678223,
    -0.023695318,
    0.014528892,
    0.020657109,
    -0.011243286,
    -0.019638043,
    0.017850483,
    0.02346023,
    0.049760543,
    0.064232267,
    0.038119495,
    0.025387134,
    0.01247156,
    0.010651219,
    -0.035226334,
    0.015986312,
    0.056723695,
    -0.000671956,
    0.004203315,
    -0.003779237,
    0.012098611,
    -0.008767499,
    0.008956146,
    -0.038079821
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Models/VersionMetadata.cs",
    "chunk_index": 1,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "foreach (var kvp in snapshot.PageVersions)\n+        {\n+            metadata.PageVersions[kvp.Key] = kvp.Value;\n+        }\n+        \n+        foreach (var kvp in snapshot.NamespaceOperations)\n+        {\n+            metadata.NamespaceOperations[kvp.Key] = kvp.Value;\n+        }\n+        \n+        return metadata;\n+    }\n }\n \n public class PageVersionInfo\n {\n     private readonly object _lock = new object();\n@@ -85,8 +154,31 @@ public class MVCCTransaction\n     public long TransactionId { get; set; }\n     public long SnapshotTSN { get; set; }\n     public DateTime StartTime { get; set; }\n     public Dictionary<string, long> ReadVersions { get; set; } = new();\n     public Dictionary<string, long> WrittenPages { get; set; } = new();\n+    \n+    /// <summary>\n+    /// CRITICAL SECURITY FIX: Track actual file paths written by this transaction\n+    /// for transaction-specific flushing during critical operations.\n+    /// This prevents critical operations from flushing other transactions' data,\n+    /// maintaining MVCC isolation and ACID properties.\n+    /// </summary>\n+    public HashSet<string> WrittenFilePaths { get; set; } = new();\n+    \n     public bool IsCommitted { get; set; }\n     public bool IsRolledBack { get; set; }\n+}\n+\n+/// <summary>\n+/// Immutable snapshot of VersionMetadata used for safe serialization.\n+/// This prevents concurrent modification exceptions during JSON serialization.\n+/// </summary>\n+public class VersionMetadataSnapshot\n+{\n+    public long CurrentTSN { get; set; }\n+    public HashSet<long> ActiveTransactions { get; set; } = new();\n+    public Dictionary<string, PageVersionInfo> PageVersions { get; set; } = new();\n+    public Dictionary<string, int> NamespaceOperations { get; set; } = new();\n+    public Dictionary<string, DateTime> DeletedNamespaces { get; set; } = new();\n+    public DateTime LastUpdated { get; set; } = DateTime.UtcNow;\n }\n\\ No newline at end of file"
}