{
  "id": "txt-db:diff:266684124654cd11e8611089643cfdb1d41b936e:TxtDb.Storage/Services/Async/MonitoredAsyncStorageSubsystem.cs:0",
  "vector": [
    -0.002864264,
    0.018503072,
    0.000639849,
    0.062937714,
    -0.031330258,
    -0.01449998,
    -0.033775169,
    -0.033644982,
    0.026631474,
    0.00126821,
    0.020868957,
    0.021284409,
    0.051304691,
    -0.008941,
    -0.084159352,
    -0.043326564,
    0.060199138,
    0.027860522,
    -0.031187976,
    0.004402992,
    -0.050423201,
    -0.038028423,
    -0.028870758,
    0.046282072,
    -0.07373777,
    0.00383276,
    0.019900808,
    0.01575394,
    -0.009084369,
    0.033398073,
    -0.030661806,
    -0.036009353,
    0.024478778,
    0.06045831,
    0.023998773,
    -0.036275264,
    -0.013810598,
    -0.019118598,
    0.012768358,
    0.022323353,
    0.061514787,
    0.012001679,
    0.033805296,
    -0.020698436,
    0.041263562,
    -0.06639833,
    0.027954545,
    -0.007180925,
    0.00159206,
    0.00644528,
    -0.011375375,
    0.007217525,
    0.005077451,
    0.032743499,
    0.001911755,
    -0.011381358,
    0.078051396,
    0.056049801,
    -0.039183471,
    0.027678121,
    -0.011281355,
    -0.015435641,
    -0.018266929,
    0.01723568,
    -0.019583711,
    -0.050520506,
    -0.026853085,
    0.061854944,
    -0.008398919,
    -0.057285156,
    0.049771395,
    0.049230166,
    0.010488458,
    0.041236874,
    0.040937662,
    0.024291011,
    0.016910611,
    -0.003709725,
    0.058025673,
    -0.027276428,
    -0.025932726,
    -0.068614252,
    0.009095036,
    -0.009682162,
    0.048015215,
    -0.001713642,
    0.008793507,
    -0.041615009,
    0.018059129,
    0.017891113,
    -0.00454112,
    0.018971911,
    0.052875798,
    0.046356589,
    0.012809722,
    0.034332052,
    0.029993691,
    0.011915007,
    0.016877422,
    -0.014494977,
    0.014873811,
    0.026227538,
    -0.041110456,
    0.059091456,
    -0.073782794,
    -0.002534032,
    -0.010780503,
    0.000841591,
    0.004986664,
    0.016061218,
    0.034970969,
    0.03674525,
    -0.006090077,
    0.018037656,
    0.014043435,
    0.01817569,
    -0.004233765,
    -0.014975215,
    0.006522764,
    0.022300584,
    -0.022868907,
    0.034362823,
    -0.049803708,
    0.0199691,
    0.002510766,
    0.068758294,
    0.004074595,
    0.044862337,
    0.002237894,
    -0.003224848,
    0.015324212,
    -0.000126118,
    -0.00516277,
    0.006698146,
    -0.012350277,
    0.062137645,
    0.028531572,
    0.057936158,
    -0.010313551,
    -0.043972425,
    0.031326711,
    -0.02228599,
    -0.014401546,
    0.016859723,
    0.01650662,
    0.030864008,
    0.012285613,
    0.005657297,
    0.002133387,
    -0.059005834,
    0.00067975,
    0.070709616,
    -0.039168045,
    0.006013963,
    -0.016852973,
    0.008144494,
    -0.003862367,
    -0.047910828,
    -0.022495544,
    -0.01445021,
    -0.037231512,
    0.068008982,
    0.006496196,
    -0.013643719,
    -0.011130023,
    0.039667852,
    0.004593936,
    0.011984649,
    0.02318484,
    -0.032447293,
    -0.035439298,
    0.019098049,
    -0.056848563,
    -0.011797997,
    0.030553695,
    0.020166354,
    0.017560894,
    0.001435357,
    -0.044072401,
    -0.042621583,
    0.022255808,
    -0.011409584,
    -0.003415676,
    -0.00059763,
    -0.013151373,
    -0.019845683,
    0.040031768,
    -0.008399759,
    0.010801329,
    0.041805014,
    -0.009527382,
    0.033021163,
    -0.040698647,
    -0.025251703,
    0.003812044,
    -0.047437917,
    -0.027795756,
    -0.030453963,
    0.01667353,
    -0.002712803,
    -0.045555782,
    0.009816201,
    -0.048479203,
    -0.003894508,
    0.010166811,
    0.038438644,
    -0.062346336,
    -0.005559473,
    -0.004990309,
    0.00048153,
    -0.033705048,
    -0.014343311,
    0.020240789,
    -0.018543946,
    0.017963096,
    -0.019257575,
    -0.053154491,
    -0.000531395,
    0.039115444,
    0.001287385,
    0.002765356,
    0.001454571,
    0.06879019,
    0.028079376,
    -0.042576816,
    -0.048622884,
    -0.059326142,
    -0.049899496,
    0.002822072,
    -0.004234703,
    0.010166721,
    -0.052815396,
    0.040652703,
    -0.033767611,
    -0.073484816,
    0.053378303,
    -0.000760123,
    -0.01173012,
    0.013398999,
    -0.030494478,
    -0.032415807,
    0.047740668,
    -0.023159023,
    0.008157604,
    -0.033961609,
    0.006232853,
    0.058704898,
    -0.007105408,
    0.010165077,
    0.023474975,
    -0.046951022,
    0.03449443,
    -0.012807794,
    0.089851595,
    0.034947626,
    -0.004182537,
    0.002105499,
    0.000688691,
    0.01573343,
    -0.018436713,
    0.010113447,
    0.007648223,
    -0.019752843,
    -0.023973614,
    -0.01646716,
    0.033029027,
    -0.046513349,
    -0.010350178,
    0.00297803,
    0.070469297,
    0.035557456,
    0.004591038,
    0.050969489,
    0.003056667,
    0.005998763,
    -0.026241869,
    0.016462367,
    0.0266113,
    0.041707166,
    0.027487412,
    -0.043895263,
    -0.020898525,
    0.039813951,
    -0.070187122,
    -0.0540509,
    -0.025240524,
    0.001036351,
    -0.00638502,
    0.032142624,
    0.043664962,
    0.030322336,
    0.006240545,
    -0.00478921,
    -0.020468779,
    0.007122377,
    0.020925591,
    0.020297727,
    -0.019928437,
    0.012387428,
    -0.032808851,
    0.000968963,
    -0.003490052,
    0.063019365,
    0.025281416,
    0.002998241,
    0.013339917,
    0.016078992,
    -0.032082256,
    0.019098552,
    -0.034117375,
    -0.036954634,
    -0.008282839,
    0.036066722,
    -0.003041479,
    0.034609985,
    -0.030635497,
    -0.014807341,
    -0.012324933,
    0.001801336,
    0.00577778,
    -0.02250131,
    -0.046280488,
    0.019141898,
    -0.081083603,
    0.01960095,
    -0.01849374,
    -0.06721241,
    -0.061147142,
    0.040184312,
    -0.037506979,
    0.020388426,
    0.017409667,
    0.009538921,
    0.044464909,
    -0.010772439,
    0.014654439,
    -0.024007026,
    0.009207914,
    -0.069973171,
    0.046386097,
    -0.027712235,
    -0.034143325,
    0.028143842,
    -0.031366687,
    0.03915317,
    -0.021727607,
    0.015240133,
    -0.010744317,
    -0.031535,
    0.052956033,
    0.002116136,
    -0.063848756,
    -0.036497671,
    0.010605024,
    -0.086252533,
    0.07030341,
    -0.033072047,
    0.0183596,
    0.030575125,
    0.047360715,
    0.018480485,
    0.029262815,
    -0.028074345,
    0.001570878,
    -0.017759416,
    0.006898689,
    -0.049913164,
    0.045761004,
    -0.041028388,
    0.012327953,
    -0.044028535,
    -0.038111094,
    -0.025919314,
    0.01133436,
    -0.019314593,
    0.015186611,
    0.04649448,
    -0.014303963,
    -0.019675026,
    -0.011462189,
    -0.007488272,
    -0.000433051,
    -0.011208321,
    0.015787991,
    -0.004212937,
    0.002342547,
    0.01737369,
    0.006448067,
    -0.02884249,
    0.033045027,
    -0.013238667,
    0.041078065,
    -0.006503276,
    0.02509577,
    0.003341847,
    -0.035482943,
    0.014454346,
    0.020955237,
    0.02942905,
    -0.033905637,
    0.010006993,
    -0.017213272,
    0.051129378,
    -0.086517505,
    0.048552345,
    0.019240906,
    0.004676877,
    0.015224497,
    0.003914928,
    0.024346905,
    -0.007841855,
    0.043821469,
    -0.004834897,
    0.005417182,
    -0.024895824,
    0.028704494,
    -0.011220981,
    0.004695369,
    0.00722326,
    -0.021163115,
    0.000394269,
    -0.01717905,
    -0.003456156,
    0.009855961,
    -0.030989967,
    0.002540103,
    0.005139035,
    -0.092407167,
    -0.029617485,
    -0.01138161,
    -0.021079103,
    -0.00347736,
    -0.055500146,
    0.0148484,
    0.011145039,
    -0.056673773,
    0.002018311,
    -0.009421996,
    -0.032544974,
    -0.027683884,
    0.018143645,
    -0.036012057,
    0.03012491,
    -0.000856959,
    0.002877599,
    -0.005924461,
    0.007524708,
    0.039090656,
    -0.024405735,
    -0.00914438,
    -0.060344119,
    -0.018730337,
    -0.044572279,
    -0.030427283,
    0.045979727,
    -0.002032767,
    -0.027280666,
    0.020038337,
    -0.004886054,
    -0.014268398,
    0.010054353,
    -0.025807619,
    0.008443879,
    -0.007698802,
    8.6759e-05,
    0.027668983,
    0.028428454,
    -0.046566106,
    -0.009030786,
    0.006576655,
    0.06402871,
    -0.027311847,
    -0.022600938,
    0.004523999,
    0.033574436,
    0.053425781,
    0.044002771,
    0.052515395,
    -0.006939117,
    -0.036901332,
    -0.023385396,
    -0.057651863,
    -0.014724496,
    -0.005035515,
    -0.050366681,
    0.057562709,
    -0.030300016,
    0.019802725,
    0.029703952,
    -0.052782331,
    -0.045783505,
    -0.010842612,
    -0.005802921,
    -0.007853349,
    0.04396854,
    0.023524098,
    -0.025114616,
    -0.010048709,
    -0.04516203,
    0.035858814,
    0.045164902,
    -0.089437351,
    -0.004439204,
    0.007700861,
    -0.044684839,
    0.021545187,
    0.01516344,
    -0.028122609,
    -0.116770811,
    0.015194437,
    -0.011202773,
    -0.038428783,
    -0.003845987,
    0.005058706,
    0.057002686,
    -0.033528917,
    -0.047100753,
    0.010350831,
    -0.00437153,
    -0.038742773,
    0.005319137,
    -0.004144909,
    -0.045360047,
    -0.078137472,
    -0.002001425,
    0.021855313,
    0.026062764,
    0.020489672,
    0.005375087,
    -0.053813908,
    0.021701634,
    0.032745916,
    -0.034651961,
    -0.053622264,
    -0.003091895,
    -0.016769392,
    0.016958822,
    -0.009308755,
    0.00501205,
    0.011293144,
    -0.017018039,
    0.011730173,
    0.008072598,
    -0.043119747,
    0.013053518,
    -0.010580583,
    -0.019431397,
    0.041444641,
    -0.001020899,
    -0.017168406,
    -0.000725484,
    0.032244846,
    0.032581847,
    0.074062079,
    -0.02029277,
    0.044159967,
    0.041406557,
    -0.008501296,
    0.060669541,
    -0.005716882,
    0.029926978,
    0.043681253,
    0.02085774,
    -5.4984e-05,
    -0.022605123,
    0.044323158,
    0.040777568,
    0.006709858,
    -0.036667697,
    0.023561539,
    0.022270141,
    0.001586529,
    0.014086558,
    -0.00051462,
    0.012310027,
    0.020282242,
    0.027231984,
    -0.047599427,
    -0.007680306,
    -0.01318073,
    0.011566888,
    0.01639962,
    0.012946813,
    4.1987e-05,
    -0.030857446,
    -0.03823949,
    0.038141377,
    -0.004485711,
    -0.011656057,
    -0.007846382,
    0.019640351,
    -0.018686736,
    -0.029943252,
    -0.03608999,
    0.081877828,
    0.020221794,
    -0.024134494,
    -0.020262107,
    -0.010125762,
    -0.038902897,
    0.019117404,
    0.022249265,
    0.016002294,
    0.011194579,
    0.005858414,
    -0.044672541,
    0.016391193,
    0.004485554,
    0.063466772,
    0.049331136,
    0.024734309,
    0.00888275,
    0.049114436,
    -0.006930577,
    -0.00247917,
    0.043058168,
    0.079811051,
    -0.088801056,
    0.003697062,
    0.049205348,
    0.016218156,
    -0.057163127,
    -0.016094269,
    -0.005337536,
    0.005767581,
    -0.030559234,
    0.034956433,
    -0.006778812,
    0.005394947,
    0.021193426,
    -0.003343524,
    0.002527661,
    -0.035884574,
    -0.004414288,
    0.010129888,
    0.003690119,
    0.011166173,
    0.010392563,
    0.020868132,
    0.004685171,
    0.004020291,
    -0.02459858,
    -0.006352265,
    0.002484747,
    0.032568336,
    0.013159985,
    0.061752863,
    -0.023138786,
    -0.015573557,
    0.03406835,
    0.039800055,
    0.003360424,
    0.076570071,
    0.043497965,
    0.051851798,
    0.033736553,
    0.024117926,
    -0.001189197,
    -0.03074825,
    0.002490603,
    -0.018027224,
    -0.029454222,
    -0.006145747,
    0.031293239,
    0.050884452,
    -0.025335666,
    0.022521894,
    0.064234294,
    -0.024780078,
    -0.046807628,
    -0.035072032,
    -0.008745237,
    -0.064292826,
    -0.035179768,
    -0.008911988,
    0.01066648,
    0.006326255,
    0.02557623,
    -0.008967807,
    -0.005253213,
    0.044346306,
    0.08411926,
    -0.036040284,
    0.022184264,
    -0.050898783,
    -0.020931069,
    -0.045442633,
    0.032859053,
    0.019578861,
    0.011285126,
    -0.022019807,
    -0.022993613,
    0.076381773,
    -0.071716852,
    -0.014257575,
    0.001405355,
    0.003852826,
    0.007805005,
    -0.022119824,
    -0.075470388,
    0.018899411,
    0.04661797,
    -0.025721075,
    0.00628736,
    -0.000388117,
    -0.014592431,
    0.000556803,
    -0.005612914,
    0.032989226,
    0.00065132,
    -0.018588929,
    -0.026827905,
    0.007124901,
    0.006880144,
    -0.020752914,
    -0.023593029,
    -0.056529522,
    -0.039213371,
    0.006310103,
    -0.015873069,
    -0.015211543,
    0.005782864,
    -0.035911612,
    -0.014439983,
    0.014013181,
    0.031162975,
    -0.028783064,
    -0.000915529,
    0.081093065,
    -0.021567721,
    -0.023843082,
    0.007395261,
    0.012954148,
    0.033674344,
    -0.04165224,
    0.023255784,
    -0.029268268,
    -0.02138829,
    -0.027924273,
    0.020034965,
    0.011149319,
    0.024496416,
    -0.007246088,
    -0.012402337,
    -0.016313739,
    0.000698341,
    -0.004685339,
    0.020119971,
    -0.031128436,
    -0.036825333,
    0.001982311,
    0.00062091,
    -0.011503089,
    -0.06407772,
    0.035069373,
    -0.028522493,
    -0.044887308,
    0.057603166,
    0.009912797,
    0.039229579,
    -0.034035381,
    0.03004849,
    -0.00852885,
    -0.050809685,
    -0.039508943,
    -0.048040379,
    0.020303022,
    -0.003435037,
    -0.033880025,
    -0.007838361,
    -0.01245287,
    -0.032095563,
    -0.016804317,
    0.035659324,
    -0.033449836,
    -0.037247051,
    0.019883195,
    0.001487521,
    -0.008352445,
    -0.023904938,
    -0.022460051,
    -0.001461236,
    0.021935081,
    -0.005569155,
    -0.036625139,
    0.010816384,
    0.008669564,
    0.034404352,
    0.000671389,
    -0.049633026,
    0.055716239,
    0.014625128,
    -0.017482145,
    0.034512136,
    0.04500157,
    -0.002894891,
    -0.008768877,
    -0.028353332,
    -0.009630009,
    0.024030635,
    -0.043494064,
    0.063256793,
    0.013240408,
    0.028350672,
    -0.00894402,
    0.015266827,
    0.069725573,
    -0.03079219,
    0.030325701,
    -0.003375807,
    0.00907797,
    -0.002453352,
    -0.04716,
    -0.022374699,
    0.016844727,
    -0.01496966,
    -0.061350092,
    0.028374996,
    0.014335879,
    -0.00062077,
    -0.000590701,
    0.017489038,
    0.017486762,
    -0.00930219,
    -0.01575,
    0.008882987,
    0.012034372,
    -0.003155959,
    -0.019797061,
    0.008675097,
    -0.03574894,
    0.024784707,
    -0.007444735,
    -0.012581549,
    -0.01718371,
    0.000694106,
    -0.008722204,
    0.042852156,
    -0.003477194,
    -0.019484432,
    0.008870082,
    0.010561676,
    -0.01000437,
    0.027320165,
    -0.053406194,
    -0.039979436,
    -0.026587427,
    0.012210379,
    -0.031001955,
    0.04288828,
    0.001287109,
    -0.001461275,
    -0.014524121,
    -0.024408586,
    0.005861781,
    0.091539115,
    0.005760232,
    0.021968463,
    -0.059403617,
    -0.017913032,
    0.050392047,
    0.027290022,
    -0.01555905,
    -0.021193065,
    -0.039576251,
    -0.025799923,
    0.009679707,
    -0.032528728,
    -0.040550794,
    -0.015043603,
    -0.018218961,
    0.020695314,
    -0.046567187,
    0.001328805,
    0.012585486,
    0.01136322,
    0.040038746,
    -0.001888859,
    -0.018931955,
    0.001307134,
    -0.011394416,
    0.002626752,
    -0.000747126,
    0.010389106,
    0.01683264,
    0.006169317,
    -0.013817262,
    -0.025916357,
    -0.01464572,
    0.04026204,
    -0.044376194,
    -0.017710375,
    -0.0032219,
    0.052402172,
    0.024379516,
    0.00102931,
    0.01464122,
    -0.012016983,
    0.031845775,
    0.021703061,
    0.001936751,
    0.025842655,
    -0.026964767,
    0.010083764,
    0.042977288,
    0.026660951,
    -0.01002895,
    -0.009487197,
    0.005306977,
    0.04769564,
    0.021524543,
    -0.016548214,
    -0.008620809,
    -0.017189119,
    0.019459816,
    -0.012891402,
    0.015514424,
    0.031645063,
    0.006844189,
    -0.036774363,
    -0.012371356,
    -0.048192836,
    -0.025999051,
    0.024150334,
    0.033471037,
    0.021261258,
    -0.078911319,
    -0.007052979,
    -0.042804513,
    0.028681798,
    -0.024021357,
    -0.020086916,
    -0.00922073,
    -0.00501989,
    0.005769918,
    -0.020075943,
    -0.003025524,
    0.052863993,
    0.039328709,
    -0.044501394,
    0.018174496,
    -0.038556032,
    -0.048359696,
    -0.024441188,
    -0.035858214,
    0.016443789,
    0.024025742,
    0.014461505,
    -0.006019655,
    -0.031799108,
    0.023251433,
    -0.037914801,
    0.029780637,
    0.016607953,
    0.036583919,
    0.004045815,
    -0.02969496,
    -0.03301603,
    -0.016080881,
    -0.023068065,
    0.033849627,
    0.001277561,
    0.007215767,
    0.009848163,
    0.033446886,
    -0.011894829,
    0.044040591,
    0.035497501,
    0.006628808,
    0.034647696,
    0.003523253,
    -0.030288989,
    -0.035531331,
    0.01767724,
    -0.033168148,
    -0.015915968,
    0.035299171,
    0.006216278,
    -0.063066229,
    0.03567756,
    0.048230033,
    0.020441635,
    0.040400527,
    0.002578072,
    0.008390851,
    -0.05049815,
    -0.021764878,
    0.019723639,
    -0.056872755,
    -0.013775436,
    -0.027309539,
    0.014424594,
    0.015037751,
    0.018221743,
    -0.001267376,
    -0.019443797,
    -0.030571425,
    0.024386028,
    0.02533268,
    -0.027569948,
    0.043512627,
    0.014266275,
    0.033078615,
    -0.011953427,
    -0.014357146,
    -0.042599093,
    0.043526683,
    0.015922185,
    0.048826408,
    0.05850707,
    0.013329889,
    0.029424174,
    0.01627594,
    0.04325727,
    -0.003092959,
    0.009436101,
    0.032736026,
    -0.039293457,
    0.028600011,
    -0.005124384,
    0.008155105,
    -0.021603147,
    0.008781641,
    -0.023735255
  ],
  "metadata": {
    "language": "cs",
    "type": "commit_diff"
  },
  "payload": {
    "type": "commit_diff",
    "diff_type": "modified",
    "commit_hash": "266684124654cd11e8611089643cfdb1d41b936e",
    "commit_timestamp": 1754539501,
    "commit_date": "2025-08-06",
    "commit_message": "Complete 7-Phase TxtDb System Transformation\n\nMAJOR ACHIEVEMENTS:\n- Transformed system from ~40-50% to 95-100% pass rate\n- Fixed fundamental data visibility issues with JSON type handling\n- Implemente",
    "author_name": "jsbattig",
    "author_email": "jsbattig@gmail.com",
    "path": "TxtDb.Storage/Services/Async/MonitoredAsyncStorageSubsystem.cs",
    "chunk_index": 0,
    "char_start": 0,
    "char_end": 0,
    "project_id": "txt-db",
    "language": "cs",
    "file_extension": "cs"
  },
  "chunk_text": "@@ -1,5 +1,6 @@\n+using System.Collections.Concurrent;\n using System.Diagnostics;\n using TxtDb.Storage.Models;\n \n namespace TxtDb.Storage.Services.Async;\n \n@@ -11,10 +12,15 @@ namespace TxtDb.Storage.Services.Async;\n public class MonitoredAsyncStorageSubsystem : IDisposable\n {\n     private readonly AsyncStorageSubsystem _innerStorage;\n     private readonly StorageMetrics _metrics;\n     private bool _disposed;\n+    private string? _rootPath;\n+    \n+    // Namespace existence caching to reduce file system I/O overhead\n+    private readonly ConcurrentDictionary<string, (bool Exists, DateTime CacheTime)> _namespaceExistenceCache = new();\n+    private readonly TimeSpan _namespaceCacheTimeout = TimeSpan.FromSeconds(5);\n \n     /// <summary>\n     /// Performance metrics collected by this wrapper\n     /// </summary>\n     public StorageMetrics Metrics => _metrics;\n@@ -23,15 +29,98 @@ public class MonitoredAsyncStorageSubsystem : IDisposable\n     {\n         _innerStorage = new AsyncStorageSubsystem();\n         _metrics = new StorageMetrics();\n     }\n \n+    /// <summary>\n+    /// Check if namespace exists using caching and check-after-operation approach to eliminate race conditions.\n+    /// This method first checks the cache, then falls back to file system checks if needed.\n+    /// CRITICAL FIX: Uses check-after-operation pattern to avoid race conditions.\n+    /// </summary>\n+    private bool CheckNamespaceExistsWithCaching(string namespaceName)\n+    {\n+        var now = DateTime.UtcNow;\n+        \n+        // Check cache first for performance optimization\n+        if (_namespaceExistenceCache.TryGetValue(namespaceName, out var cachedResult))\n+        {\n+            if (now - cachedResult.CacheTime < _namespaceCacheTimeout)\n+            {\n+                _metrics.RecordNamespaceCacheHit();\n+                return cachedResult.Exists;\n+            }\n+            else\n+            {\n+                // Cache expired, remove stale entry\n+                _namespaceExistenceCache.TryRemove(namespaceName, out _);\n+            }\n+        }\n+        \n+        // Cache miss - perform file system check\n+        _metrics.RecordNamespaceCacheMiss();\n+        bool exists = CheckNamespaceDirectoryExists(namespaceName);\n+        \n+        // Update cache with result\n+        _namespaceExistenceCache.TryAdd(namespaceName, (exists, now));\n+        \n+        return exists;\n+    }\n+    \n+    /// <summary>\n+    /// Check if namespace directory exists using the same path resolution logic as the storage system.\n+    /// This method replicates the namespace-to-path conversion used in StorageSubsystem.\n+    /// PERFORMANCE OPTIMIZATION: Now only called when cache misses occur.\n+    /// </summary>\n+    private bool CheckNamespaceDirectoryExists(string namespaceName)\n+    {\n+        try\n+        {\n+            // The storage system uses a root path + namespace path conversion\n+            // Since we can't access private fields easily, we'll infer from the Initialize call\n+            // This is the safest approach without reflection\n+            var storagePath = _rootPath ?? \"\";\n+            var namespacePath = Path.Combine(storagePath, namespaceName.Replace('.', Path.DirectorySeparatorChar));\n+            return Directory.Exists(namespacePath);\n+        }\n+        catch\n+        {\n+            return false;\n+        }\n+    }\n+    \n+    /// <summary>\n+    /// CRITICAL FIX: Check-after-operation approach to eliminate race conditions.\n+    /// This method should be called AFTER an operation completes to determine if namespace tracking is needed.\n+    /// If the operation succeeded but the namespace didn't exist beforehand, track it as an operation of concern.\n+    /// </summary>\n+    private bool ShouldTrackNamespaceOperation(string namespaceName, bool operationSucceeded)\n+    {\n+        if (!operationSucceeded)\n+        {\n+            return false; // Don't track failed operations\n+        }\n+        \n+        // Check if namespace existed before operation (use check-before-operation for this specific case)\n+        // The race condition is minimized becau"
}